!function(){"use strict";var t,r;t="array";const l=e=>((e=void 0)=>{var t=typeof e;switch(!0){case null===e:return"null";case"object"==t&&Array.isArray(e):return"array";default:return t}})(e)===t,U=e=>l(e)&&0===e.length,f=(t,r)=>{const l=t.length;for(let e=0;e<l;++e)r(t[e],()=>{e=l})},i=(e,t)=>{return null==(e=Object.assign(null!=e?e:{}))?void 0:e[t]},N=(e,t)=>{const i=e,T=i.DOM;const n=i.Formatter.Utils,{Tag:u,UnsetSwitcher:E}=t,o=(e,r,l,t=!1)=>{var i;const n=T.Create(u),s=[],a=T.Create(u);var o=T.GetChildNodes(e);let d=!1,N=!1;f(o,e=>{var t;(d=T.Utils.IsChildOf(r,e)?!0:d)&&!N?f(T.GetChildNodes(e),e=>{var t;T.Utils.IsBr(e)||(t=s,e=[T.Clone(e,!0)],t.push(...e))}):(t=N?a:n,T.CloneAndInsert(t,!0,e)),T.Utils.IsChildOf(l,e)&&(N=!0)});o=!T.Utils.HasChildNodes(n);o||null!=(i=e.parentNode)&&i.replaceChild(n,e);let C;if(t){o?null!=(i=e.parentNode)&&i.replaceChild(s[0],e):T.InsertAfter(n,s[0]);for(let e=1,t=s.length;e<t;++e)T.InsertAfter(s[e-1],s[e]);C=s[s.length-1]}else{t=T.Create(E);T.Insert(t,...s),o?null!=(i=e.parentNode)&&i.replaceChild(t,e):T.InsertAfter(n,t),C=t}return T.Utils.HasChildNodes(a)&&T.InsertAfter(C,a),!0},d=e=>f(e,e=>{e=T.SelectAll(u,e);U(e)||f(e,e=>{var t=T.Utils.GetFirstChild(e),r=T.Utils.GetLastChild(e);t&&r&&o(e,t,r,!0)})}),s=(e,t=!1)=>{var r,l,i;e&&(l=n.GetParentIfText(e),r=T.Closest(l,u),l=T.Element.Table.FindClosest(l),r)&&!l&&(l=T.GetChildNodes(r),i=t?l[0]:e,t=t?e:l[l.length-1],o(r,i,t,!1))};return{UnwrapFromCaret:e=>{if(!n.LeaveProcessorIfFigure(i,e)&&!(s=>{if(s.Start.Line!==s.End.Line)return!1;var e=n.GetParentIfText(s.Start.Node),t=T.Closest(e,u),r=T.Element.Table.FindClosest(e);if(!t&&!r)return!1;if(r){r=T.Element.Table.GetSelectedCells(i,r);if(!U(r))return d(r),!0}r=T.Element.Table.FindClosestCell(e);if(!r&&t)return o(t,s.Start.Node,s.End.Node);if(!r)return!1;e=T.GetChildNodes(r);let a=!1;return f(e,(e,t)=>{var r,l,i=!!T.Utils.IsChildOf(s.Start.Node,e),n=!!T.Utils.IsChildOf(s.End.Node,e);(a=i?!0:a)&&(l=T.Utils.GetFirstChild(e),r=T.Utils.GetLastChild(e),T.Utils.GetNodeName(e)===u&&l&&r&&(i=i?s.Start.Node:l,l=n?s.End.Node:r,o(e,i,l,!0)),n)&&t()}),!0})(e)){var t=e;if(t.Start.Line!==t.End.Line){var r=i.GetLines();s(t.Start.Node);for(let e=t.Start.Line+1;e<t.End.Line;++e){var l=r[e],l=T.Utils.GetFirstChild(l);l&&s(l)}s(t.End.Node,!0)}}}}};(e=r=r||{})[e.UNKNOWN=0]="UNKNOWN",e[e.ELEMENT=1]="ELEMENT",e[e.ATTRIBUTE=2]="ATTRIBUTE",e[e.TEXT=3]="TEXT",e[e.CDATA_SECTION=4]="CDATA_SECTION",e[e.ENTITY_REFERENCE=5]="ENTITY_REFERENCE",e[e.ENTITY=6]="ENTITY",e[e.PROCESSING_INSTRUCTION=7]="PROCESSING_INSTRUCTION",e[e.COMMENT=8]="COMMENT",e[e.DOCUMENT=9]="DOCUMENT",e[e.DOCUMENT_TYPE=10]="DOCUMENT_TYPE",e[e.DOCUMENT_FRAGMENT=11]="DOCUMENT_FRAGMENT",e[e.NOTATION=12]="NOTATION";var e=t=>e=>{return e=e,(null!=(e=i(e,"nodeType"))?e:r.UNKNOWN)===t};e(r.ELEMENT),e(r.ATTRIBUTE);const v=e(r.TEXT),C=(e(r.CDATA_SECTION),e(r.ENTITY_REFERENCE),e(r.ENTITY),e(r.PROCESSING_INSTRUCTION),e(r.COMMENT),e(r.DOCUMENT),e(r.DOCUMENT_TYPE),e(r.DOCUMENT_FRAGMENT),e(r.NOTATION),(e,t)=>{const n=e,C=n.DOM;e=n.Formatter;const s=e.Utils;var e=e.Formats.BlockFormatTags;const{Tag:T,Switchable:u,Following:a}=t,o=([t,...e]=[",",C.Element.Table.Selector,...e.List],e.join(t)),i=(...e)=>{var t=C.Create(a);return C.CloneAndInsert(t,!0,...e),t},d=e=>f(e,e=>{var t=(e=>{const t=C.Create(T);return f(C.GetChildNodes(e,!1),e=>{if(!C.Utils.IsBr(e))return u.has(C.Utils.GetNodeName(e))?C.CloneAndInsert(t,!0,...C.GetChildNodes(e,!1)):(e=i(e),void C.Insert(t,e))}),t})(e);C.Utils.HasChildNodes(t)||C.Insert(t,C.Utils.WrapTagHTML(a,"<br>")),e.replaceChildren(t)}),E=(e,t)=>{if(e.previousSibling&&C.Utils.GetNodeName(e.previousSibling)===T)return C.Insert(e.previousSibling,...t?[t]:C.GetChildNodes(e,!1)),C.Remove(e,!0);var r,l;e.nextSibling&&C.Utils.GetNodeName(e.nextSibling)===T&&(((l=!!(r=C.Utils.GetFirstChild(e.nextSibling)))?C.InsertBefore:C.Insert)(l?r:e.nextSibling,...t?[t]:C.GetChildNodes(e,!1)),C.Remove(e,!0))},N=e=>{var t,r,l;if(e.parentNode)return t=i(...C.GetChildNodes(e,!1)),e.previousSibling&&C.Utils.GetNodeName(e.previousSibling)===T?(C.Insert(e.previousSibling,t),C.Remove(e,!0)):e.nextSibling&&C.Utils.GetNodeName(e.nextSibling)===T?(((l=!!(r=C.Utils.GetFirstChild(e.nextSibling)))?C.InsertBefore:C.Insert)(l?r:e.nextSibling,t),C.Remove(e,!0)):(l=C.Create(T),C.Insert(l,t),void e.parentNode.replaceChild(l,e))},I=(e,i,n)=>{if(C.Utils.GetNodeName(e)!==T){var t=C.GetChildNodes(e);if(t[0]===i&&t[t.length-1]===n)(s=e).parentNode&&u.has(C.Utils.GetNodeName(s))&&(a=C.Create(T),C.CloneAndInsert(a,!0,...C.GetChildNodes(s,!1)),s.parentNode.replaceChild(a,s),E(a));else{var s=C.Utils.GetNodeName(e);const o=C.Create(s),d=C.Create(T),N=C.Create(s);let r=!1,l=!1;f(t,e=>{e===i&&(r=!0);var t=l?N:r?d:o;C.CloneAndInsert(t,!0,e),e===n&&(l=!0)});var a=!C.Utils.HasChildNodes(o);null!=(t=e.parentNode)&&t.replaceChild(a?d:o,e),a||C.InsertAfter(o,d),C.Utils.HasChildNodes(N)&&C.InsertAfter(d,N),E(d)}}},m=e=>{let t=e;for(;t&&t!==n.GetBody()&&t.parentNode!==n.GetBody();)t=t.parentNode;return t},h=(e,t=!1)=>{if(e){var r,l,i,e=s.GetParentIfText(e);if(!C.Closest(e,o))return(r=m(e))?N(r):void 0;C.Element.Table.FindClosest(e)||null!=(r=C.Closest(e,a))&&r.parentNode&&(e=r.parentNode,l=C.GetChildNodes(e),i=t?l[0]:r,t=t?r:l[l.length-1],I(e,i,t))}},c=(e,r,l=!1)=>{if(e){if(!u.has(C.Utils.GetNodeName(e)))return N(e);var i=C.GetChildNodes(e,!1);if(!r)return I(e,i[0],i[i.length-1]);let t;f(i,e=>{C.Utils.IsChildOf(r,e)&&(t=e)}),t&&I(e,l?i[0]:t,l?t:i[i.length-1])}},g=(e,l,i)=>{e=C.GetChildNodes(e,!0);let n=!1;const s=(e,t,r)=>{if(C.Utils.IsBr(e))return C.Remove(e);var l,i,n=v(e),s=n?(l=e,i=C.Create("p"),C.CloneAndInsert(i,!0,l),null!=(s=l.parentNode)&&s.replaceChild(i,l),i):e;n&&t&&(r?C.InsertBefore:C.InsertAfter)(s.firstChild,t),c(s)};f(e,(e,t)=>{var r;return C.Utils.IsChildOf(l,e)?(n=!0,r=C.HasAttr(e.previousSibling,"marker")?e.previousSibling:null,s(e,r,!0)):C.Utils.IsChildOf(i,e)?(r=C.HasAttr(e.nextSibling,"marker")?e.nextSibling:null,s(e,r),t()):void(n&&s(e))})};return{WrapFromCaret:e=>{if(!s.LeaveProcessorIfFigure(n,e)&&!(l=>{if(l.Start.Line!==l.End.Line)return!1;var e=s.GetParentIfText(l.Start.Node),t=s.GetParentIfText(l.End.Node);if(!C.Closest(e,o))return!!(i=m(e))&&(N(i),!0);var i=C.Element.Table.FindClosest(e);if(i){i=C.Element.Table.GetSelectedCells(n,i);if(!U(i))return d(i),!0}var i=C.Closest(e,a),r=C.Closest(t,a);if(null!=i&&i.parentNode&&null!=r&&r.parentNode&&i.parentNode===r.parentNode)I(i.parentNode,i,r);else{if(i||r){i=C.GetChildNodes(l.SameRoot);let r=!1;if(f(i,(e,t)=>C.Utils.IsChildOf(l.Start.Node,e)?(r=!0,c(e,l.Start.Node)):C.Utils.IsChildOf(l.End.Node,e)?(c(e,l.End.Node,!0),t()):void(r&&c(e))),r)return!0}C.Element.Table.FindClosestCell(e)===C.Element.Table.FindClosestCell(t)&&g(l.SameRoot,l.Start.Node,l.End.Node)}return!0})(e)){var t=e;if(t.Start.Line!==t.End.Line){var r=n.GetLines();h(t.Start.Node);for(let e=t.Start.Line+1;e<t.End.Line;++e){var l=r[e],l=C.Utils.GetFirstChild(l);l&&h(l)}h(t.End.Node,!0)}}}}}),a=e=>{const n=e,s=n.DOM,i=n.Formatter.Formats,a=n.Formatter.UI,t=n.Formatter.Detector,o=(r,l)=>{for(let e=0,t=l.length;e<t;++e){var i=l[e];if(s.Closest(i,r))return!0}return!1},d=(t,r)=>e=>{a.IsDisabled(r)||(((e,t)=>{const l=e,i=l.Utils.Caret,n=l.Formatter.Utils,s=C(l,t),a=N(l,t);return{ToggleFromCaret:e=>{const t=e?s.WrapFromCaret:a.UnwrapFromCaret,r=i.Get();r&&n.RunFormatting(l,()=>t(r))}}})(n,t).ToggleFromCaret(e),a.ToggleActivateClass(r,e),n.Utils.Shared.DispatchCaretChange())};return{IsDetected:o,CreateIconButton:(e,t)=>{var{Format:t,Title:r,Icon:l}=t;const i=a.CreateIconButton(r,l);r=d(t,i);return a.RegisterCommand(n,e,r),a.BindClickEvent(i,()=>a.RunCommand(n,e,!a.HasActiveClass(i))),i},RegisterDetector:(r,l)=>t.Register(e=>{a.ToggleActivateClass(r,o(l.Tag,e));var{Figure:e,FigureElement:t}=s.Element.Figure.Find(e[0]),e=!!e&&!!t&&i.AllDisableList.has(s.Utils.GetNodeName(t));a.ToggleDisable(r,e)})}},o=(e,t)=>{var r=e.Formatter.Formats.BlockFormatTags,l=e.Formatter.Formats.ListItemSelector,i="BulletList",r={Format:{Tag:"ul",Switchable:r.List,Following:l,UnsetSwitcher:"p"},Title:e.Lang("plugins.lists.bullet","Bulleted List"),Icon:"UnorderedList"},l=t.CreateIconButton(i,r);t.RegisterDetector(l,r.Format),e.Toolbar.Add(i,l)},d=(e,t)=>{var r=e.Formatter.Formats.BlockFormatTags,l=e.Formatter.Formats.ListItemSelector,i="NumberList",r={Format:{Tag:"ol",Switchable:r.List,Following:l,UnsetSwitcher:"p"},Title:e.Lang("plugins.lists.number","Numbered List"),Icon:"OrderedList"},l=t.CreateIconButton(i,r);t.RegisterDetector(l,r.Format),e.Toolbar.Add(i,l)};RichEditor.Loaders.Plugin.Add("lists",e=>{{const t=e,r=t.Plugin,l=t.Formatter.Utils,i=a(t),n=["BulletList","NumberList"],s=e=>{if(l.HasFormatName(e,n))switch(l.GetFormatName(e,n)){case n[0]:o(t,i);break;case n[1]:d(t,i)}};f(n,e=>r.Add(e,s))}})}();