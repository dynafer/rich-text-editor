!function(){"use strict";var e=t=>e=>((e=void 0)=>{var t=typeof e;switch(!0){case null===e:return"null";case"object"==t&&Array.isArray(e):return"array";default:return t}})(e)===t;const s=e("array"),a=e("number"),h=e("object"),v=e("string"),g=e("boolean"),R=e("function"),r=e("null"),n=e("undefined"),A=e=>s(e)&&0===e.length,I=(t,a)=>{const r=t.length;for(let e=0;e<r;++e)a(t[e],()=>{e=r})},C=(e,...t)=>e.push(...t),m=e=>e.shift(),T=e=>{const a=[];return I(e,e=>{return t=a,e=[e],t.unshift(...e);var t}),a},f=e=>e.splice(0,e.length),L=e=>Array.from(e),U=e=>v(e)&&0===e.length,o=e=>e.toString().toLowerCase(),S=(e,t)=>v(t)?e.includes(t):t.test(e),i=(e,...t)=>t.join(e),c=(...e)=>i("",...e);let d=document.baseURI;var u,e=d.split("/"),E=(d=e.slice(0,e.length-1).join("/"),f(e),I(document.head.querySelectorAll("script"),(e,t)=>{S(e.src,"editor.")&&(e=e.src.split("/"),d=e.slice(0,e.length-1).join("/"),U(d)&&(d="."),f(e),t())}),(e=u=u||{}).classic="classic",e.inline="inline",(()=>{const t={};var a=["adjustable-edge","adjustable-edge-group","adjustable-line","adjustable-line-group","adjusting","as-text","fake","fixed","focused","icon","horizontal","movable","original-height","original-width","parts-menu","remove","selected","style","type","vertical"];{var r,i=a,n=e=>{t[e.toString().toUpperCase().replace(/-/g,"_")]=c("editor","-",e)};let e=!1;for(var o=()=>{e=!0};!(A(i)||(r=m(i))&&(n(r,o),e)););}a=new URL(d).href;const l={PREFIX:a,CSS:""+a,PLUGIN:a+"/plugins",ICON:a+"/icons",LANGUAGE:a+"/langs"};return{PROJECT_NAME:"rich-text-editor",SHORT_NAME:"editor",ATTRIBUTES:t,URLS:l,JoinURL:(e,t)=>{switch(e){case"css":return S(t,".css")||(t+=".min.css"),l.CSS+"/"+t;case"plugin":return S(t,".js")||(t+=`/${t}.min.js`),l.PLUGIN+"/"+t;case"icon":return S(t,".js")||(t+="/icons.min.js"),l.ICON+"/"+t;case"language":return S(t,".js")||(t+=".js"),l.LANGUAGE+"/"+t;default:return l.PREFIX+"/"+t}},GetModeTag:e=>e===u.inline?"div":(u.classic,"iframe")}})()),e=e=>i(":","Media",e),t=e=>i(":","Image",e),l=e=>i(":","MediaStyle",e);const p={MEDIA_CREATE:e("Create"),MEDIA_UPDATE:e("Update"),MEDIA_REMOVE:e("Remove"),IMAGE_CREATE:t("Create"),IMAGE_UPLOAD:t("Upload"),IMAGE_UPDATE:t("Update"),IMAGE_REMOVE:t("Remove"),FLOAT_LEFT:l("FloatLeft"),FLOAT_RIGHT:l("FloatRight"),ALIGN_LEFT:l("AlignLeft"),ALIGN_CENTER:l("AlignCenter"),ALIGN_RIGHT:l("AlignRight")},M=["byte","KB","MB","GB","TB"],F=1024,b=(e="auto",a=0)=>{var r={Size:a,Unit:M[0]};switch(o(e)){case"kb":case"mb":case"gb":case"tb":var t=Math.min(Math.floor(Math.log(a)/Math.log(F)),M.length-1);r.Size=a/Math.pow(F,t),r.Unit=M[t];break;case"auto":for(let e=0,t=M.length;e<t;++e){var i=a/Math.pow(F,e);if(Math.floor(10*i)<1)break;r.Size=i,r.Unit=M[e]}}return r},G=(t,a)=>{if(!a||"all"===a)return"image/*";var r=s(a)?a:[];const n=[];if(v(a)){let e=a;e=(e=S(a,",")?e.replace(/\s+/g,""):e).replace(/\s+/g,","),C(r,...e.split(","))}if(I(r,e=>{if(v(e)){const i=o(e.replace("image/","").trim());I(t,(e,t)=>{var a,r;a=n,r=e,s(a)&&a.includes(r)||!S(e,i)&&!S(i,e)||(C(n,e),t())})}}),t.length===n.length||A(n))return"image/*";for(let e=0,t=n.length;e<t;++e)n[e]=c("image/",n[e]);return i(",",...n)},N=(e,t,a)=>e.Lang(c("plugins.parts.menu.",t),a),y=(...e)=>{const a=[];I(e,e=>{return C(a,(i=e,{Get:()=>i,GetName:()=>i.name,GetType:()=>i.type,GetSize:(e="auto")=>b(e,i.size),Read:(e,t)=>{const a=new FileReader,r=()=>{t(a.result),a.removeEventListener(RichEditor.NativeEventMap.load,r)};switch(a.addEventListener("load",r),e){case"ArrayBuffer":a.readAsArrayBuffer(i);break;case"BinaryString":a.readAsBinaryString(i);break;case"DataURL":a.readAsDataURL(i);break;case"Text":a.readAsText(i)}}}));var i});return{Get:()=>e,GetList:()=>a,GetLength:()=>a.length,GetTotalSize:(e="auto")=>{let t=0;return I(a,e=>{t+=e.GetSize("byte").Size}),b(e,t)}}};var O=(()=>{const i=[{pattern:/(www\.)?(youtube\.com|youtu\.be)\/.+/i,format:"iframe",width:560,height:315,convert:e=>{e=e.replace(/(>|<)/gi,"").split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/);return e[2]?(e[2]=e[2].split(/[^0-9a-z_\-]/i)[0],c("https://www.youtube.com/embed/",e[2])):e[0]}},{pattern:/(www\.)?(google\.com|maps\.google)\/(maps\/)?.+/i,format:"iframe",width:600,height:450},{pattern:/(www\.)?(vimeo\.com|player\.vimeo)\/.+/i,format:"iframe",width:640,height:360,convert:e=>{e=e.replace(/(>|<)/gi,"").split(/(vimeo\.com\/)(video\/)?/);return e[3]?(e[3]=e[3].split(/[^0-9]/i)[0],c("https://player.vimeo.com/video/",e[3])):e[0]}},{pattern:/(www\.)?(dailymotion\.com|dai\.ly)\/.+/i,format:"iframe",width:640,height:360,convert:e=>{e=e.replace(/(>|<)/gi,"").split(/(dailymotion\.com\/|dai\.ly\/)(embed\/)?(video\/)?/);return e[4]?(e[4]=e[4].split(/[^0-9a-z]/i)[0],c("https://www.dailymotion.com/embed/video/",e[4])):e[0]}}];return{Match:a=>{const r={URL:a,Format:null,Width:null,Height:null};return I(i,(e,t)=>{e.pattern.test(a)&&(R(e.convert)&&(r.URL=e.convert(r.URL)),r.Format=e.format,r.Width=e.width,r.Height=e.height,t())}),r},Add:e=>{var t;((e,t)=>{e=null==(e=Object.assign(null!=e?e:{}))?void 0:e[t];return!n(e)&&!r(e)})(e.pattern,"test")&&v(e.format)&&a(e.width)&&a(e.height)&&(t={pattern:e.pattern,format:e.format,width:e.width,height:e.height},R(e.convert)&&(t.convert=e.convert),C(i,t))}}})();const _=e=>{const s=e,m=s.DOM,c=s.Tools.Parts,d=s.Utils.Caret,g=s.Formatter,u=(...t)=>{s.Focus(),c.UnsetAllFocused();var e=d.Get(),a=s.GetLines(),r=()=>{var e=s.Utils.Range();e.SetStartToEnd(t[0],1,1),d.UpdateRange(e),s.Utils.Shared.DispatchCaretChange([t[0]]),f(t)};if(!e){const o=A(a)?m.Insert:m.InsertAfter;var i=A(a)?s.GetBody():a[0];const l=A(a)?t:T(t);return o(i,...l),r()}s.Utils.Shared.DeleteRange(e);var{StartBlock:i,EndBlock:n}=s.Utils.Shared.SplitLines(e.Start.Node,e.Start.Offset),e=g.Utils.GetParentIfText(e.Start.Node),e=null!=(e=null!=i?i:m.Closest(e,{tagName:L(g.Formats.BlockFormatTags.Block)}))?e:a[0];const o=e?m.InsertAfter:m.Insert,l=e?[n,...T(t)]:[...t,n];o(null!=e?e:s.GetBody(),...l),!m.Element.Figure.Is(i)&&U(m.GetText(i))&&m.Remove(i),!m.Element.Figure.Is(n)&&U(m.GetText(n))&&m.Remove(n),r()},E=(e,t)=>{const a=()=>{R(t)&&t(e),c.ChangePositions(),m.Off(e,RichEditor.NativeEventMap.loadeddata,a),m.Off(e,RichEditor.NativeEventMap.load,a),m.Off(e,RichEditor.NativeEventMap.error,a)};m.On(e,RichEditor.NativeEventMap.loadeddata,a),m.On(e,RichEditor.NativeEventMap.load,a),m.On(e,RichEditor.NativeEventMap.error,a)},p=e=>{var{tagName:e,attrs:t,styles:a}=e,e=m.Create(e,{attrs:h(t)?t:{},styles:h(a)?a:{}});return e.draggable=!0,e};return{OnLoadAndErrorEvents:E,ChangeFigure:(e,t)=>{var a=t["loadCallback"],t=(I(m.GetChildren(e),e=>m.Remove(e,!0)),p(t)),r=c.Create("media",t);m.Insert(e,t,r),E(t,a)},CreateViaURL:(e,t)=>{var a=t["loadCallback"],r=m.Element.Figure.Create("media"),e=(r.draggable=!0,t.attrs||(t.attrs={}),t.attrs.src=e,p(t)),t=c.Create("media",e);E(e,a),e.src=new URL(e.src).href,m.Insert(r,e,t),u(r)},CreateFromFiles:(e,i,n)=>{const o=n["loadCallback"],l=[];I(e.GetList(),e=>{if(S(i,"*")||S(i,e.GetType())){const a=m.Element.Figure.Create("media"),r=(a.draggable=!0,n.attrs||(n.attrs={}),n.attrs.title=e.GetName(),p(n));var t=c.Create("media",r);e.Read("DataURL",e=>{if(!v(e))return m.Remove(a,!0);r.src=e,E(r,o)}),m.Insert(a,r,t),C(l,a)}}),u(...l)}}},w=(e,t)=>{const a=e,r=a.DOM,{Styles:i,SameStyles:n,bAsText:o}=t,l=e=>{e=r.Element.Figure.FindClosest(e);return e?(r.RemoveStyles(e,...n),(o?r.SetAttr:r.RemoveAttr)(e,E.ATTRIBUTES.AS_TEXT),r.SetStyles(e,i),e):null},s=e=>{e=r.Element.Figure.FindClosest(e);return e?(o&&r.RemoveAttr(e,E.ATTRIBUTES.AS_TEXT),r.RemoveStyles(e,...((e,t)=>{if(!h(e))return[];var a=Object.keys(e);if(R(t)){const r=a.length;for(let e=0;e<r;++e)t(a[e],()=>{e=r})}return a})(i)),e):null};return{Toggle:(e,t)=>{e=(e?l:s)(t);if(e)return a.Utils.Shared.DispatchCaretChange([e]);a.Tools.Parts.ChangePositions()}}},D=e=>{const n=e,o=n.DOM;e=[{Name:p.FLOAT_LEFT,Styles:{float:"left"},SameStyles:["margin-left","margin-right"],bAsText:!0},{Name:p.FLOAT_RIGHT,Styles:{float:"right"},SameStyles:["margin-left","margin-right"],bAsText:!0},{Name:p.ALIGN_LEFT,Styles:{marginLeft:"0px",marginRight:"auto"},SameStyles:["float"]},{Name:p.ALIGN_CENTER,Styles:{marginLeft:"auto",marginRight:"auto"},SameStyles:["float"]},{Name:p.ALIGN_RIGHT,Styles:{marginLeft:"auto",marginRight:"0px"},SameStyles:["float"]}];const r=(t,a)=>{const r=n.History.Flag();let i=0;return e=>{R(a)&&a(e),++i,t>i||(n.History.ChangeData(r,n.History.CreateData()),n.History.Unflag())}},l=(t,a)=>r(1,e=>{o.Utils.IsVideo(e)?e.controls=!0:(o.SetAttr(e,E.ATTRIBUTES.ORIGINAL_WIDTH,t.toString()),o.SetAttr(e,E.ATTRIBUTES.ORIGINAL_HEIGHT,a.toString()),o.SetStyles(e,{width:t+"px",height:a+"px"}))}),s=e=>{var e=O.Match(e),t=null!=(t=e.Format)?t:"video",a=null!=(a=e.Width)?a:640,r=null!=(r=e.Height)?r:360;return{URL:e.URL,format:t,width:a,height:r}},t=e=>{_(n).CreateViaURL(e,{tagName:"img"})},a=(e,t)=>{A(e)||(e=y(...e),_(n).CreateFromFiles(e,t,{tagName:"img",loadCallback:r(e.GetLength())}))},i=(e,t)=>{var{Figure:t,FigureElement:a}=o.Element.Figure.Find(t);t&&o.Utils.IsImage(a)&&(t=_(n),a.src=e,t.OnLoadAndErrorEvents(a,r(1)))},m=e=>{var t=_(n),e=s(e);t.CreateViaURL(e.URL,{tagName:e.format,loadCallback:l(e.width,e.height)})},c=(e,t)=>{var a,r,{Figure:t,FigureElement:i}=o.Element.Figure.Find(t);if(t&&(o.Utils.IsIFrame(i)||o.Utils.IsVideo(i)))return a=_(n),e=s(e),r=l(e.width,e.height),o.Utils.GetNodeName(i)===e.format?(i.src=e.URL,a.OnLoadAndErrorEvents(i,r)):void a.ChangeFigure(t,{tagName:e.format,attrs:{src:e.URL},loadCallback:r})},d=e=>o.Element.Figure.Remove(n,e);I(e,e=>{return n.Commander.Register(e.Name,(a=e,(e,t)=>{t=o.Element.Figure.Find(t).FigureElement;if(!t)return null;w(n,a).Toggle(e,t)}));var a});return{Register:e=>{switch(e){case"Image":return n.Commander.Register(p.IMAGE_CREATE,t),n.Commander.Register(p.IMAGE_UPLOAD,a),n.Commander.Register(p.IMAGE_UPDATE,i),n.Commander.Register(p.IMAGE_REMOVE,d);case"Media":return n.Commander.Register(p.MEDIA_CREATE,m),n.Commander.Register(p.MEDIA_UPDATE,c),n.Commander.Register(p.MEDIA_REMOVE,d)}}}},B=e=>{const r=e.DOM,i=e.Formatter.UI;return{ACTIVE_CLASS:i.ACTIVE_CLASS,DISABLED_ATTRIBUTE:i.DISABLED_ATTRIBUTE,CreateFormatButton:e=>{var{Title:e,Icon:t}=e,a=i.CreateIconWrap(e),t=i.CreateIconButton(e,t),e=i.CreateHelper(e);return r.Insert(a,t,e),{Wrapper:a,Button:t,Helper:e}},RegisterCommand:i.RegisterCommand,RunCommand:i.RunCommand,BindClickEvent:(t,...e)=>I(e,e=>i.BindClickEvent(e,t))}},k=(e,t)=>{const i=e,n=i.DOM;const o=i.Formatter.UI,l="Image";var e={Title:i.Lang("plugins.media.image.title","Insert/Upload an image"),Icon:"Image"},a=h(i.Config.ImageConfiguration)?i.Config.ImageConfiguration:{};const r=!g(a.multiple)||a.multiple,s=G(["jpeg","png","gif","bmp","svg+xml","webp","tiff","x-icon","vnd.microsoft.icon"],a.accept),m=a.uploadCallback;a={attrs:{type:"file",accept:s}};r&&(a.attrs.multiple="true");const c=n.Create("input",a);n.On(c,RichEditor.NativeEventMap.change,()=>{var e=c.files;e&&(e=L(r?e:[e[0]]),R(m)?m(y(...e)).then(e=>i.Commander.Run(p.IMAGE_CREATE,e)).catch(e=>i.Notification.Dispatch(i.Notification.STATUS_MAP.ERROR,e,!1)):(i.Commander.Run(p.IMAGE_UPLOAD,e,s),c.value=""))});var d,a=t.CreateFormatButton(e);t.BindClickEvent(()=>{o.DestoryOpenedOptionList(i),c.click()},a.Button),o.BindOptionListEvent(i,{type:l,activable:a.Wrapper,clickable:a.Helper,create:(d=a.Wrapper,()=>{const a=n.Element.Figure.SelectFigureElement(i.Tools.Parts.SelectFocused(!1,"media")),r=n.Utils.IsImage(a);var e=i.Lang("plugins.media.image.update","Update the image URL"),t=i.Lang("plugins.media.image.insert","Insert an image via URL"),{OptionWrapper:e,Input:t}=o.CreateInputWrapWithOptionList(i,{uiName:l,bUpdatable:r,createCallback:e=>{var t=r?p.IMAGE_UPDATE:p.IMAGE_CREATE;i.Commander.Run(t,e.value,a)},removeCallback:()=>{a&&i.Commander.Run(p.IMAGE_REMOVE,a)},src:r?a.src:void 0,texts:{placeholder:r?e:t,cancel:i.Lang("cancel","Cancel"),insert:i.Lang("insert","Insert"),update:i.Lang("update","Update"),remove:i.Lang("remove","Remove")}});return n.Insert(i.Frame.Root,e),o.SetOptionListCoordinate(i,l,d,e),t.focus(),e})}),i.Toolbar.Add(l,a.Wrapper)},P=(e,t)=>{const n=e,o=n.DOM;const l=n.Formatter.UI,s="Media";var m,e={Title:n.Lang("plugins.media.title","Insert/Edit a media"),Icon:"Media"},t=t.CreateFormatButton(e);o.SetAttr(t.Wrapper,"no-border"),l.BindOptionListEvent(n,{type:s,activable:t.Wrapper,clickable:t.Wrapper,create:(m=t.Wrapper,()=>{const e=n.Tools.Parts.SelectFocused(!1,"media"),a=o.Element.Figure.SelectFigureElement(e),r=o.Element.Figure.Is(e)&&(o.Utils.IsIFrame(a)||o.Utils.IsVideo(a));var t=n.Lang("plugins.media.update","Update the media URL"),i=n.Lang("plugins.media.insert","Insert a media via URL"),{OptionWrapper:t,Input:i}=l.CreateInputWrapWithOptionList(n,{uiName:s,bUpdatable:r,createCallback:e=>{var t=r?p.MEDIA_UPDATE:p.MEDIA_CREATE;n.Commander.Run(t,e.value,a)},removeCallback:()=>{e&&n.Commander.Run(p.MEDIA_REMOVE,e)},src:r?a.src:void 0,texts:{placeholder:r?t:i,cancel:n.Lang("cancel","Cancel"),insert:n.Lang("insert","Insert"),update:n.Lang("update","Update"),remove:n.Lang("remove","Remove")}});return o.Insert(n.Frame.Root,t),l.SetOptionListCoordinate(n,s,m,t),i.focus(),t})}),n.Toolbar.Add(s,t.Wrapper)},x=(e,l)=>{const s=e,m=s.DOM,i={Float:[{Title:N(s,"floatLeft","Align left with text wrapping"),CommandName:p.FLOAT_LEFT,Icon:"MediaFloatLeft"},{Title:N(s,"floatRight","Align right with text wrapping"),CommandName:p.FLOAT_RIGHT,Icon:"MediaFloatRight"}],Alignment:[{Title:N(s,"alignLeft","Align left with text break"),CommandName:p.ALIGN_LEFT,Icon:"MediaAlignLeft"},{Title:N(s,"alignCenter","Align center with text break"),CommandName:p.ALIGN_CENTER,Icon:"MediaAlignCenter"},{Title:N(s,"alignRight","Align right with text break"),CommandName:p.ALIGN_RIGHT,Icon:"MediaAlignRight"}]};return{Create:()=>{const t=m.Create("div",{attrs:[E.ATTRIBUTES.PARTS_MENU]});var a,e,r;return((e,t)=>{if(!h(e))return;var a=Object.values(e);if(R(t)){const r=a.length;for(let e=0;e<r;++e)t(a[e],()=>{e=r})}})(i,e=>m.Insert(t,((n,e)=>{const o=m.Create("div",{class:m.Utils.CreateUEID("icon-group",!1)});return I(e,e=>{const{Title:t,CommandName:a,Icon:r}=e,i=m.Create("button",{attrs:{title:t},class:m.Utils.CreateUEID("icon-button",!1),html:RichEditor.Icons.Get(r)});m.On(i,RichEditor.NativeEventMap.click,e=>{RichEditor.PreventEvent(e);var e=!m.HasClass(i,l.ACTIVE_CLASS),t=(s.Commander.Run(a,e,n),m.SelectAll({class:m.Utils.CreateUEID("icon-button",!1)},n));I(t,e=>m.RemoveClass(e,l.ACTIVE_CLASS)),(e?m.AddClass:m.RemoveClass)(i,l.ACTIVE_CLASS)}),m.Insert(o,i)}),o})(t,e))),m.Insert(t,(a=t,e=m.Create("div",{class:m.Utils.CreateUEID("icon-group",!1)}),r=m.Create("button",{attrs:[E.ATTRIBUTES.REMOVE,{title:N(s,"remove.figure","Remove the figure")}],class:m.Utils.CreateUEID("icon-button",!1),html:RichEditor.Icons.Get(RichEditor.Icons.Get("Trash"))}),m.On(r,RichEditor.NativeEventMap.click,e=>{RichEditor.PreventEvent(e),s.Commander.Run(p.MEDIA_REMOVE,a)}),m.Insert(e,r),e)),t}}};RichEditor.Loaders.Plugin.Add("media",e=>{{const a=e,r=a.Plugin,i=(e=a.Tools.Parts.Manager,a.Formatter.Utils),n=B(a),o=["Image","Media"];var t=x(a,n);e.Attach({name:"media",partAttachers:[t.Create]}),s(a.Config.MediaUrlPatterns)&&(e=a.Config.MediaUrlPatterns,I(e,e=>O.Add(e)));const l=e=>{if(i.HasFormatName(e,o)){var e=i.GetFormatName(e,o),t=D(a);switch(e){case o[0]:t.Register(o[0]),k(a,n);break;case o[1]:t.Register(o[1]),P(a,n)}}};I(o,e=>r.Add(e,l))}})}();