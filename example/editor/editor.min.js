var RichEditor=function(){"use strict";var e=t=>e=>((e=void 0)=>{var t=typeof e;switch(!0){case null===e:return"null";case"object"==t&&Array.isArray(e):return"array";default:return t}})(e)===t;const R=e("array"),l=e("number"),z=e("object"),G=e("string"),j=e("boolean"),$=e("function"),a=e("null"),n=e("undefined");e=Object.freeze({__proto__:null,IsArray:R,IsBoolean:j,IsFunction:$,IsNull:a,IsNumber:l,IsObject:z,IsString:G,IsUndefined:n});const x=e=>R(e)&&0===e.length,P=(t,r)=>{const a=t.length;for(let e=0;e<a;++e)r(t[e],()=>{e=a})},C=(e,t)=>R(e)&&e.includes(t),k=(e,...t)=>e.push(...t);const V=(e,...t)=>e.unshift(...t),J=e=>e.shift(),O=(e,t)=>{var r;let a=!1;for(var n=()=>{a=!0};!(x(e)||(r=J(e))&&(t(r,n),a)););},X=(...e)=>{let t=[];return P(e,e=>{R(e)&&!x(e)&&(t=[...new Set([...t,...e])])}),t};const q=e=>{const t=[];return P(e,e=>V(t,e)),t};const h=e=>e.splice(0,e.length),Z=(t,r)=>{if(R(t))return t.indexOf(r);if($(t[Symbol.iterator])){var a=t.length;for(let e=0;e<a;++e)if(t[e]===r)return e}return-1};const f=(e,t)=>{t=Z(e,t);if(-1!==t)return e.splice(t,1)},S=(e,t)=>{if(!(t<0||t>=e.length))return e.splice(t,1)},A=e=>Array.from(e);var i=Object.freeze({__proto__:null,Clean:h,Compare:(r,a)=>{if(r.length!==a.length)return!1;for(let e=0,t=r.length;e<t;++e)if(r[e]!==a[e])return!1;return!0},CompareAndGetEndIndex:(e,t)=>R(e)&&!x(e)&&R(t)&&!x(t)?e.indexOf(t[t.length-1]):-1,CompareAndGetStartIndex:(e,t)=>R(e)&&!x(e)&&R(t)&&!x(t)?e.indexOf(t[0]):-1,Contains:C,Convert:A,Each:P,Find:Z,FindAndRemove:f,IsEmpty:x,Merge:(...e)=>{let t=[];return P(e,e=>{t=[...t,...e]}),t},MergeUnique:X,Part:(e,t,r)=>e.slice(t,r),Pop:e=>e.pop(),Push:k,Remove:S,Reverse:q,Shift:J,Unshift:V,WhileShift:O});const s=(e,t)=>0===t?e:s(t,e%t),Q=(e,t=2)=>Math.round(e*Math.pow(10,t))/Math.pow(10,t),ee=(e,t)=>e/t*100;var d=Object.freeze({__proto__:null,GCD:s,Percent:ee,RevertPercent:(e,t)=>e*t/100,RoundDecimal:Q});const N=(e,t)=>{if(!z(e))return[];var r=Object.entries(e);if($(t)){const n=r.length;for(let e=0;e<n;++e){var a=r[e];t(a[0],a[1],()=>{e=n})}}return r},te=(e,t)=>{if(!z(e))return[];var r=Object.keys(e);if($(t)){const a=r.length;for(let e=0;e<a;++e)t(r[e],()=>{e=a})}return r},re=(e,t)=>{if(!z(e))return[];var r=Object.values(e);if($(t)){const a=r.length;for(let e=0;e<a;++e)t(r[e],()=>{e=a})}return r},ae=(e,t,r)=>{e=Object.assign(null!=e?e:{});n(e)||a(e)||!z(e)||(e[t]=r)},ne=(e,t)=>{return null==(e=Object.assign(null!=e?e:{}))?void 0:e[t]},b=(e,t)=>{e=null==(e=Object.assign(null!=e?e:{}))?void 0:e[t];return!n(e)&&!a(e)};var oe=Object.freeze({__proto__:null,Entries:N,GetProperty:ne,HasProperty:b,Keys:te,SetProperty:ae,Values:re});const le=/[A-Z]/g,ie=/\B(?=(\d{3})+(?!\d))/g,B=e=>G(e)&&0===e.length,v=e=>e.toString().toLowerCase(),se=e=>e.toString().toUpperCase(),U=(e,t)=>G(t)?e.includes(t):t.test(e),de=(e,t=2,r="0")=>e.toString().padStart(t,r.toString()),p=(e,...t)=>t.join(e),E=(...e)=>p("",...e),ce=e=>!G(e)||B(e)?"":E(se(e.slice(0,1)),e.slice(1,e.length)),ue=(r,e)=>e.trim().split("").reduce((e,t)=>E(e,le.test(t)?E(r,v(t)):t)),ge=(e,t)=>t.trim().split(e).reduce((e,t)=>E(e,ce(t))),he=e=>G(e)&&!B(e)&&le.test(e)?ue("-",e):e,fe=e=>G(e)&&!B(e)&&U(e,"-")?ge("-",e):e,Se=e=>G(e)&&!B(e)&&le.test(e)?ue("_",e):e,me=e=>G(e)&&!B(e)&&U(e,"_")?ge("_",e):e,pe=e=>G(e)&&!B(e)&&le.test(e)?ue(" ",e):e;const Te=e=>{e=e.toString().replace(/[^0-9.]/g,"").split(".");return e[0]=e[0].replace(ie,","),e.length<=2?p(".",...e):p(".",e[0],E(...e.slice(1,e.length)))};var t=Object.freeze({__proto__:null,CapitalToDash:he,CapitalToSpace:pe,CapitalToUnderline:Se,CapitaliseFirst:ce,Commaize:Te,Contains:U,DashToCapital:fe,IsEmpty:B,Join:p,LowerCase:v,Merge:E,Padding:de,SpaceToCapital:e=>G(e)&&!B(e)&&U(e," ")?ge(" ",e):e,UnderlineToCapital:me,UpperCase:se});const Ce={UEID:{}},ve=(e,t=!0)=>{return t?(t=null!=(t=Ce.UEID[e])?t:0,Ce.UEID[e]?++Ce.UEID[e]:Ce.UEID[e]=1,e+"-"+t):e},Ee=()=>{let r=(new Date).getTime();return"xxxyxx-xxxx-xyxxxyxxx".replace(/[xy]/g,e=>{var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"===e?t:3&t|8).toString(16)})};var r=Object.freeze({__proto__:null,CreateUEID:ve,CreateUUID:Ee}),i=Object.freeze({__proto__:null,Arr:i,Formula:d,Obj:oe,Str:t,Type:e,UID:r}),Ie=(()=>{const a={},n=(e,t,r)=>{G(e)&&(a[e]||(a[e]={}),a[e][t]=r)};return{Languages:a,Add:n,AddMap:(r,e)=>N(e,(e,t)=>n(r,e,t)),Get:(e,t)=>{return null!=(e=null==(e=a[e])?void 0:e[t])?e:null},Remove:e=>null===a||void 0===a||delete a[e]}})();const ye={ARABIC:"ar",AMHARIC:"am",BASQUE:"eu",BENGALI:"bn",BULGARIAN:"bg",CATALAN:"ca",CHEROKEE:"chr",CHINESE_PRC:"zh-CN",CHINESE_TAIWAN:"zh-TW",CROATIAN:"hr",CZECH:"cs",DANISH:"da",DUTCH:"nl",ENGLISH_UK:"en-GB",ENGLISH_US:"en",ESTONIAN:"et",FILIPINO:"fil",FINNISH:"fi",FRENCH:"fr",GERMAN:"de",GREEK:"el",GUJARATI:"gu",HEBREW:"iw",HINDI:"hi",HUNGARIAN:"hu",ICELANDIC:"is",INDONESIAN:"id",ITALIAN:"it",JAPANESE:"ja",KANNADA:"kn",KOREAN:"ko",LATVIAN:"lv",LITHUANIAN:"lt",MALAY:"ms",MALAYALAM:"ml",MARATHI:"mr",NORWEGIAN:"no",POLISH:"pl",PORTUGUESE_BRAZIL:"pt-BR",PORTUGUESE_PORTUGAL:"pt-PT",ROMANIAN:"ro",RUSSIAN:"ru",SERBIAN:"sr",SLOVAK:"sk",SLOVENIAN:"sl",SPANISH:"es",SWAHILI:"sw",SWEDISH:"sv",TAMIL:"ta",TELUGU:"te",THAI:"th",TURKISH:"tr",UKRAINIAN:"uk",URDU:"ur",VIETNAMESE:"vi",WELSH:"cy"},Re={am:"Amharic",ar:"Arabic",bg:"Bulgarian",bn:"Bengali",ca:"Catalan",chr:"Cherokee",cs:"Czech",cy:"Welsh",da:"Danish",de:"German",el:"Greek",en:"English (US)","en-GB":"English (UK)",et:"Estonian",eu:"Basque",fi:"Finnish",fil:"Filipino",fr:"French",gu:"Gujarati",hi:"Hindi",hr:"Croatian",hu:"Hungarian",id:"Indonesian",is:"Icelandic",it:"Italian",iw:"Hebrew",ja:"Japanese",kn:"Kannada",ko:"Korean",lt:"Lithuanian",lv:"Latvian",ml:"Malayalam",mr:"Marathi",ms:"Malay",nl:"Dutch",no:"Norwegian",pl:"Polish","pt-BR":"Portuguese (Brazil)","pt-PT":"Portuguese (Portugal)",ro:"Romanian",ru:"Russian",sk:"Slovak",sl:"Slovenian",sr:"Serbian",es:"Spanish",sv:"Swedish",sw:"Swahili",ta:"Tamil",te:"Telugu",th:"Thai",tr:"Turkish",uk:"Ukrainian",ur:"Urdu",vi:"Vietnamese","zh-CN":"Chinese (PRC)","zh-TW":"Chinese (Taiwan)"};d=(()=>{const r=Ie;return{LANGUAGE_CODES:Re,LANGUAGES:ye,Storage:r,Register:(e,t)=>r.AddMap(e,t),Get:(e,t)=>{return null!=(e=r.Get(e,t))?e:null}}})();let Ge=document.baseURI;var Ae,Ne,oe=Ge.split("/"),H=(Ge=oe.slice(0,oe.length-1).join("/"),h(oe),P(document.head.querySelectorAll("script"),(e,t)=>{U(e.src,"editor.")&&(e=e.src.split("/"),Ge=e.slice(0,e.length-1).join("/"),B(Ge)&&(Ge="."),h(e),t())}),(t=Ae=Ae||{}).classic="classic",t.inline="inline",(()=>{const t={};e=["adjustable-edge","adjustable-edge-group","adjustable-line","adjustable-line-group","adjusting","as-text","fake","fixed","focused","icon","horizontal","movable","original-height","original-width","parts-menu","remove","selected","style","type","vertical"],O(e,e=>{t[se(e).replace(/-/g,"_")]=E("editor","-",e)});var e=new URL(Ge).href;const r={PREFIX:e,CSS:""+e,PLUGIN:e+"/plugins",ICON:e+"/icons",LANGUAGE:e+"/langs"};return{PROJECT_NAME:"rich-text-editor",SHORT_NAME:"editor",ATTRIBUTES:t,URLS:r,JoinURL:(e,t)=>{switch(e){case"css":return U(t,".css")||(t+=".min.css"),r.CSS+"/"+t;case"plugin":return U(t,".js")||(t+=`/${t}.min.js`),r.PLUGIN+"/"+t;case"icon":return U(t,".js")||(t+="/icons.min.js"),r.ICON+"/"+t;case"language":return U(t,".js")||(t+=".js"),r.LANGUAGE+"/"+t;default:return r.PREFIX+"/"+t}},GetModeTag:e=>e===Ae.inline?"div":(Ae.classic,"iframe")}})());(e=Ne=Ne||{})[e.UNKNOWN=0]="UNKNOWN",e[e.ELEMENT=1]="ELEMENT",e[e.ATTRIBUTE=2]="ATTRIBUTE",e[e.TEXT=3]="TEXT",e[e.CDATA_SECTION=4]="CDATA_SECTION",e[e.ENTITY_REFERENCE=5]="ENTITY_REFERENCE",e[e.ENTITY=6]="ENTITY",e[e.PROCESSING_INSTRUCTION=7]="PROCESSING_INSTRUCTION",e[e.COMMENT=8]="COMMENT",e[e.DOCUMENT=9]="DOCUMENT",e[e.DOCUMENT_TYPE=10]="DOCUMENT_TYPE",e[e.DOCUMENT_FRAGMENT=11]="DOCUMENT_FRAGMENT",e[e.NOTATION=12]="NOTATION";const be=e=>{return null!=(e=ne(e,"nodeType"))?e:Ne.UNKNOWN};r=t=>e=>be(e)===t;const F=e=>be(e)!==Ne.UNKNOWN,L=r(Ne.ELEMENT),D=(r(Ne.ATTRIBUTE),r(Ne.TEXT)),Ue=(r(Ne.CDATA_SECTION),r(Ne.ENTITY_REFERENCE),r(Ne.ENTITY),r(Ne.PROCESSING_INSTRUCTION),r(Ne.COMMENT),r(Ne.DOCUMENT)),Fe=(r(Ne.DOCUMENT_TYPE),r(Ne.DOCUMENT_FRAGMENT)),Le=(r(Ne.NOTATION),(e,t)=>L(e)?e.getAttribute(t):null),De=(e,t,r)=>{L(e)&&e.setAttribute(he(t),null!=r?r:"")},Oe=(r,e)=>{if(R(e))return P(e,e=>{if(G(e))return De(r,e);N(e,(e,t)=>De(r,e,t))});z(e)&&N(e,(e,t)=>De(r,e,t))},Be=(e,t)=>{L(e)&&e.removeAttribute(he(t))},we=(e,t,r)=>e.insertAdjacentHTML(t,r),xe=(t,...e)=>{(L(t)||F(t))&&P(e,e=>{if(e)return L(t)&&G(e)?we(t,"beforeend",e):void t.appendChild(G(e)?document.createTextNode(e):e)})},Pe=e=>{if(!b(e,"style"))return{};e=e.style.cssText.split(";");const t={};return P(e,e=>{e=e.split(":");2===e.length&&(t[fe(e[0])]=e[1].trim())}),t},ke=(e,t,r)=>{if(b(e,"style")){if(null!=(a=ne(e,"style"))&&a[t])return ae(e.style,t,r);var a=e.style.cssText.split(";");k(a,E(he(t),":",r)),e.style.cssText=p(";",...a)}},He=/(%EF%BB%BF|%0A)/gi,Me=/<!--.*?-->/gs;var We=(()=>{const r=e=>{return v(null!=(e=null==e?void 0:e.nodeName)?e:"")};var e=t=>e=>r(e)===t,t=e("a"),a=e("br"),n=e("iframe"),o=e("img"),l=e("p"),i=e("span"),s=e("textarea"),e=e("video");const d=e=>`[${e}]`,c=e=>{let r="";return N(e,(e,t)=>{r+=d(E(he(e),'="',t,'"'))}),r},u=e=>`[style*="${he(e)}"]`,g=e=>{let r="";return N(e,(e,t)=>{r+=u(E(he(e),B(t)?"":": "+t))}),r},h=(e,r,a)=>{if(G(e))return r(e);if(R(e)){let t="";return P(e,e=>{t+=(G(e)?r:a)(e)}),t}return z(e)?a(e):""},f=e=>{var{tagName:t,id:r,attrs:a,styles:n,bNot:o,children:l}=e;let i=G(t)?t:"";if(o&&(i+=":not("),G(r)&&(i+="#"+r),i+=h(a,d,c),G(e.class)&&(i+=E(".",e.class)),R(e.class)&&P(e.class,e=>{G(e)&&(i+=E(".",e))}),i+=h(n,u,g),o&&(i+=")"),R(t)){const s=[];P(t,e=>k(s,""+e+i)),i=p(",",...s)}return l&&z(l)&&(i+=" "+f(l)),i},S=e=>L(e)&&"parts-tool"===e.getAttribute(H.ATTRIBUTES.FIXED),m=(e,t)=>{let r=e;for(;r;){S(r)&&(r=r.previousElementSibling);var a=null!=(a=t?null===r||void 0===r?void 0:r.firstChild:null===r||void 0===r?void 0:r.lastChild)?a:null;if(!a)break;r=a}return r};return{CreateUEID:(e="",t=!0)=>ve(B(e)?H.PROJECT_NAME:H.PROJECT_NAME+"-"+e,t),GetEmptyString:()=>"&#xfeff;",GetNodeName:r,IsAnchor:t,IsBr:a,IsIFrame:n,IsImage:o,IsParagraph:l,IsSpan:i,IsTextArea:s,IsVideo:e,CreateStyleVariable:(e,t)=>p(" ",E("--",H.SHORT_NAME,"-",e,":"),E(t,";")),WrapTagHTML:(e,t)=>E("<",e,">",t,"</",e,">"),EscapeComments:e=>e.replace(Me,""),IsChildOf:(e,t)=>e===t||t.contains(e),IsTextEmpty:e=>{return!D(e)||B(decodeURI(encodeURI(null!=(e=e.textContent)?e:"").replace(He,"")))},HasChildNodes:e=>{return null!=(e=null==e?void 0:e.hasChildNodes())&&e},CreateAttrSelector:d,CreateAttrSelectorFromMap:c,CreateStyleSelector:u,CreateStyleSelectorFromMap:g,CreateSelector:f,GetFirstChild:(e,t=!1)=>F(e)?t?m(e,!0):S(e.firstChild)?null:e.firstChild:null,GetLastChild:(e,t=!1)=>F(e)?t?m(e,!1):S(e.lastChild)?e.lastChild.previousElementSibling:e.lastChild:null}})(),Ke=(()=>{const n="table",o="tr",a=new Set(["th","td"]),l=p(",",...a),i=e=>!!F(e)&&We.GetNodeName(e)===n,s=e=>!!F(e)&&We.GetNodeName(e)===o;const e=t=>{var e=A(t.querySelectorAll(o));const r=[];return O(e,e=>{e&&e.closest(n)===t&&k(r,e)}),r},S=t=>{if(!L(t)||!i(t)&&!s(t))return[];const r=s(t)?o:n;var e=A(t.querySelectorAll(l));const a=[];return O(e,e=>{e&&e.closest(r)===t&&k(a,e)}),a};const r=(e,t)=>e?t.setAttribute(H.ATTRIBUTES.SELECTED,""):t.removeAttribute(H.ATTRIBUTES.SELECTED);return{Selector:n,RowSelector:o,CellSet:a,CellSelector:l,Is:i,IsRow:s,IsCell:e=>!!F(e)&&a.has(We.GetNodeName(e)),FindClosest:e=>L(e)?e.closest(n):null,FindClosestRow:e=>L(e)?e.closest(o):null,FindClosestCell:e=>L(e)?e.closest(l):null,Find:e=>{var t=L(e);return{Table:t?e.closest(n):null,Row:t?e.closest(o):null,Cell:t?e.closest(l):null}},GetAllOwnRows:e,GetAllOwnCells:S,GetSelectedCells:(e,t,r=!0)=>e.DOM.SelectAll({tagName:[...a],attrs:[H.ATTRIBUTES.SELECTED],bNot:!r},null!=t?t:e.GetBody()),ToggleSelectCell:r,ToggleSelectMultipleCells:(t,e)=>P(e,e=>r(t,e)),GetGridWithIndex:(n,t)=>{var r=[],o=[];const l=e(n);let i=-1,s=-1;for(let a=0,e=l.length;a<e;++a){var d=l[a],c=S(null!=d?d:n);const f=[];for(let r=0,e=c.length;r<e;++r){var u=c[r],g=parseInt(null!=(h=Le(u,"colspan"))?h:"0"),h=parseInt(null!=(h=Le(u,"rowspan"))?h:"0");if(!g||g<=1)k(f,u);else for(let e=0;e<g;++e)k(f,u);1<h&&k(o,[a+1,a+h-1,r]),x(o)||P(o,e=>{var t;a<e[0]||a>e[1]||r!==e[2]||(t=S(null!=(t=l[e[0]-1])?t:n)[e[2]])&&V(f,t)})}t&&-1===s&&(i=a,s=Z(f,t)),k(r,f)}return{Grid:r,TargetCellRowIndex:i,TargetCellIndex:s}}}})(),oe=(()=>{const r="figure",e={media:new Set(["img","audio","video","iframe"]),table:new Set([Ke.Selector]),hr:new Set(["hr"])},a={media:p(",",...e.media),table:Ke.Selector,hr:"hr"},t=e=>C(te(a),e),n=a=>{if(t(a))return a;let n=a;return N(e,(e,t,r)=>{t.has(a)&&(n=e,r())}),n};const o=e=>{var t;return e&&L(e)&&(t=Le(e,"type"))?e.querySelector(a[t]||t):null};const l=e=>L(e)?e.closest(r):null;return{Selector:r,FigureTypeSetMap:e,FigureTypeMap:a,HasType:t,FindType:n,Create:e=>{var t=document.createElement(r);return Oe(t,{type:n(e),contenteditable:"false"}),t},SelectFigureElement:o,Find:e=>{e=L(e)?e.closest(r):null;return{Figure:e,FigureType:Le(e,"type"),FigureElement:o(e)}},Is:e=>!!F(e)&&We.GetNodeName(e)===r,FindClosest:l,Remove:(e,t)=>{var r,a,n,o=e.DOM,t=l(t);t&&(r=e.Utils.Range(),t.nextElementSibling?(a=o.Utils.GetFirstChild(t.nextElementSibling,!0))&&r.SetStartToEnd(a,0,0):t.previousElementSibling&&(a=o.Utils.GetLastChild(t.previousElementSibling,!0),n=D(a)?a.length:0,a)&&r.SetStartToEnd(a,n,n),o.Remove(t,!0),e.Utils.Caret.UpdateRange(r),e.Utils.Shared.DispatchCaretChange())}}})(),_e={Figure:oe,Table:Ke},Ye=(()=>{const o={},a="editor-boundary-id",l=e=>b(e,a),i=e=>{var t=l(e),r=null!=(r=ne(e,a))?r:Ee();return t||ae(e,a,r),r};const s=(e,t,r)=>{var a=J(r);$(a)&&(e.removeEventListener(t,a),s(e,t,r))},t=(r,e)=>{if(l(r)){var t,a=i(r),n=o[a];if(n){if(G(e))return t=n.eventMap[e],s(r,e,t);N(n.eventMap,(e,t)=>s(r,e,t)),null!==o&&void 0!==o&&delete o[a]}}};return{Boundaries:o,Bind:(e,t,r)=>{var a=i(e);o[a]||(o[a]={element:e,eventMap:{}}),o[a].eventMap[t]||(o[a].eventMap[t]=[]),k(o[a].eventMap[t],r),e.addEventListener(t,r)},Unbind:(t,r,a)=>{if(l(t)){var e=i(t),n=null==(e=o[e])?void 0:e.eventMap[r];if(n){let e=Z(n,a);for(;-1!==e;)S(n,e),t.removeEventListener(r,a),e=Z(n,a)}}},UnbindAll:t,FindAndUnbindDetached:()=>new Promise(e=>{O(re(o),e=>{L(e.element)&&!e.element.ownerDocument.contains(e.element)&&t(e.element)}),e()}),Destroy:()=>re(o,e=>t(e.element))}})();const ze=o=>{var e;const a=null!=(e=o.document)?e:document,l=We,n=Ye;const r=e=>L(e)||Fe(e)?e:o.bEditor?(o.bSelfBody?a:o).body:a;const i=(e,t,r)=>De(e,t,r),s=(e,t)=>Oe(e,t),d=(e,t,r)=>{return e=e,t=t,r=r,G(r)?Le(e,t)===r:!!L(e)&&(null==e?void 0:e.hasAttribute(t))},c=(e,t)=>Be(e,t);const u=(t,...e)=>{L(t)&&P(e,e=>{e&&!B(e)&&t.classList.add(e)})};const g=e=>{return e=e,null!=(e=null==(e=ne(e,"style"))?void 0:e.cssText)?e:""};const t=(e,t,r)=>{return e=e,t=t,r=r,b(e,"style")?(a=window.getComputedStyle(e),t=fe(t),r?null!=(r=ne(a,t))?r:"":(r=Pe(e))[t]?null!=(e=r[t])?e:"":null!=(r=ne(a,t))?r:""):"";var a},h=(e,t)=>{if(b(e,"style"))return B(t)?Be(e,"style"):void(e.style.cssText=t)},f=(e,t,r)=>{ke(e,t,r),o.bEditor&&i(e,H.ATTRIBUTES.STYLE,g(e))},S=(e,t)=>{var r;r=e,t=t,N(t,(e,t)=>ke(r,e,t)),o.bEditor&&i(e,H.ATTRIBUTES.STYLE,g(e))},m=(e,t)=>{var r=e;if(b(r,"style"))if(b(r.style,t))ae(r.style,t,""),B(r.style.cssText)&&Be(r,"style");else{var a=Pe(r);const n=he(t);a[n]&&(r.style.cssText="",N(a,(e,t)=>{e!==n&&(r.style.cssText+=e+`: ${t};`)}),B(r.style.cssText))&&Be(r,"style")}if(o.bEditor)return B(g(e))?c(e,H.ATTRIBUTES.STYLE):void i(e,H.ATTRIBUTES.STYLE,g(e))};const p=e=>decodeURI(encodeURI(e).replace(He,""));const T=(e,t)=>ae(e,"innerHTML",t);const C=(e,...t)=>xe(e,...t);const v=(e,t)=>e.cloneNode(t);const E=(e,t)=>{return!L(e)||(t=G(t)?t:l.CreateSelector(t),B(t))||!(e=e.closest(t))||d(e,"id",l.CreateUEID("editor-body",!1))?null:e};const I=(e,t=!0)=>L(e)?!0===t?A(e.children):e.children:[];const y=(e,t=!1)=>{e=I(e);x(e)||(P(e,e=>n.UnbindAll(e)),t&&P(e,e=>{y(e,t),e.remove()}))};return{Doc:a,Utils:l,EventUtils:n,Element:_e,New:e=>ze(e),GetRoot:()=>a.documentElement,Select:(e,t)=>r(t).querySelector(G(e)?e:l.CreateSelector(e)),SelectAll:(e,t)=>A(r(t).querySelectorAll(G(e)?e:l.CreateSelector(e))),GetAttr:(e,t)=>Le(e,t),SetAttr:i,SetAttrs:s,HasAttr:d,RemoveAttr:c,RemoveAttrs:(t,...e)=>P(e,e=>c(t,e)),AddClass:u,HasClass:(e,t)=>!!L(e)&&e.classList.contains(t),RemoveClass:(e,...t)=>{L(e)&&e.classList.remove(...t)},GetStyleText:g,GetStyles:e=>Pe(e),GetStyle:t,SetStyleText:h,SetStyle:f,SetStyles:S,RemoveStyle:m,RemoveStyles:(t,...e)=>P(e,e=>m(t,e)),HasStyle:(e,t,r)=>{return!(!L(e)||!G(t)||(a=e,n=t,o=r,!b(a,"style")))&&(a=a.style.cssText.replace(/\s*:\s*/gi,":"),o?!!G(o)&&U(a,he(n)+":"+o.trim()):U(a,he(n)));var a,n,o},GetRect:e=>L(e)?e.getClientRects()[0]:null,GetText:e=>{return p(null!=(e=ne(e,"innerText"))?e:"")},GetHTML:e=>{return p(null!=(e=ne(e,"innerHTML"))?e:"")},GetOuterHTML:e=>{return p(null!=(e=ne(e,"outerHTML"))?e:"")},SetText:(e,t)=>ae(e,"innerText",t),SetHTML:T,SetOuterHTML:(e,t)=>ae(e,"outerHTML",t),InsertBefore:(e,...t)=>{var r;[r,...e]=[e,...t],(L(r)||F(r))&&P(e,e=>{if(e)return L(r)&&G(e)?we(r,"beforebegin",e):void r.before(e)})},InsertFirst:(e,...t)=>{var r;[r,...e]=[e,...t],(L(r)||F(r))&&P(q(e),e=>{if(e)return L(r)&&G(e)?we(r,"afterbegin",e):r.firstChild?r.firstChild.before(e):void r.appendChild(G(e)?document.createTextNode(e):e)})},Insert:C,InsertAfter:(e,...t)=>{var r;[r,...e]=[e,...t],(L(r)||F(r))&&P(e,e=>{if(e)return L(r)&&G(e)?we(r,"afterend",e):void r.after(e)})},Clone:v,CloneAndInsert:(t,r,...e)=>{(L(t)||F(t))&&P(e,e=>{e&&C(t,G(e)?e:v(e,r))})},Closest:E,ClosestByStyle:(e,t)=>G(t)||R(t)||z(t)?E(e,l.CreateSelector({styles:t})):null,IsEditable:e=>d(e,"contenteditable","true"),GetParents:(e,t=!1)=>{if(!F(e)||d(e,"id",l.CreateUEID("editor-body",!1)))return[];var r=[],a=t?k:V;let n=e;for(D(e)||a(r,e);(n=n.parentNode)&&F(n)&&!d(n,"id",l.CreateUEID("editor-body",!1));)a(r,n);return r},GetChildNodes:(e,t=!0)=>e?!0===t?A(e.childNodes):e.childNodes:[],GetChildren:I,On:(e,t,r)=>n.Bind(e,t,r),Off:(e,t,r)=>n.Unbind(e,t,r),Dispatch:(e,t)=>{var r;r=e,(b(r,"Window")||Ue(e)||L(e))&&G(t)&&(r=new CustomEvent(t),e.dispatchEvent(r))},Show:(e,t)=>G(t)?f(e,"display",t):m(e,"display"),Hide:e=>f(e,"display","none"),IsHidden:e=>"none"===t(e,"display"),CreateFragment:()=>a.createDocumentFragment(),CreateTextNode:e=>a.createTextNode(e),Create:(e,t)=>{const r=a.createElement(e);return t&&(t.attrs&&(R(t.attrs)||z(t.attrs))&&s(r,t.attrs),t.styles&&z(t.styles)?S(r,t.styles):t.styles&&G(t.styles)&&h(r,t.styles),t.class&&G(t.class)?r.className=t.class:t.class&&R(t.class)&&u(r,...t.class),t.html&&G(t.html)&&T(r,t.html),t.children)&&R(t.children)&&P(t.children,e=>C(r,e)),r},RemoveChildren:y,Remove:(e,t=!1)=>{L(e)?(n.UnbindAll(e),t&&y(e,t),e.remove()):b(e,"remove")&&e.remove()}}};var I,je,y,w,M=ze({bEditor:!1}),$e={Destroy:e=>{M.EventUtils.Destroy(),e.IsIFrame()&&M.Remove(e.DOM.GetRoot()),M.Remove(e.Frame.Root,!0)}};(t=I=I||{}).abort="abort",t.animationcancel="animationcancel",t.animationend="animationend",t.animationiteration="animationiteration",t.animationstart="animationstart",t.auxclick="auxclick",t.beforeinput="beforeinput",t.blur="blur",t.cancel="cancel",t.canplay="canplay",t.canplaythrough="canplaythrough",t.change="change",t.click="click",t.close="close",t.compositionend="compositionend",t.compositionstart="compositionstart",t.compositionupdate="compositionupdate",t.contextmenu="contextmenu",t.copy="copy",t.cuechange="cuechange",t.cut="cut",t.dblclick="dblclick",t.drag="drag",t.dragend="dragend",t.dragenter="dragenter",t.dragleave="dragleave",t.dragover="dragover",t.dragstart="dragstart",t.drop="drop",t.durationchange="durationchange",t.emptied="emptied",t.ended="ended",t.error="error",t.focus="focus",t.focusin="focusin",t.focusout="focusout",t.formdata="formdata",t.gotpointercapture="gotpointercapture",t.input="input",t.invalid="invalid",t.keydown="keydown",t.keypress="keypress",t.keyup="keyup",t.load="load",t.loadeddata="loadeddata",t.loadedmetadata="loadedmetadata",t.loadstart="loadstart",t.lostpointercapture="lostpointercapture",t.mousedown="mousedown",t.mouseenter="mouseenter",t.mouseleave="mouseleave",t.mousemove="mousemove",t.mouseout="mouseout",t.mouseover="mouseover",t.mouseup="mouseup",t.paste="paste",t.pause="pause",t.play="play",t.playing="playing",t.pointercancel="pointercancel",t.pointerdown="pointerdown",t.pointerenter="pointerenter",t.pointerleave="pointerleave",t.pointermove="pointermove",t.pointerout="pointerout",t.pointerover="pointerover",t.pointerup="pointerup",t.progress="progress",t.ratechange="ratechange",t.reset="reset",t.resize="resize",t.scroll="scroll",t.securitypolicyviolation="securitypolicyviolation",t.seeked="seeked",t.seeking="seeking",t.select="select",t.selectionchange="selectionchange",t.selectstart="selectstart",t.slotchange="slotchange",t.stalled="stalled",t.submit="submit",t.suspend="suspend",t.timeupdate="timeupdate",t.toggle="toggle",t.touchcancel="touchcancel",t.touchend="touchend",t.touchmove="touchmove",t.touchstart="touchstart",t.transitioncancel="transitioncancel",t.transitionend="transitionend",t.transitionrun="transitionrun",t.transitionstart="transitionstart",t.volumechange="volumechange",t.waiting="waiting",t.webkitanimationend="webkitanimationend",t.webkitanimationiteration="webkitanimationiteration",t.webkitanimationstart="webkitanimationstart",t.webkittransitionend="webkittransitionend",t.wheel="wheel",(e=je=je||{}).insertText="insertText",e.insertReplacementText="insertReplacementText",e.insertLineBreak="insertLineBreak",e.insertParagraph="insertParagraph",e.insertOrderedList="insertOrderedList",e.insertUnorderedList="insertUnorderedList",e.insertHorizontalRule="insertHorizontalRule",e.insertFromYank="insertFromYank",e.insertFromDrop="insertFromDrop",e.insertFromPaste="insertFromPaste",e.insertTranspose="insertTranspose",e.insertCompositionText="insertCompositionText",e.insertFromComposition="insertFromComposition",e.insertLink="insertLink",e.deleteByComposition="deleteByComposition",e.deleteCompositionText="deleteCompositionText",e.deleteWordBackward="deleteWordBackward",e.deleteWordForward="deleteWordForward",e.deleteSoftLineBackward="deleteSoftLineBackward",e.deleteSoftLineForward="deleteSoftLineForward",e.deleteEntireSoftLine="deleteEntireSoftLine",e.deleteHardLineBackward="deleteHardLineBackward",e.deleteHardLineForward="deleteHardLineForward",e.deleteByDrag="deleteByDrag",e.deleteByCut="deleteByCut",e.deleteByContent="deleteByContent",e.deleteContentBackward="deleteContentBackward",e.deleteContentForward="deleteContentForward",e.historyUndo="historyUndo",e.historyRedo="historyRedo",e.formatBold="formatBold",e.formatItalic="formatItalic",e.formatUnderline="formatUnderline",e.formatStrikethrough="formatStrikethrough",e.formatSuperscript="formatSuperscript",e.formatSubscript="formatSubscript",e.formatJustifyFull="formatJustifyFull",e.formatJustifyCenter="formatJustifyCenter",e.formatJustifyRight="formatJustifyRight",e.formatJustifyLeft="formatJustifyLeft",e.formatIndent="formatIndent",e.formatOutdent="formatOutdent",e.formatRemove="formatRemove",e.formatSetBlockTextDirection="formatSetBlockTextDirection",e.formatSetInlineTextDirection="formatSetInlineTextDirection",e.formatBackColor="formatBackColor",e.formatFontColor="formatFontColor",e.formatFontName="formatFontName";const c=(t,e,r)=>t.On(e,e=>r(t,e)),W=e=>{e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()},Ve=((r=y=y||{}).ArrowUp="ArrowUp",r.ArrowDown="ArrowDown",r.ArrowLeft="ArrowLeft",r.ArrowRight="ArrowRight",r.Backspace="Backspace",r.Delete="Delete",r.Home="Home",r.End="End",r.PageUp="PageUp",r.PageDown="PageDown",r.Tab="Tab",r.Enter="Enter",r.Digit0="Digit0",r.Digit1="Digit1",r.Digit2="Digit2",r.Digit3="Digit3",r.Digit4="Digit4",r.Digit5="Digit5",r.Digit6="Digit6",r.Digit7="Digit7",r.Digit8="Digit8",r.Digit9="Digit9",r.KeyA="KeyA",r.KeyB="KeyB",r.KeyC="KeyC",r.KeyD="KeyD",r.KeyE="KeyE",r.KeyF="KeyF",r.KeyG="KeyG",r.KeyH="KeyH",r.KeyI="KeyI",r.KeyJ="KeyJ",r.KeyK="KeyK",r.KeyL="KeyL",r.KeyM="KeyM",r.KeyN="KeyN",r.KeyO="KeyO",r.KeyP="KeyP",r.KeyQ="KeyQ",r.KeyR="KeyR",r.KeyS="KeyS",r.KeyT="KeyT",r.KeyU="KeyU",r.KeyV="KeyV",r.KeyW="KeyW",r.KeyX="KeyX",r.KeyY="KeyY",r.KeyZ="KeyZ",(e,t,r,a)=>{c(e,t,(e,t)=>{t.key!==r&&t.code!==r||a(e,t)})}),Je=(e,t,a,r,n)=>{const{bCtrl:o,bAlt:l,bShift:i,bPrevent:s}=r,d=(e,t)=>j(e)?e&&!t||!e&&t:t;c(e,t,(e,t)=>{var r;t.key!==a&&t.code!==a||(r=t,d(o,r.ctrlKey))||d(l,r.altKey)||d(i,r.shiftKey)||(j(s)&&s&&W(r),0)||n(e,t)})};(t=w=w||{}).BLOCK="BLOCK",t.INLINE="INLINE",t.STYLE="STYLE",t.LIST="LIST";e=E(oe.Selector,`:not([type="${Ke.Selector}"])`);const Xe=new Set(["ol","ul"]),qe=p(",",...Xe),Ze="li",m={Figures:new Set([oe.Selector,...oe.FigureTypeSetMap.media,...oe.FigureTypeSetMap.hr]),Table:new Set([Ke.Selector]),TableItems:new Set([...Ke.CellSet,Ke.RowSelector]),Block:new Set(["p","div","blockquote","pre","h1","h2","h3","h4","h5","h6"]),List:new Set([Ze,...Xe]),FollowingItems:new Set([Ze,...Ke.CellSet]),Focusable:new Set(["code","a"])},o=new Set([e,...oe.FigureTypeSetMap.media,...oe.FigureTypeSetMap.hr]),Qe=new Set([...m.Figures,...m.Table]);r=new Set([...m.TableItems,...m.List]);const et=new Set([...m.Block,...r]),tt=new Set([oe.Selector,...m.Table,...m.TableItems,...m.Block,...m.List]),K={Bold:[{Type:w.INLINE,Tag:"strong",DisableList:o},{Type:w.INLINE,Tag:"span",Styles:{fontWeight:"bold"}},{Type:w.INLINE,Tag:"b"}],Italic:[{Type:w.INLINE,Tag:"em",DisableList:o},{Type:w.INLINE,Tag:"span",Styles:{fontStyle:"italic"}},{Type:w.INLINE,Tag:"i"}],Strikethrough:[{Type:w.INLINE,Tag:"s",DisableList:o},{Type:w.INLINE,Tag:"span",Styles:{fontStyle:"italic"}},{Type:w.INLINE,Tag:"strike"}],Subscript:{Type:w.INLINE,Tag:"sub",SameFormats:["Superscript","FontSize"],DisableList:o},Superscript:{Type:w.INLINE,Tag:"sup",SameFormats:["Subscript","FontSize"],DisableList:o},Underline:[{Type:w.INLINE,Tag:"span",Styles:{textDecoration:"underline"},DisableList:o},{Type:w.INLINE,Tag:"u"}],Code:{Type:w.INLINE,Tag:"code",DisableList:o},FontSize:{Type:w.INLINE,Tag:"span",Styles:{fontSize:"{{value}}"},SameFormats:["Superscript","Subscript"],DisableList:o},FontFamily:{Type:w.INLINE,Tag:"span",Styles:{fontFamily:"{{value}}"},DisableList:o},ForeColor:{Type:w.INLINE,Tag:"span",Styles:{color:"{{value}}"},DisableList:o},BackColor:{Type:w.INLINE,Tag:"span",Styles:{backgroundColor:"{{value}}"},DisableList:o},Outdent:{Type:w.STYLE,StrictFormats:new Set([oe.Selector,...et]),Styles:{marginLeft:"{{value}}"},DisableList:o},Indent:{Type:w.STYLE,StrictFormats:new Set([oe.Selector,...et]),Styles:{marginLeft:"{{value}}"},DisableList:o},Justify:{Type:w.STYLE,StrictFormats:new Set([...et]),Styles:{textAlign:"justify"},SameStyles:["margin-left","margin-right","float"],DisableList:o},AlignLeft:[{Type:w.STYLE,StrictFormats:new Set,Styles:{},DisableList:o},{Type:w.STYLE,StrictFormats:et,Styles:{textAlign:"left"},SameStyles:["margin-left","margin-right","float"]},{Type:w.STYLE,StrictFormats:m.Table,Styles:{marginLeft:"0px",marginRight:"auto"},SameStyles:["text-align","float"]},{Type:w.STYLE,StrictFormats:m.Figures,Styles:{marginLeft:"0px",marginRight:"auto"},SameStyles:["text-align","float"]}],AlignCenter:[{Type:w.STYLE,StrictFormats:new Set,Styles:{},DisableList:o},{Type:w.STYLE,StrictFormats:et,Styles:{textAlign:"center"},SameStyles:["margin-left","margin-right","float"]},{Type:w.STYLE,StrictFormats:m.Table,Styles:{marginLeft:"auto",marginRight:"auto"},SameStyles:["text-align","float"]},{Type:w.STYLE,StrictFormats:m.Figures,Styles:{marginLeft:"auto",marginRight:"auto"},SameStyles:["text-align","float"]}],AlignRight:[{Type:w.STYLE,StrictFormats:new Set,Styles:{},DisableList:o},{Type:w.STYLE,StrictFormats:et,Styles:{textAlign:"right"},SameStyles:["margin-left","margin-right","float"]},{Type:w.STYLE,StrictFormats:m.Table,Styles:{marginLeft:"auto",marginRight:"0px"},SameStyles:["text-align","float"]},{Type:w.STYLE,StrictFormats:m.Figures,Styles:{marginLeft:"auto",marginRight:"0px"},SameStyles:["text-align","float"]}],Paragraph:{Type:w.BLOCK,Tag:"p",Switchable:m.Block,AddInside:r},Heading1:{Type:w.BLOCK,Tag:"h1",Switchable:m.Block,AddInside:r,UnsetSwitcher:"p"},Heading2:{Type:w.BLOCK,Tag:"h2",Switchable:m.Block,AddInside:r,UnsetSwitcher:"p"},Heading3:{Type:w.BLOCK,Tag:"h3",Switchable:m.Block,AddInside:r,UnsetSwitcher:"p"},Heading4:{Type:w.BLOCK,Tag:"h4",Switchable:m.Block,AddInside:r,UnsetSwitcher:"p"},Heading5:{Type:w.BLOCK,Tag:"h5",Switchable:m.Block,AddInside:r,UnsetSwitcher:"p"},Heading6:{Type:w.BLOCK,Tag:"h6",Switchable:m.Block,AddInside:r,UnsetSwitcher:"p"},Div:{Type:w.BLOCK,Tag:"div",Switchable:m.Block,AddInside:r,UnsetSwitcher:"p"},Blockquote:{Type:w.BLOCK,Tag:"blockquote",Switchable:m.Block,AddInside:r,UnsetSwitcher:"p"},Pre:{Type:w.BLOCK,Tag:"pre",Switchable:m.Block,AddInside:r,UnsetSwitcher:"p"}};var _=(()=>{const e=e=>e+"px";const s=e=>D(e)?e.parentElement:e,d=(e,t,r)=>{var a=M.Create("span",{attrs:["marker"]}),n=M.Create("span",{attrs:["marker"]}),r=(M.InsertBefore(t.Start.Node,a),M.InsertAfter(t.End.Node,n),r(),e.Utils.Range());a.nextSibling&&n.previousSibling&&(r.SetStart(a.nextSibling,t.Start.Offset),r.SetEnd(n.previousSibling,t.End.Offset),e.Utils.Caret.UpdateRange(r)),M.Remove(a),M.Remove(n)},c=(e,t)=>{const n=e.DOM.SelectAll({attrs:"caret"}),r=e=>P(e,e=>{var t;!(r=>{let a=!r||M.Utils.IsBr(r)||M.Utils.IsBr(M.Utils.GetFirstChild(r,!0))||M.HasAttr(r,"caret")||M.HasAttr(r,"marker")||M.Element.Figure.Is(r)||tt.has(M.Utils.GetNodeName(r));return r&&P(n,(e,t)=>{M.Utils.IsChildOf(e,r)&&(a=!0,t())}),a})(e)&&(D(e)||r(M.GetChildNodes(e)),t=e,D(t)&&B(t.textContent)||!D(t)&&B(M.GetText(t)))&&M.Remove(e,!1)}),a=(r(t),e.DOM.SelectAll("a"));O(a,e=>{var t=e.nextSibling;t&&M.Utils.IsAnchor(t)&&t.href===e.href&&(M.Insert(e,...M.GetChildNodes(t)),f(a,t),M.Remove(t),V(a,e))})},u=(e,t)=>{if(t){const l=e;var e=s(t.Start.Node),r=s(t.End.Node),a=p(",",...m.Block),n=p(",",...m.FollowingItems),e=null!=(o=null!=(o=M.Closest(e,a))?o:M.Closest(e,n))?o:t.Start.Path[0],o=null!=(a=null!=(o=M.Closest(r,a))?o:M.Closest(r,n))?a:t.End.Path[0];if(e===o)return M.Element.Figure.Is(e)?void 0:c(l,M.GetChildNodes(e));const i=[];M.Element.Figure.Is(e)||k(i,...M.GetChildNodes(e)),M.Element.Figure.Is(o)||k(i,...M.GetChildNodes(o)),d(l,t,()=>c(l,i))}};const l=(e,t,r=!1)=>{var a=[];let n=e;for(var o=e=>r?e.previousSibling:e.nextSibling;n&&(n.parentNode!==t||o(n));)o(n)?(n=o(n))&&k(a,n):n=n.parentNode;return a};const g=(e,t)=>{t=s(t.Start.Node);return!!M.Element.Figure.Is(t)&&(e.Utils.Shared.DispatchCaretChange([t]),!0)};return{GetPixelString:e,GetPixcelFromRoot:()=>"16px",ConvertPointsToPixel:e=>Q(e*(1/.75)),ConvertPixelToPoints:e=>Q(.75*e),MultiplyPixelSize:e=>16*e,GetFormatName:(e,r)=>{var a=v(e);for(let e=0,t=r.length;e<t;++e){var n=r[e];if(a===v(Se(n))||a===v(n))return n}return""},HasFormatName:(e,r)=>{var a=v(e);for(let e=0,t=r.length;e<t;++e){var n=r[e];if(a===v(Se(n))||a===v(n))return!0}return!1},GetFormatConfig:(e,t,r)=>{return e.Config[r]||t},LabelConfigArray:e=>{const t={};return P(e,e=>{t[e]=e}),t},GetParentIfText:s,DoWithShallowMarking:d,CleanDirty:c,CleanDirtyWithCaret:u,RunFormatting:(e,t)=>{var r=(e=>{const r=e;if(!x(M.Element.Table.GetSelectedCells(r)))return null;e=r.Utils.Caret.Get();if(!e)return null;var t=()=>{var e=M.Utils.CreateUEID("marker");return[e,r.DOM.Create("span",{attrs:[{id:e},"marker"]})]},a=(e,t)=>{var t=(t?M.Utils.GetFirstChild:M.Utils.GetLastChild)(e,!0);return t||(t=r.DOM.Create("br"),M.Insert(e,t),t)};let n=e.Start.Node,o=e.End.Node;var l=M.Utils.GetNodeName(n),i=M.Utils.GetNodeName(o);if(m.Figures.has(l)||m.Figures.has(i)){var s=t();if(M.Element.Figure.Is(n)||M.Element.Figure.Is(o)){var d=M.Element.Figure.Find(n)["FigureElement"];if(!d)return null;n=d}return M.InsertBefore(n,s[1]),{bRange:!1,Marker:s[0],Offset:0}}return m.Block.has(l)&&(n=a(n,!0)),m.Block.has(i)&&(o=a(o,!1)),e.IsRange()?(d=t(),s=t(),M.InsertBefore(n,d[1]),M.InsertAfter(o,s[1]),{bRange:!0,StartMarker:d[0],StartOffset:e.Start.Offset,EndMarker:s[0],EndOffset:e.End.Offset}):(l=t(),M.InsertBefore(n,l[1]),{bRange:!1,Marker:l[0],Offset:e.Start.Offset})})(e),t=(t(),e);if(r){const l=t,i=e=>{if(D(e))return e;let t=e;for(;t&&!D(t)&&!M.Utils.IsBr(t);){var r=M.Utils.GetFirstChild(t);if(!r)break;t=r}return t};var a,t=(e,t=!1)=>{var e=l.DOM.Select({id:e}),r=t?e.previousSibling:e.nextSibling,a=e=>m.Figures.has(M.Utils.GetNodeName(e))?e.parentNode&&!M.Element.Figure.Is(e)?e.parentNode:e:i(e);if(r)return a(r);let n=e;for(;n&&n!==l.GetBody();){var o=t?n.previousSibling:n.nextSibling;if(o){n=o;break}n=n.parentNode}return n?a(n):i(e)},n=l.Utils.Range(),o=(r.bRange?(a=t(r.StartMarker),o=t(r.EndMarker,!0),n.SetStart(a,r.StartOffset),n.SetEnd(o,r.EndOffset)):(a=t(r.Marker),n.SetStartToEnd(a,r.Offset,r.Offset)),l.Utils.Caret.UpdateRange(n),l.DOM.SelectAll({attrs:["marker"]}));P(o,e=>{let t=e;for(;null!==t&&void 0!==t&&t.parentElement&&t!==l.GetBody()&&1===M.GetChildNodes(t.parentElement,!1).length;)t=t.parentElement;M.Remove(null!==t&&void 0!==t?t:e)})}u(e,e.Utils.Caret.Get())},SplitTextNode:(e,t,r,a)=>{var n,o,l;return D(t)&&(e=e,n=t.parentNode,o=t.textContent,n)&&o?(l=e.DOM.CreateTextNode(o.slice(0,r)),r=e.DOM.CreateTextNode(o.slice(r,a)),a=e.DOM.CreateTextNode(o.slice(a,o.length)),o=0<l.length,e=e.DOM.CreateFragment(),0<l.length&&e.append(l),0<r.length&&e.append(r),0<a.length&&e.append(a),l=M.GetChildNodes(n,!1),r=Z(l,t)+(o?1:0),n.replaceChild(e,t),l[r]):null},GetStyleSelectorMap:(e,r)=>{const a=[],n={};return N(e,(e,t)=>{if("{{value}}"===t)return r?void(n[e]=r):k(a,e);n[e]=t}),k(a,n),a},ExceptNodes:(e,t,r,a=!1)=>{var n,o=M.Element.Table.FindClosest(s(r));return o?(n=[],k(n,...M.Element.Table.GetSelectedCells(e,o,!1),...l(t,r,a)),n):l(t,r,a)},LeaveProcessorIfFigure:g,SerialiseWithProcessors:(e,t)=>{const r=e;e=r.Utils.Caret;const{bWrap:a,value:n,tableProcessor:o,processors:l,after:i}=t;if(r.Focus(),!o(a,n)){r.GetBody().normalize();const s=e.Get();!s||g(r,s)||(P(l,(e,t)=>{e.processor(a,s,n)&&(e.bSkipFocus||r.Focus(),t())}),$(i)&&i(s),r.GetBody().normalize())}}}})();const rt=(e,u)=>{const l=e,g=l.DOM,h=l.Formatter.Toggler,i=(r,a)=>{var n=e=>{var{Tag:e,Styles:t}=e;if(!t&&g.Closest(r,e))return!0;if(t){e=_.GetStyleSelectorMap(t,a);if(g.ClosestByStyle(r,e))return!0}return!1};if(!R(u))return n(u);for(let e=0,t=u.length;e<t;++e)if(n(u[e]))return!0;return!1},r=(t,r)=>{var e=g.Element.Table.GetSelectedCells(l);return!x(e)&&(P(e,e=>h.ToggleRecursive(t,u,e,{value:r})),!0)},a=(e,t,r)=>{var a,n;return!(!t.IsRange()||t.Start.Node!==t.End.Node||(a=t.Start.Node,n=i(_.GetParentIfText(a),r),e&&n)||!e&&!n||(n=_.SplitTextNode(l,a,t.Start.Offset,t.End.Offset),!D(n))||(t.Range.SetStartToEnd(n,0,n.length),h.Toggle(e,u,n,r),0))},s=(e,t,r,a,n=!1)=>{var o=_.GetParentIfText(t),o=i(o,a),a=t.textContent;return!(e&&o||!e&&!o)&&a&&_.SplitTextNode(l,t,n?r:0,n?a.length:r)||t},n=(e,t,r)=>{var a,n,o;return!(!t.IsRange()||t.Start.Node===t.End.Node||(a=s(e,t.Start.Node,t.Start.Offset,r,!0),n=s(e,t.End.Node,t.End.Offset,r),t.Range.SetStart(a,a===t.Start.Node?t.Start.Offset:0),t.Range.SetEnd(n,n===t.End.Node?t.End.Offset:null!=(o=null==(o=n.textContent)?void 0:o.length)?o:0),o={except:X(_.ExceptNodes(l,a,t.SameRoot,!0),_.ExceptNodes(l,n,t.SameRoot)),endNode:n,value:r,bInline:!0},h.ToggleRecursive(e,u,t.SameRoot,o),0))},f=e=>{var t;const r=e.Start.Node;var a=e.Start.Offset,n=g.Closest(_.GetParentIfText(r),{attrs:["caret"]});if(!n)return null;let o=null;const l=g.CreateFragment();return P(g.GetChildNodes(n,!1),e=>{var t;if((D(e)?g.Utils.IsTextEmpty(e):B(g.GetText(e)))&&!g.Utils.IsBr(e))return t=g.Utils.GetNodeName(e),!g.Utils.IsChildOf(r,e)&&!g.Utils.IsChildOf(e,r)||tt.has(t)||D(e)?void 0:void(o=g.Clone(e));g.Insert(l,e)}),x(g.GetChildNodes(l))?(e.Range.SetEndAfter(n),g.Remove(n)):(null!=(t=n.parentNode)&&t.replaceChild(l,n),e.Range.SetStartToEnd(r,a,a)),o},o=(e,t,r)=>{if(t.IsRange()||t.Start.Node!==t.End.Node||t.Start.Offset!==t.End.Offset)return!1;var a=f(t),n=g.Utils.CreateUEID("caret"),n=g.Create("span",{attrs:["caret",{id:n}]});if(e){var{Tag:e,Styles:o}=R(u)?u[0]:u,l={html:g.Utils.GetEmptyString()};if(o){l.styles={};var i=N(o);for(let e=0,t=i.length;e<t;++e){var[s,d]=i[e];!r&&"{{value}}"===d||(l.styles[s]=d.replace("{{value}}",null!=r?r:""))}}o=g.Create(e,l);g.Insert(n,o),a&&g.Insert(a,n);const c=null!=a?a:n;t.Range.Insert(c),t.Range.SetStartToEnd(o,1,1),g.Utils.IsBr(c.previousSibling)&&g.Remove(c.previousSibling),g.Utils.IsBr(c.nextSibling)&&g.Remove(c.nextSibling)}else{g.Insert(n,g.Utils.GetEmptyString()),a&&g.Insert(a,n);const c=null!=a?a:n;t.Range.Insert(c),t.Range.SetStartToEnd(n,1,1),h.Toggle(!1,u,n,r)}return!0};return{ToggleFromCaret:(e,t)=>_.SerialiseWithProcessors(l,{bWrap:e,value:t,tableProcessor:r,processors:[{processor:o},{processor:a},{processor:n}],after:()=>l.Tools.Parts.ChangePositions()})}};var T=(()=>{const c=[],u=[],n="active",r="disabled";const f=e=>{var{tagName:e,title:t,type:r,html:a}=e,n={attrs:{}};return t&&(n.attrs.title=t),r&&(n.class=M.Utils.CreateUEID(r,!1)),a&&(n.html=a),M.Create(e,n)},a=(e,t)=>f({tagName:"button",title:e,type:"icon-button",html:RichEditor.Icons.Get(t)});const S=(e,t=[])=>{var r=f({tagName:"div",type:"options"});return M.SetAttr(r,H.ATTRIBUTES.TYPE,e),M.Insert(r,...t),r};const o=e=>f({tagName:"button",title:e,type:"icon-wrap"}),l=e=>f({tagName:"button",title:e,type:"helper",html:RichEditor.Icons.Get("AngleDown")});const m=(e="")=>{var t=f({tagName:"div",type:"input-wrap"}),r=M.Create("input",{attrs:[{type:"text"},"required"]}),e=f({tagName:"span",type:"input-placeholder",html:e});return M.Insert(t,r,e),{Wrapper:t,Input:r,Placeholder:e}},g=(e,t)=>{(t?M.AddClass:M.RemoveClass)(e,n)};const i=(e,t)=>{(t?M.SetAttr:M.RemoveAttr)(e,r,r)},h=e=>M.HasAttr(e,r)||M.HasAttr(e.parentElement,r),p=(t,r)=>M.On(t,I.click,e=>{h(t)||(W(e),r())}),T=e=>{const r=e;O(u,([e,t])=>{M.Remove(e,!0),M.Off(r.GetWin(),I.click,t),M.Off(window,I.click,t),M.Off(window,I.scroll,t),M.Off(window,I.resize,t)}),P(c,e=>g(e,!1))};return{ACTIVE_CLASS:n,DISABLED_ATTRIBUTE:r,Create:f,GetSystemStyle:(e,t)=>e.DOM.GetStyle(e.GetBody(),t),CreateIconButton:a,CreateSelection:(e,t="")=>{t=f({tagName:"div",type:"select-label",html:t}),e=f({tagName:"button",title:e,type:"select"});return M.Insert(e,t,RichEditor.Icons.Get("AngleDown")),{Label:t,Selection:e}},CreateOption:(e,t,r=!1,a=!0)=>{t=f({tagName:Ze,title:null!=t?t:e,type:"option-item",html:E(e,a?RichEditor.Icons.Get("Check"):"")});return r&&M.AddClass(t,n),t},CreateOptionList:S,CreateItemGroup:()=>f({tagName:"div",type:"item-group"}),CreateIconGroup:()=>f({tagName:"div",type:"icon-group"}),CreateIconWrap:o,CreateHelper:l,CreateIconWrapSet:(e,t)=>{var r=o(e),t=a(e,t),e=l(e);return M.Insert(r,t,e),{Wrapper:r,Button:t,Helper:e}},CreateInputWrap:m,ToggleActivateClass:g,HasActiveClass:e=>M.HasClass(e,n),ToggleDisable:i,IsDisabled:h,BindClickEvent:p,DestoryOpenedOptionList:T,CreateInputWrapWithOptionList:(e,t)=>{const r=e,{uiName:a,bUpdatable:n,createCallback:o,removeCallback:l,src:i,texts:s}=t;e=S(a);M.SetAttr(e,"url-input","true"),M.On(e,I.click,e=>RichEditor.PreventEvent(e));const{Wrapper:d,Input:c}=m(s.placeholder),u=(i&&(c.value=i),()=>{if(B(c.value))return c.focus();T(r),o(c)});M.On(c,I.keyup,e=>{C([e.key,e.code],y.Enter)&&(W(e),u())});var t=f({tagName:"div",type:"button-group"}),g=[],h=f({tagName:"button",title:s.cancel,html:E(RichEditor.Icons.Get("Close"),s.cancel)}),h=(M.On(h,I.click,()=>T(r)),k(g,h),n?s.update:s.insert),h=f({tagName:"button",title:h,html:E(RichEditor.Icons.Get("Check"),h)});return p(h,u),k(g,h),n&&$(l)&&(h=s.remove,h=f({tagName:"button",title:h,html:E(RichEditor.Icons.Get("Trash"),h)}),M.On(h,I.click,()=>{T(r),l()}),k(g,h)),M.Insert(t,...g),M.Insert(e,d,t),{OptionWrapper:e,Input:c}},BindOptionListEvent:(e,t)=>{const r=e,{type:a,activable:n,clickable:o,create:l,root:i}=t,s=()=>M.Select({class:M.Utils.CreateUEID("options",!1)},null!==i&&void 0!==i?i:r.Frame.Root),d=()=>T(r);k(c,n),M.On(o,I.click,e=>{if(s()&&M.GetAttr(s(),H.ATTRIBUTES.TYPE)===a)return d();W(e),d(),h(o)||(g(n,!0),e=l(),M.On(r.GetWin(),I.click,d),M.On(window,I.click,d),M.On(window,I.scroll,d),M.On(window,I.resize,d),k(u,[e,d]))})},SetOptionListCoordinate:(e,t,r,a)=>{var t=e.Toolbar.IsInGroup(t),n=window.innerWidth+window.scrollX,o=window.innerHeight+window.scrollY;let l=r.offsetLeft+e.Frame.Toolbar.scrollLeft+(t?parseInt(M.GetStyle(r,"margin-left")):0),i=r.offsetTop+r.offsetHeight;t=r.parentElement;t&&M.HasAttr(t,"group")&&(l+=t.offsetLeft,i+=t.offsetTop),l+a.offsetWidth>=n&&(l-=Math.max(a.offsetWidth,r.offsetWidth)-Math.min(a.offsetWidth,r.offsetWidth)),i+a.offsetHeight+e.Frame.Root.offsetTop>=o&&(i-=r.offsetHeight+a.offsetHeight-parseInt(M.GetStyle(r,"margin-bottom"))),M.SetStyles(a,{left:l+"px",top:i+"px"})},SetOptionListInToolsMenuCoordinate:(e,t,r)=>{var a,n,o,l,i={},s=M.GetRect(t),d=M.GetRect(r);s&&d&&(l=null!=(l=t.parentElement)?l:t,a=U(null!=(a=M.GetAttr(l,"class"))?a:"","group")?l.offsetTop:0,n=U(null!=(n=M.GetAttr(l,"class"))?n:"","group")?l.offsetLeft:0,o=null!=(o=null==(l=M.Select({class:M.Utils.CreateUEID("helper",!1)},t))?void 0:l.offsetLeft)?o:0,l=null!=(l=null==l?void 0:l.offsetWidth)?l:0,s.right+d.width>=e.GetWin().innerWidth?i.left=s.width-d.width+o+l+"px":i.left=n+o+"px",s.bottom+d.height+parseInt(M.GetStyle(e.DOM.Doc.body,"margin-top",!0))>=e.GetWin().innerHeight?i.top=a+t.offsetTop-r.offsetHeight+"px":i.top=a+t.offsetTop+t.offsetHeight+"px",M.SetStyles(r,i))},UnwrapSameInlineFormats:(t,e)=>{const r=e=>{e=e.SameFormats;e&&P(e,e=>{rt(t,K[e]).ToggleFromCaret(!1)})};if(!R(e))return r(e);P(e,e=>r(e))},RegisterCommand:(e,t,r)=>e.Commander.Register(t,r),RunCommand:(e,t,...r)=>e.Commander.Run(t,...r),RegisterKeyboardEvent:(e,t,r)=>{t=t.split("+");const a={bCtrl:!1,bAlt:!1,bShift:!1,bPrevent:!0};let n;P(t,e=>{var t=v(e);switch(t){case"ctrl":a.bCtrl=!0;break;case"alt":a.bAlt=!0;break;case"shift":a.bShift=!0;break;default:var r=1===t.length?E(isNaN(parseInt(t))?"Key":"Digit",se(t)):e;n=y[r]}}),n&&Je(e,I.keydown,n,a,(e,t)=>{W(t),r(t)})},IsNearDisableList:(e,t,r)=>{return e&&M.Closest(r,{tagName:A(e)})?(g(t,!1),i(t,!0),!0):(i(t,!1),!1)}}})();const at=e=>{const l=e,t="HorizontalLine",r=l.Lang("toolbar.horizontal.line","Horizontal Line"),i=()=>{var e=M.Element.Figure.Create("hr"),t=l.DOM.Create("hr");return t.draggable=!0,M.Insert(e,t),e},a=()=>{const t=l.Utils.Caret,r=i();var e=()=>{var e=l.Utils.Range();e.SetStartToEnd(r,1,1),t.UpdateRange(e),l.Utils.Shared.DispatchCaretChange([r]),l.Focus()},a=t.Get();if(!a)return n=M.Element.Table.GetSelectedCells(l),n=M.Element.Figure.FindClosest(null!=(n=n[0])?n:null),M.InsertAfter(null!=n?n:l.GetBody(),r),e();l.Utils.Shared.DeleteRange(a);var{StartBlock:n,EndBlock:o}=l.Utils.Shared.SplitLines(a.Start.Node,a.Start.Offset);M.InsertAfter(null!=n?n:a.Start.Path[0],o,r),!M.Element.Figure.Is(n)&&B(M.GetText(n))&&M.Remove(n),!M.Element.Figure.Is(o)&&B(M.GetText(o))&&M.Remove(o),e()};return{Name:"Hr",Create:()=>{var e=T.CreateIconButton(r,t);return l.Commander.Register(t,a),T.BindClickEvent(e,()=>l.Commander.Run(t)),e}}},nt={};class ot{constructor(e){this.Doc=document,this.boundEvents={},this.rootBoundEvents={},G(e)||(e="div"),this.Self=this.Doc.createElement(e),this.Id=Ee(),ae(this.Self,ot.FACTORY_PROPERTY_NAME,this.Id),nt[this.Id]=this}static FindFactory(e){var e=ne(e,ot.FACTORY_PROPERTY_NAME);return e&&null!=(e=nt[e])?e:null}BindRoot(e,t,r=!1){this.rootBoundEvents[e]||(this.rootBoundEvents[e]=[]),C(this.rootBoundEvents[e],t)||(document.addEventListener(e,t,r),k(this.rootBoundEvents[e],t))}UnbindRoot(e,t){document.removeEventListener(e,t,!0),document.removeEventListener(e,t,!1),this.rootBoundEvents[e]&&(this.rootBoundEvents[e]=this.rootBoundEvents[e].filter(e=>e!==t))}GetBody(){return this.Doc.body}GetId(){return this.Id}Insert(...e){P(e,e=>xe(this.Self,G(e)?e:e.Self))}AddClass(...e){this.Self.classList.add(...e)}HasClass(e){return this.Self.classList.contains(e)}RemoveClass(...e){this.Self.classList.remove(...e)}Bind(e,t,r=!1){this.boundEvents[e]||(this.boundEvents[e]=[]),C(this.boundEvents[e],t)||(this.Self.addEventListener(e,t,r),k(this.boundEvents[e],t))}Unbind(e,t){this.Self.removeEventListener(e,t,!0),this.Self.removeEventListener(e,t,!1),this.boundEvents[e]&&(this.boundEvents[e]=this.boundEvents[e].filter(e=>e!==t))}Dispatch(e){this.Self.dispatchEvent(new Event(e))}GetChildren(e=!0){if(!e)return A(this.Self.children);const t=[];return P(A(this.Self.children),e=>{e=ot.FindFactory(e);e&&k(t,e)}),t}Destroy(){O(this.GetChildren(),e=>e.Destroy()),O(this.GetChildren(!1),e=>e.remove()),this.Dispatch("Factory:Destroyed"),N(this.boundEvents,(t,e)=>{O(e,e=>this.Unbind(t,e)),null!=(e=this.boundEvents)&&delete e[t]}),N(this.rootBoundEvents,(t,e)=>{O(e,e=>this.UnbindRoot(t,e)),null!=(e=this.rootBoundEvents)&&delete e[t]}),null!==nt&&void 0!==nt&&delete nt[this.Id],this.Self.remove()}}ot.FACTORY_PROPERTY_NAME="factory-boundary-id";var lt=(()=>{const l=e=>{var{TagName:e,Elements:t,Events:r,Attributes:a,Classes:n}=e;const o=new ot(e);return R(t)&&P(t,e=>{if(G(e))return o.Insert(e);var t=b(e,"Doc");o.Insert(t?e:l(e))}),R(r)&&P(r,e=>o.Bind(e[0],e[1])),z(a)&&Oe(o.Self,a),R(n)&&o.AddClass(...n),o};return{SketchOne:l,Sketch:e=>{const t=[];return P(e,e=>k(t,l(e))),t}}})();const it=(e,t,r)=>e<=t?t:r<=e?r:e;var st,dt,ct;const u={Input:e=>{var{Label:e,Placeholder:t,Value:r,Events:a}=e,a=lt.SketchOne({TagName:"label",Elements:[{TagName:"div",Elements:[null!=e?e:""]},{TagName:"input",Events:a}]});const n=a.GetChildren()[1];var o=e=>n.Self.value=e;return t&&!B(e)&&(n.Self.placeholder=t),r&&!B(r)&&o(r),{Schema:a,Self:n,GetValue:()=>n.Self.value,SetValue:o}},Modal:(t,e)=>{var{Title:e,Icons:r,Body:a,Footer:n,Events:o}=e,l=e=>{return e=[t,e],p("-",...e)};const i=lt.SketchOne({TagName:l("modal"),Events:o});i.BindRoot("keyup",e=>{"escape"!==v(e.code)&&"escape"!==v(e.key)||i.Destroy()},!0);o=lt.SketchOne({TagName:l("dialog"),Elements:[{TagName:l("header"),Elements:[e,{TagName:"div",Elements:[r.Close],Events:[["click",()=>i.Destroy()]]}]},{TagName:l("body"),Elements:a?R(a)?a:[a]:void 0},{TagName:l("footer"),Elements:n?R(n)?n:[n]:void 0}]}),i.Insert(o),e=o.GetChildren();return{Schema:i,Self:o,Header:e[0],Body:e[1],Footer:e[2]}},Palette:e=>{const{Width:r,Height:a,Events:t}=e;e=lt.SketchOne({TagName:"canvas",Attributes:{width:r.toString(),height:a.toString(),draggable:"false"},Events:t});const n=e.Self.getContext("2d",{willReadFrequently:!0});if(n)return n.rect(0,0,r,a),{Schema:e,Self:e,CreateGradient:(e,t,r,a)=>n.createLinearGradient(e,t,r,a),ColorStop:(t,e)=>{R(e)&&P(e,e=>{R(e)&&2===e.length&&t.addColorStop(e[0],e[1])})},Fill:e=>{n.fillStyle=e,n.fill()},FillRect:e=>{n.fillStyle=e,n.fillRect(0,0,r,a)},GetRGB:(e,t)=>{e=it(e,0,r),t=it(t,0,a),e=n.getImageData(e===r?e-1:e,t===a?t-1:t,1,1).data;return[e[0],e[1],e[2]]}}},PaletteGuide:e=>{const{Palette:r,bOnlyVertical:a,Events:t,Guiding:n}=e,o=lt.SketchOne({TagName:"div",Attributes:{draggable:"false"},Events:t}),l=o.Self,i=()=>l.offsetWidth/2,s=()=>l.offsetHeight/2;const d=e=>ke(l,"top",e+"px"),c=e=>ke(l,"left",e+"px"),u=(e,t)=>{e=it(e,0,r.Self.offsetWidth)-i(),t=it(t,0,r.Self.offsetHeight)-s();d(t),a||c(e),n()};let g=!1;const h=["mousedown","touchstart"],f=["mousemove","touchmove"],S=["mouseup","touchend"],m=e=>{var t=v(e.type);C(S,t)?g=!1:l.parentElement&&(C(h,t)&&(g=!0),C(f,t)&&!g||(b(e,"buttons")&&0===e.buttons?g=!1:(t=b(e,"touches")?e.touches.item(0):e)&&u(t.clientX-l.parentElement.offsetLeft,t.clientY-l.parentElement.offsetTop)))};return P(X(h,f,S),e=>{r.Bind(e,m),o.Bind(e,m)}),P(["drag","dragstart","dragend","dragenter","dragleave","dragover"],e=>o.Bind(e,e=>{e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()})),{Schema:o,Self:o,GetX:()=>l.offsetLeft+i(),GetY:()=>l.offsetTop+s(),SetGuidance:u}},Sketch:lt.Sketch,SketchOne:lt.SketchOne},ut=e=>{const n=e,a=n.Lang("toolbar.info","Information"),o={Check:RichEditor.Icons.Get("Check"),Close:RichEditor.Icons.Get("Close")},l=t=>{var e,r;e=n.Lang("toolbar.shortcuts","Shortcuts"),r=!0;const a=u.SketchOne({TagName:"button",Attributes:{type:"button"},Classes:r?["active"]:[],Elements:[e]});return a.Bind(I.click,e=>{W(e),a.AddClass("active"),M.Show(t.GetChildren()[0].Self)}),u.SketchOne({TagName:"info-navigation",Elements:[a]})},i=()=>{const r=[];P(n.GetShortcuts(),e=>{var t=M.Utils.WrapTagHTML("strong",E(e.Title,":")),e=M.Utils.WrapTagHTML("span",e.Keys);k(r,M.Utils.WrapTagHTML("div",E(t,e)))});var e=u.SketchOne({TagName:"div",Classes:[M.Utils.CreateUEID("shortcut-content",!1)],Elements:r});return u.SketchOne({TagName:"info-content",Elements:[e]})};return{Name:"Info",Create:()=>{var e=T.CreateIconButton(a,"Info");return T.BindClickEvent(e,()=>{const e=u.Modal("info",{Title:a,Icons:o,Body:(t=i(),r=l(t),u.SketchOne({TagName:"info-wrap",Elements:[r,t]})),Footer:u.SketchOne({TagName:"button",Attributes:{type:"button"},Elements:[E(o.Check,n.Lang("confirm","Confirm"))],Events:[["click",()=>e.Schema.Destroy()]]})});var t,r;M.InsertAfter(e.Schema.GetBody(),e.Schema.Self)}),e}}},gt=e=>{const a=e,t="SelectAll",r=a.Lang("toolbar.select.all","Select all");return{Name:t,Create:()=>{var e=T.CreateIconButton(r,t);return a.AddShortcut(r,"Ctrl+A"),T.BindClickEvent(e,()=>{var e,t=a.GetLines(),r=M.Utils.GetFirstChild(t[0],!0),t=M.Utils.GetLastChild(t[t.length-1],!0);r&&t&&((e=a.Utils.Range()).SetStart(r,0),e.SetEnd(t,D(t)?t.length:0),a.Utils.Caret.UpdateRange(e),a.Utils.Shared.DispatchCaretChange(),a.Focus())}),e}}},ht=(e,t)=>{var r=[];let a=e;for(;a&&a!==t&&a.parentElement;)V(r,Z(M.GetChildNodes(a.parentElement),a)),a=a.parentElement;return r},ft=(e,t)=>{let r=e;return P(t,(e,t)=>{M.GetChildNodes(r)[e]||t(),r=M.GetChildNodes(r)[e]}),r},St="Undo",mt="Redo",pt=new Set([y.ArrowUp,y.ArrowDown,y.ArrowLeft,y.ArrowRight,y.Home,y.End,y.PageDown,y.PageUp,y.Enter]),Tt=e=>{var t=M.Create("div"),e=(M.CloneAndInsert(t,!0,...e.GetLines()),O(e.Tools.Parts.Manager.SelectParts(!0,t),e=>M.Remove(e)),M.GetHTML(t));return M.Remove(t),e},Ct=(e,t)=>{if(R(t)){var r=M.Element.Table.FindClosest(null!=(r=t[0])?r:null);if(x(t)||!r)return null;var a=ht(r,e.GetBody());const n=[],o=M.Element.Table.GetAllOwnCells(r);return P(t,e=>k(n,Z(o,e))),{type:"cells",info:{path:a,indexes:n}}}return t.IsRange()?t.Start.Node===t.End.Node?{type:"node",info:{path:ht(t.Start.Node,e.GetBody()),start:t.Start.Offset,end:t.End.Offset}}:{type:"range",info:{start:{path:ht(t.Start.Node,e.GetBody()),offset:t.Start.Offset},end:{path:ht(t.End.Node,e.GetBody()),offset:t.End.Offset}}}:{type:"caret",info:{path:ht(t.Start.Node,e.GetBody()),offset:t.Start.Offset}}},vt=(e,t,r)=>{var a=e,n=a.Utils.Caret,{type:e,info:o}=r,l=(O(a.Tools.Parts.Manager.SelectParts(!0),e=>M.Remove(e,!0)),a.SetContent(t),a.Utils.Range());switch(e){case"cells":var i=ft(a.GetBody(),o.path);const s=M.Element.Table.GetAllOwnCells(i);P(o.indexes,e=>M.Element.Table.ToggleSelectCell(!0,s[e])),n.CleanRanges();break;case"caret":l.SetStartToEnd(ft(a.GetBody(),o.path),o.offset,o.offset);break;case"node":l.SetStartToEnd(ft(a.GetBody(),o.path),o.start,o.end);break;case"range":l.SetStart(ft(a.GetBody(),o.start.path),o.start.offset),l.SetEnd(ft(a.GetBody(),o.end.path),o.end.offset)}"cells"!==e&&n.UpdateRange(l),a.Utils.Shared.DispatchCaretChange(),a.Tools.Parts.ChangePositions()},Et=e=>{const s=e,t=[{Name:St,Title:s.Lang("toolbar.undo","Undo"),CommandName:St,Keys:"Ctrl+Z"},{Name:mt,Title:s.Lang("toolbar.redo","Redo"),CommandName:mt,Keys:"Ctrl+Shift+Z"}];e=e=>{const{Name:n,Title:o,CommandName:l,Keys:i}=t[e];return()=>{var e=s.Formatter.Detector;const t=s.History,r=T.CreateIconButton(o,n);s.AddShortcut(o,i),T.BindClickEvent(r,()=>{s.Commander.Run(l)});var a=()=>{var e=l===St?t.CanUndo:t.CanRedo;T.ToggleDisable(r,!e())};return e.Register(a),a(),l===St&&s.On(I.keyup,()=>{var e=t.CanUndo()||t.IsTexting();T.ToggleDisable(r,!e)}),s.On("Command:After",e=>{e!==St&&e!==mt&&(e=l===St?t.CanUndo:t.CanRedo,T.ToggleDisable(r,!e()))}),r}};return{Undo:{Name:t[0].Name,Create:e(0)},Redo:{Name:t[1].Name,Create:e(1)}}},It=e=>{const r=e;e=Et(r);const a=[ut(r),gt(r),at(r),e.Undo,e.Redo];return{Has:r=>{for(let e=0,t=a.length;e<t;++e)if(v(r)===v(a[e].Name))return!0;return!1},Register:e=>{var t=(r=>{for(let e=0,t=a.length;e<t;++e)if(v(r)===v(a[e].Name))return a[e];return null})(e);t&&r.Toolbar.Add(e,t.Create())}}},yt=((t=st=st||{}).SCROLL="SCROLL",t.FLOAT="FLOAT",e=>{const r=e,t=r.Config.Toolbar,a=r.Config.ToolbarGroup,n=It(r),o={},l=e=>!!o[v(e)],i=e=>o[v(e)],s=e=>{const t=M.Create("div",{attrs:{group:e},class:M.Utils.CreateUEID("toolbar-group",!1)});return P(a[e],e=>{l(e)&&M.Insert(t,i(e))}),t};const d=e=>{l(e)&&M.Remove(o[v(e)],!0)};return{Has:l,Get:i,LoadAll:()=>{P(t,e=>{var t;return r.Formatter.Registry.IsAvailable(e)?r.Formatter.Register(e):n.Has(e)?n.Register(e):a[e]?void P(a[e],e=>{var t;return r.Formatter.Registry.IsAvailable(e)?r.Formatter.Register(e):n.Has(e)?n.Register(e):void(r.Plugin.Has(e)&&null!=(t=r.Plugin.Get(e))&&t(e))}):null==(t=r.Plugin.Get(e))?void 0:t(e)}),P(t,e=>{if(l(e))return M.Insert(r.Frame.Toolbar,i(e));a[e]&&M.Insert(r.Frame.Toolbar,s(e))})},IsInGroup:e=>o[e]&&M.HasAttr(o[e].parentElement,"group"),Add:(e,t)=>{l(e)||(o[v(e)]=t)},Remove:d,RemoveAll:()=>te(o,e=>d(e))}}),Rt=(r=new Range)=>{const a=(e,t)=>D(e)?e.length<t?e.length:t<0?0:t:t;const n=(e,t)=>r.setStart(e,a(e,t));const o=(e,t)=>r.setEnd(e,a(e,t));return{Get:()=>r,GetRect:()=>r.getBoundingClientRect(),Insert:e=>r.insertNode(e),Extract:()=>r.extractContents(),CloneContents:()=>r.cloneContents(),DeleteContents:()=>r.deleteContents(),Clone:()=>Rt(r.cloneRange()),SetStart:n,SetStartBefore:e=>r.setStartBefore(e),SetStartAfter:e=>r.setStartAfter(e),SetEnd:o,SetEndBefore:e=>r.setEndBefore(e),SetEndAfter:e=>r.setEndAfter(e),Select:e=>r.selectNode(e),SelectContents:e=>r.selectNodeContents(e),SetStartToEnd:(e,t,r)=>{e&&(n(e,t),o(e,r))}}},Gt=e=>{const n=e,o={},l=[];const t=e=>{return null!=(e=o[e])?e:[]},i=e=>!!o[e],s=e=>M.On(n.GetBody(),e,r=>{n.IsReadOnly()||P(t(e),(e,t)=>{if(r.defaultPrevented)return t();e(r)})});return{Get:()=>o,GetEvents:t,Has:i,Resolve:()=>{L(n.GetBody())&&O(l,e=>s(e))},On:(e,t,r=!1)=>{var a=e;if(I[a]&&!i(a)&&!C(l,a))L(n.GetBody())?s(a):k(l,a);i(e)||(o[e]=[]),(r?V:k)(o[e],t)},Off:(a,n)=>{if(i(a)){let r=0;for(let e=0,t=o[a].length;e<t;++e)o[a][e-r]===n&&(S(o[a],e-r),++r)}},OffAll:()=>N(o,(e,t)=>{h(t),null!==o&&void 0!==o&&delete o[e]}),Dispatch:(e,...r)=>{if(i(e)&&!n.IsReadOnly()){const a=[];P(o[e],t=>k(a,new Promise(e=>{t(...r),e()}))),Promise.all(a).catch(console.error)}}}},At=r=>({Caret:(e=>{const i=e;let n=null;const s=(e,t)=>{var r=t?e.previousSibling:e.nextSibling,a=t?M.Utils.GetLastChild:M.Utils.GetFirstChild,t=t?M.Utils.GetFirstChild:M.Utils.GetLastChild;if(r)return a(r,!0);let n=e.parentNode;for(;n&&n!==i.GetBody();){if(tt.has(M.Utils.GetNodeName(n.previousSibling))){n=n.previousSibling;break}n=n.parentNode}return(n?a:t)(null!==n&&void 0!==n?n:e,!0)},o=(e,t,r,a)=>{var n,o=i.GetLines(!1),l=(e===i.GetBody()&&(l=(a?M.Utils.GetFirstChild:M.Utils.GetLastChild)(a?o[t]:o[t-1],!0))&&(e=l,t=D(e)&&!a?e.length:0),M.Utils.GetNodeName(e)),r=(et.has(l)&&r&&!a&&(n=s(e,0===t))&&(e=n,t=D(e)?e.length:0),r||!tt.has(l)||M.Element.Figure.Is(e)||(n=(a?M.Utils.GetFirstChild:M.Utils.GetLastChild)(e,!0))&&(e=n),M.GetParents(e));return{Node:e,Offset:t,Path:r,Line:Z(o,r[0])}},r=()=>{var e=i.GetWin().getSelection();null!=e&&e.removeAllRanges(),n=null},l=()=>{var e=M.Element.Table.GetSelectedCells(i);return!x(e)&&!(n=null)},a=()=>{if(!l()){var e=i.GetWin().getSelection();if(e){var t=0===e.rangeCount?null:e.getRangeAt(0);if(t&&M.Utils.IsChildOf(t.commonAncestorContainer,i.GetBody())){const r=t.startContainer!==t.endContainer||t.startOffset!==t.endOffset,a=e.focusNode===t.startContainer;n={IsRange:()=>r,IsBackward:()=>a,Start:o(t.startContainer,t.startOffset,r,!0),End:o(t.endContainer,t.endOffset,r,!1),SameRoot:t.commonAncestorContainer,Range:Rt(t)}}}}};const d=(e,t)=>{var r=i.GetLines(!1),a=M.GetParents(e);return{Node:e,Offset:t,Path:a,Line:Z(r,a[0])}};return{CleanRanges:r,Refresh:a,UpdateRange:e=>{var t;l()||(r(),null!=(t=i.GetWin().getSelection())&&t.addRange(e.Get()),a())},CreateFake:(e,t,r,a)=>{var n=d(e,t),o=d(r,a);let l=e===r?e:i.GetBody();if(e!==r)for(let e=0,t=Math.min(n.Path.length,o.Path.length);e<t&&n.Path[e]===o.Path[e];++e)l=n.Path[e];return{IsRange:()=>e===r&&t===a,IsBackward:()=>!1,Start:n,End:o,Range:Rt(),SameRoot:l}},Get:()=>(a(),n)}})(r),Range:e=>{var t=r.GetWin();return Rt(null!=e?e:new t.Range)},Event:Gt(r),Shared:(e=>{const h=e;return{DispatchCaretChange:(e=[])=>{var e=[...e],t=h.Utils.Caret.Get();return t&&(1===e.length||h.DOM.Select(M.Element.Table.Selector,e[0]))&&k(e,...X(t.Start.Path,t.End.Path)),x(e)?t?(k(e,...q(X(t.Start.Path,t.End.Path))),h.Dispatch("Caret:Change",e)):(t=M.Element.Table.GetSelectedCells(h),x(t)?h.Dispatch("Caret:Change",e):(k(e,...M.GetChildren(t[0])),void h.Dispatch("Caret:Change",e))):h.Dispatch("Caret:Change",e)},SplitLines:(r,a)=>{var n;let o=null,l=null;if(D(r)){var i=null!=(n=M.Element.Table.FindClosestCell(_.GetParentIfText(r)))?n:h.GetBody(),s=r.splitText(a),d=s.parentNode;let e=d,t=s;for(;e&&e!==i;){var c=M.Clone(e);for(l&&M.Insert(c,l);t;){M.CloneAndInsert(c,!0,t);var u=t;t=t.nextSibling,D(u)?e.removeChild(u):M.Remove(u)}var g=e!==d||e===d&&0!==s.length;1<=M.GetChildNodes(c).length&&g&&(l=c),e.parentNode===i&&(o=e),t=e.nextSibling,e=e.parentNode}}return{StartBlock:o,EndBlock:l}},DeleteRange:e=>{if(null!=e&&e.IsRange()){var t=!!M.Closest(_.GetParentIfText(e.SameRoot),{tagName:A(m.Block)});if(e.Start.Node===e.End.Node||t)return e.Range.DeleteContents();var r=h.GetLines(!1),t=M.Utils.GetFirstChild(r[0],!0),a=M.Utils.GetLastChild(r[r.length-1],!0),t=t===e.Start.Node&&0===e.Start.Offset&&a===e.End.Node&&(D(a)?a.length:0)===e.End.Offset;if(e.Range.DeleteContents(),t)for(;1<r.length;){var n=null!=(n=r[1])?n:null;M.Remove(n,!0)}}}}})(r)}),Nt=e=>{const t=e,r=()=>{var e;return Ct(t,null!=(e=t.Utils.Caret.Get())?e:M.Element.Table.GetSelectedCells(t))};e=(e,t)=>{let r;const a=()=>{r=e()};const n=()=>{r&&(t(r),r=null)};return{Archive:a,Unarchive:()=>{r=null},RecordArchive:n,Record:()=>{a(),n()}}};return{History:e(()=>{var e=r();return e?{data:Tt(t),redo:e}:null},e=>{t.History.Record(e)}),Path:e(r,e=>{t.History.AddUndoPath(e)})}},bt=e=>{const a=e,n=(e=>{const t=e,r=[],a={};e=Nt(t);let n=!1,o=-1,l=null;const i=()=>0<o,s=()=>o<r.length-1;return{Archiver:e,Histories:r,SetTexting:e=>{n=e},IsTexting:()=>n,CanUndo:i,CanRedo:s,Flag:()=>l=Ee(),Unflag:()=>{l&&(null!==a&&void 0!==a&&delete a[l],l=null)},Record:e=>{++o,r.splice(o,r.length,e),l&&(a[l]=o)},AddUndoPath:e=>{r[o]&&(r[o].undo=e)},Clean:()=>{h(r),o=-1},Undo:()=>{var e;0<o&&(--o,(e=r[o]).undo&&vt(t,e.data,e.undo),t.Utils.Shared.DispatchCaretChange())},Redo:()=>{var e;s()&&(++o,e=r[o],vt(t,e.data,e.redo),t.Utils.Shared.DispatchCaretChange())},CreateData:()=>Tt(t),ChangeData:(e,t)=>{a[e]&&r[a[e]]&&(r[a[e]].data=t)}}})(a),o=n.Archiver;a.On(I.keydown,e=>{var t=pt.has(e.code)||pt.has(e.key),r=C([e.code,e.key],y.KeyZ)&&e.ctrlKey;if(t||r){if(t)return n.IsTexting()?(o.History.Record(),n.SetTexting(!1)):void 0;if(n.IsTexting())return o.History.Archive();W(e);r=e.shiftKey?mt:St;a.Commander.Run(r)}});e=e=>{var t={};t[H.ATTRIBUTES.FIXED]="parts-tool",F(e.target)&&!M.Closest(e.target,{attrs:t})&&n.IsTexting()&&(o.History.Record(),n.SetTexting(!1))};a.On(I.mousedown,e),a.On(I.touchstart,e),a.On(I.beforeinput,e=>{var t=e["inputType"];switch(t){case je.historyUndo:case je.historyRedo:return n.SetTexting(!1);default:if(U(t,/(insert|delete)*.?(Text|Line|Backward||Forward)/gi))return n.IsTexting()||(o.Path.Record(),o.Path.Archive()),n.SetTexting(!0)}}),a.On(I.input,e=>{var t=e["inputType"];switch(t){case je.historyUndo:case je.historyRedo:o.Path.RecordArchive(),o.History.RecordArchive();var r=t===je.historyUndo?St:mt;return a.Commander.Run(r);default:if(U(t,/(insert|delete)*.?(Text|Line|Backward||Forward)/gi))return o.History.Archive()}});return P(["Tools:Adjust:Start","Tools:Adjust:Finish","Tools:Move:Start","Tools:Move:Finish"],e=>{return a.On(e,(t=e,()=>{if(n.SetTexting(!1),U(t,"Start"))return o.Path.RecordArchive(),o.History.RecordArchive(),o.Path.Archive();o.Path.RecordArchive(),o.History.Record()}));var t}),a.On("Tools:Move:Cancel",()=>o.Path.Unarchive()),a.On("Command:Before",e=>{e!==St&&e!==mt&&(a.History.IsTexting()&&(o.Path.RecordArchive(),o.History.RecordArchive()),o.Path.Record())}),a.On("Command:After",e=>{e!==St&&e!==mt&&(o.History.Record(),a.History.IsTexting())&&(a.History.SetTexting(!1),o.Path.Archive(),o.History.Archive())}),a.Commander.Register(St,()=>{n.IsTexting()&&(a.Focus(),o.Path.RecordArchive(),o.History.Record()),n.SetTexting(!1),n.Undo(),a.Focus()}),a.Commander.Register(mt,()=>{n.SetTexting(!1),n.Redo(),a.Focus()}),n};(e=dt=dt||{}).DEFAULT="DEFAULT",e.WARNING="WARNING",e.ERROR="ERROR";(oe=ct=ct||{}).SHOW="SHOW",oe.HIDE="HIDE";class Ut{constructor(e){var t,r,a,n,o,l,i;this.Id=Ee(),this.mShortcuts=[],this.mWin=window,this.mScrollX=-1,this.mScrollY=-1,this.mbAdjusting=!1,this.mbDestroyed=!1,this.mbReadOnly=!1,this.Config=e,this.Frame=(e=e,t=M.Create("div",{attrs:{id:M.Utils.CreateUEID(),mode:Ae[e.Mode]},styles:{width:e.Width},class:M.Utils.CreateUEID(void 0,!1)}),r=M.Utils.CreateUEID("toolbar",!1),r=M.Create("div",{attrs:{id:r,toolbarStyle:v(e.ToolbarStyle)},class:r}),a=M.Utils.CreateUEID("wrapper",!1),a=M.Create("div",{attrs:{id:a},class:a}),n=M.Utils.CreateUEID("notification",!1),n=M.Create("div",{attrs:{id:n},class:n}),o=M.Utils.CreateUEID("container",!1),o=M.Create(H.GetModeTag(e.Mode),{attrs:{id:o},styles:{height:e.Height},class:o}),l=M.Utils.CreateUEID("loading-wrap",!1),i=M.Utils.CreateUEID("loading",!1),l=M.Create("div",{attrs:{id:l},class:l,children:[M.Create("div",{attrs:{id:i},class:i}),M.Create("span",{html:ce(H.SHORT_NAME)})]}),i=e.Mode!==Ae.inline&&e.Resizable?M.Create("button",{class:M.Utils.CreateUEID("resizer",!1),html:RichEditor.Icons.Get("Resize")}):null,M.Hide(n),M.Insert(a,n,o),M.Insert(t,r,a,l,i),M.InsertAfter(e.Selector,t),{Root:t,Toolbar:r,Notification:n,Wrapper:a,Container:o,Loading:l,Resizer:i}),this.Utils=At(this),this.Commander=(e=>{const r=e,a={},n=e=>!!a[e];return{Commands:a,Run:(e,...t)=>{n(e)&&!r.IsReadOnly()&&(r.Dispatch("Command:Before",e),a[e](...t),r.Dispatch("Command:After",e))},Register:(e,t)=>{n(e)||(a[e]=t)}}})(this),this.History=bt(this),this.Notification=(e=>{const n=e,o=n.Frame.Notification,l=[],i=()=>M.Show(o),s=()=>M.Hide(o),d=e=>M.Utils.CreateUEID("notification-"+e,!1);return{STATUS_MAP:dt,Show:i,Hide:s,Dispatch:(e,t,r)=>{if(!n.IsDestroyed()){switch(i(),e){case dt.WARNING:console.warn(t);break;case dt.ERROR:if(console.error(t),r)return n.Destroy()}const a=M.Create("div",{attrs:{id:d("message"),type:v(dt[e])},class:[d("message")],children:[M.Create("div",{class:d("message-text"),html:t})]});e=M.Create("button",{class:d("message-icon"),html:RichEditor.Icons.Get("Close")});M.On(e,I.click,()=>M.Dispatch(a,"Notification:Close")),M.Insert(a,e),M.On(a,"Notification:Close",()=>{var e=l.indexOf(a);S(l,e);const t=x(l);M.AddClass(a,"fade-out");let r=setTimeout(()=>{M.Remove(a,!0),t&&s(),clearTimeout(r),r=void 0},450)}),M.Insert(o,a),k(l,a)}}}})(this),this.Toolbar=yt(this)}Notify(e,t,r){this.Notification.Dispatch(e,t,r)}On(e,t,r=!1){this.Utils.Event.On(e,t,r)}Off(e,t){this.Utils.Event.Off(e,t)}Dispatch(e,...t){if(!I[e])return this.Utils.Event.Dispatch(e,...t);this.DOM.Dispatch(this.GetBody(),e)}IsAdjusting(){return this.mbAdjusting}SetAdjusting(e){this.mbAdjusting=e}IsDestroyed(){return this.mbDestroyed}Destroy(){this.mbDestroyed=!0,$e.Destroy(this)}IsReadOnly(){return this.mbReadOnly}SetReadOnly(t){var e=[this.GetBody(),...this.DOM.SelectAll({attrs:{contenteditable:t?"true":"false"}})];if(O(e,e=>{M.Element.Figure.Is(e)||M.SetAttr(e,"contenteditable",t?"false":"true")}),t&&(M.Element.Table.ToggleSelectMultipleCells(!1,M.Element.Table.GetSelectedCells(this)),this.Tools.Parts.UnsetAllFocused(),null!=(e=this.Footer))&&e.CleanNavigation(),O(M.SelectAll("button",this.Frame.Toolbar),e=>this.Formatter.UI.ToggleDisable(e,t)),this.mbReadOnly=t)return this.Utils.Caret.CleanRanges();var e=this.Utils.Range(),r=M.Utils.GetFirstChild(this.GetBody());r&&e.SetStartToEnd(r,0,0),this.Utils.Caret.UpdateRange(e),this.Utils.Shared.DispatchCaretChange()}IsIFrame(){return M.Utils.IsIFrame(this.Frame.Container)}SetBody(e){this.mBody=e}GetBody(){return this.mBody}SetWin(e){this.mWin=null!=(e=e)?e:window}GetWin(){return this.mWin}SaveScrollPosition(){var e=this.DOM.GetRoot();this.mScrollX=l(e.scrollLeft)?e.scrollLeft:-1,this.mScrollY=l(e.scrollTop)?e.scrollTop:-1}ScrollSavedPosition(){var e,t=this.DOM.GetRoot();-1!==this.mScrollX&&null!=(e=t.scroll)&&e.call(t,{left:this.mScrollX}),-1!==this.mScrollY&&null!=(e=t.scroll)&&e.call(t,{top:this.mScrollY}),this.mScrollX=-1,this.mScrollY=-1}Scroll(e,r=800){const a=this.DOM.GetRoot().scrollTop;var t=this.DOM.GetRect(e),n=null!=(n=null==t?void 0:t.top)?n:e.offsetTop,t=null!=(t=null==t?void 0:t.height)?t:e.offsetHeight;const o=n-(this.GetWin().innerHeight/2-t/2);let l=null;const i=e=>{var e=e/(r/2);return e<1?.5*e*e:-.5*((e=e-1)*(e-2)-1)},s=e=>{var e=e-(l=null===l?e:l),t=i(e),t=a+o*t;if(this.GetWin().scrollTo(0,t),e<r)return this.GetWin().requestAnimationFrame(s)};this.GetWin().requestAnimationFrame(s)}IsFocused(){return M.HasClass(this.Frame.Container,"focused")}Focus(){this.SaveScrollPosition();var t=this.Utils.Caret.Get();let r=null!=(t=null==t?void 0:t.Range.Clone())?t:null;t=M.Element.Table.GetSelectedCells(this);if(!x(t))return this.ScrollSavedPosition();if(!r){var t=this.Utils.Range(),a=M.Utils.GetFirstChild(this.GetBody());let e=M.Utils.GetFirstChild(a,!0);M.Utils.IsBr(e)&&(e=e.parentNode),t.SetStartToEnd(null!==e&&void 0!==e?e:this.GetBody(),0,0),r=t}this.GetBody().focus(),this.Utils.Caret.UpdateRange(r),this.ScrollSavedPosition()}CreateEmptyParagraph(){return this.DOM.Create("p",{html:"<br>"})}SetContent(e="<p><br></p>"){this.DOM.SetHTML(this.GetBody(),B(e)?"<p><br></p>":e)}InitContent(){this.SetContent()}GetContent(){var e=M.Create("div"),t=(M.CloneAndInsert(e,!0,...this.GetLines()),O(this.Tools.Parts.Manager.SelectParts(!0,e),e=>M.Remove(e)),O(M.SelectAll({attrs:[H.ATTRIBUTES.STYLE]},e),e=>M.RemoveAttr(e,H.ATTRIBUTES.STYLE)),M.GetHTML(e));return M.Remove(e),t}GetLines(e=!0){return this.DOM.GetChildren(this.GetBody(),e)}CleanDirty(){var e=this.GetLines(!0);O(e,e=>this.Formatter.Utils.CleanDirty(this,this.DOM.GetChildNodes(e)))}AddShortcut(r,e){for(let e=0,t=this.mShortcuts.length;e<t;++e)if(v(this.mShortcuts[e].Title)===v(r))return;k(this.mShortcuts,{Title:r,Keys:e})}GetShortcuts(){return this.mShortcuts}Resize(e){this.Tools.Resizer.Resize(e)}Lang(e,t,r){let a=null!=(e=RichEditor.ILC.Get(this.Config.Language,e))?e:t;return R(r)&&N(r,(e,t)=>{G(t)&&(a=a.replace(`{${e}}`,t))}),a}ToggleLoading(e){(e===ct.HIDE?M.Hide:M.Show)(this.Frame.Loading)}}const Ft=e=>{const r=M.Utils.CreateUEID("editor-body",!1);var t=M.Utils.CreateUEID("editor-default",!1);const a=`<link id="${t}" rel="stylesheet" href="${H.JoinURL("css","skins/Editor")}">`;var n=M.Utils.CreateUEID("skin",!1);const o=`<link id="${n}" rel="stylesheet" href="${H.JoinURL("css",`skins/${e}/skin`)}">`;return{DefaultCSSId:t,DefaultCss:a,SkinCSSId:n,SkinCSSLink:o,IFrame:(e,t=!1)=>{return M.Utils.IsIFrame(e)&&(e=e.contentDocument)?(t=t?a:E(o,a),t=E("<!DOCTYPE html>","<html>",`<head>${t}</head>`,`<body id="${r}" contenteditable="true"></body>`,"</html>"),e.write(t),e.close(),e.body):null},Div:e=>{var t=M.Create("div",{attrs:{id:r,contenteditable:"true"}});return M.Insert(e,t),t}}},Lt=e=>{const c=e,u=c.DOM,o=c.Utils.Caret,r=e=>{var t=u.SelectAll({tagName:u.Element.Figure.Selector},e),t=(O(t,e=>{var t=u.GetAttr(e,"type");t&&u.Element.Figure.HasType(t)||u.Remove(e)}),u.SelectAll({tagName:A(Qe)},e));O(t,e=>{var t,r;u.Element.Table.Is(e)&&(r=u.SelectAll("colgroup",e),O(r,e=>u.Remove(e)),u.SetAttrs(e,{contenteditable:"true",border:"1"}),r=u.SelectAll({attrs:["width"]},e),O(r,e=>{u.SetStyle(e,"width",u.GetAttr(e,"width")+"px"),u.RemoveAttr(e,"width")}),r=u.SelectAll({attrs:["width"]},e),O(r,e=>{u.SetStyle(e,"height",u.GetAttr(e,"height")+"px"),u.RemoveAttr(e,"height")}),u.RemoveAttrs(e,"width","height")),u.Element.Figure.FindClosest(e)||(r=u.Element.Figure.Create(u.Utils.GetNodeName(e)),u.CloneAndInsert(r,!0,e),null!=(t=e.parentNode)&&t.replaceChild(r,e))})},l=e=>{var t=u.SelectAll({tagName:"br",class:"Apple-interchange-newline"},e),t=(P(t,e=>u.Remove(e)),u.SelectAll({attrs:["style"]},e));P(t,e=>{var t,r=null!=(r=u.GetAttr(e,H.ATTRIBUTES.STYLE))?r:"",a=u.Utils.GetNodeName(e);return B(r)?u.Utils.IsSpan(e)?(t=e.parentNode,!m.Figures.has(a)&&t?(a=u.GetChildNodes(e),x(a)?void u.Remove(B(u.GetText(t))?t:e):(t.replaceChild(a[0],e),u.InsertAfter(a[0],...a.slice(1,a.length)))):void 0):u.RemoveAttr(e,"style"):u.SetStyleText(e,r)}),r(e)},i=(e,t)=>{var r=u.SelectAll({tagName:A(tt)},t);if(x(r)){var a=e,n=t,o=u.Utils.GetFirstChild(n),l=u.Utils.GetLastChild(n),i=u.Utils.GetLastChild(n,!0);if(a.Range.Insert(n),(null==o?void 0:o.parentElement)===c.GetBody()||(null==l?void 0:l.parentElement)===c.GetBody()){var a=null!=(n=null!=(a=null==o?void 0:o.previousSibling)?a:null==l?void 0:l.nextSibling)?n:c.GetBody(),n=a===(null==l?void 0:l.nextSibling)?u.InsertBefore:a===(null==o?void 0:o.previousSibling)?u.InsertAfter:u.Insert,s=c.CreateEmptyParagraph();u.Remove(u.Utils.GetFirstChild(s));let e=o;for(;e;){var d=e.nextSibling;if(u.Insert(s,e),e===l)break;e=d}n(a,s)}return i}return h(r),u.Utils.GetLastChild(((e,t)=>{var t=u.GetChildNodes(t),r=c.Utils.Shared.SplitLines(e.Start.Node,e.Start.Offset)["EndBlock"];const n=_.GetParentIfText(e.Start.Node),o=p(",",...m.Block);n===c.GetBody()&&(1===(e=c.GetLines()).length&&x(u.GetChildNodes(e[0]))&&u.Remove(e[0]),h(e));let l=!0,i=n;O(t,e=>{var t=u.Utils.GetNodeName(e);if(l){if(l=!1,m.Block.has(t)){var r=null!=(r=u.Closest(n,o))?r:u.Closest(n,Ze);if(r)return i=r,u.Insert(r,...u.GetChildNodes(e))}if(u.Element.Figure.Is(n)&&!u.Element.Table.Is(u.Element.Figure.SelectFigureElement(n))){i=e;const a=n===c.GetBody()?u.Insert:u.InsertAfter;return a(n,e)}}if(m.Figures.has(t)){r=null!=(r=null!=(r=u.Closest(i,qe))?r:u.Closest(i,o))?r:i;i=e;const a=r?u.InsertAfter:u.Insert;return a(null!=r?r:c.GetBody(),e)}if(m.List.has(t)){r=u.Closest(i,qe);if(r&&t===u.Utils.GetNodeName(r))return i=r,u.Insert(r,...u.GetChildNodes(e))}const a=i===c.GetBody()?u.Insert:u.InsertAfter;a(i,e),i=e});var e=u.Utils.GetNodeName(i),t=null!=r?r:i.nextSibling,r=u.Utils.GetNodeName(t);return e===r&&m.List.has(e)&&m.List.has(r)?(e=u.Utils.GetLastChild(i),O(u.GetChildNodes(t),e=>{if(B(u.GetText(e)))return u.Remove(e);u.Insert(i,e)}),u.Remove(t),e):((i?u.InsertAfter:u.Insert)(null!==i&&void 0!==i?i:c.GetBody(),t),i)})(e,t),!0)};return{EditFigures:r,CleanUnusable:l,InsertFragment:i,GetProcessedFragment:(r,t)=>{var a=()=>{var e;return t?(e=r.Range.Extract(),_.CleanDirtyWithCaret(c,r),e):r.Range.CloneContents()};let n;if(r.Start.Node!==r.End.Node){var o=u.Closest(_.GetParentIfText(r.SameRoot),"a");if(r.SameRoot===c.GetBody()||!o)return a();n=a();var o=u.Clone(o);u.Insert(o,...u.GetChildNodes(n)),u.Insert(n,o)}else{var l=null!=(o=u.Closest(_.GetParentIfText(r.Start.Node),{tagName:A(m.Block)}))?o:u.Closest(_.GetParentIfText(r.Start.Node),Ze),o=r.Start.Node.parentNode;if(!l||!o)return a();n=u.CreateFragment();let e=o.parentNode,t=u.Clone(o);for(u.Insert(t,a());e&&e!==l;){var i=u.Clone(e);u.Insert(i,t),t=i,e=e.parentNode}u.Insert(n,t)}return n},ConvertHTMLToFragment:e=>{var t=u.Create("fragment"),e=(u.SetHTML(t,(e=e,u.Utils.EscapeComments(e).replace(/<\/?html.*?>/gs,"").replace(/<\/?head.*?>/gs,"").replace(/<\/?body.*?>/gs,"").replace(/(\r\n|\n|\r)/gm,""))),u.CreateFragment());return u.Insert(e,...u.GetChildNodes(t,!1)),u.Remove(t),e},FinishInsertion:(e,t)=>{l(t);var r,a=c.Utils.Range(),n=u.GetChildNodes(t),t=(c.Dispatch("Nodes:Insert:Before",n),i(e,t));t&&(r=u.Utils.GetNodeName(t),m.Figures.has(r)?(r=u.Element.Figure.Is(t)?t:t.parentElement,a.SetStartToEnd(r,0,0)):(r=D(t)?t.length:0,a.SetStartToEnd(t,r,r)),c.Scroll(_.GetParentIfText(t))),_.CleanDirtyWithCaret(c,e),o.UpdateRange(a),c.Utils.Shared.DispatchCaretChange(),c.Dispatch("Nodes:Insert:After",n)}}},Dt=(e,r)=>{const a=e.DOM;var t=Lt(e);if(r.clipboardData){var n=e.Utils.Caret.Get();if(!n){const u=a.Element.Table.GetSelectedCells(e);if(x(u))return;var o=a.Element.Table.FindClosest(u[0]);if(!o)return;W(r);var l=a.Element.Table.GetGridWithIndex(o)["Grid"];const g=a.Clone(o);return P(l,e=>{const r=a.Create(a.Element.Table.RowSelector);P(e,e=>{var t=Z(u,e);-1!==t&&(e=a.Clone(e,!0),a.Insert(r,e),a.Element.Table.ToggleSelectCell(!1,e),S(u,t))}),a.Utils.HasChildNodes(r)&&a.Insert(g,r)}),r.clipboardData.clearData(),r.clipboardData.setData("text/html",a.GetOuterHTML(g))}o=r.type===I.cut;if(!n.IsRange()){if(!a.Element.Figure.Is(n.Start.Node))return;var l=a.Element.Figure.SelectFigureElement(n.Start.Node);if(!l)return;W(r);const c=a.GetOuterHTML(l);return o&&a.Remove(n.Start.Node),r.clipboardData.clearData(),r.clipboardData.setData("text/html",c)}if(n.Start.Node===n.End.Node&&n.Start.Offset!==n.End.Offset){if(!D(n.Start.Node)||!n.Start.Node.textContent)return;W(r);var l=p(",",...m.Block),i=_.GetParentIfText(n.Start.Node),s=null!=(l=a.Closest(i,l))?l:a.Closest(i,Ze);let e=a.CreateTextNode(n.Start.Node.textContent.slice(n.Start.Offset,n.End.Offset)),t=n.Start.Node.parentNode;for(;t&&t!==s;){var d=a.Clone(t);a.Insert(d,e),e=d,t=t.parentNode}const c=D(e)?null!=(l=e.textContent)?l:"":a.GetOuterHTML(e);return r.clipboardData.clearData(),r.clipboardData.setData("text/html",c)}W(r);i=t.GetProcessedFragment(n,o),l=e.Tools.Parts.Manager.SelectParts(!0,i),t=(P(l,e=>a.Remove(e)),a.Create("fragment"));a.Insert(t,...a.GetChildNodes(i));const c=a.GetHTML(t);a.Remove(t),r.clipboardData.clearData(),r.clipboardData.setData("text/html",c)}},Ot=(e,t)=>{var r=e.DOM;const a=e.Utils.Caret,n=Lt(e);if(t.clipboardData&&!x(A(t.clipboardData.items))){var o=a.Get(),e=r.Element.Table.GetSelectedCells(e);const{Figure:l,FigureElement:i}=r.Element.Figure.Find(o?_.GetParentIfText(o.Start.Node):null!=(e=e[0])?e:null);if(l&&i&&!(r.Element.Table.Is(i)&&o&&r.Element.Table.FindClosestCell(_.GetParentIfText(o.SameRoot)))){const s=e=>{var t=a.CreateFake(l,0,l,0),e=n.ConvertHTMLToFragment(e);n.FinishInsertion(t,e)};P(t.clipboardData.items,e=>{U(e.type,"html")&&(W(t),e.getAsString(s))})}}},Bt=e=>{const l=e,i=l.DOM,s=l.Utils.Caret,d=l.Tools.Parts;l.On("Caret:Change",e=>{d.ChangePositions();var t=i.SelectAll({attrs:"caret"});if(!x(t)){const n=[];P(e,e=>{i.HasAttr(e,"caret")&&k(n,e)}),P(t,e=>{if(!C(n,e)){if(!B(i.GetText(e)))return i.SetOuterHTML(e,i.GetHTML(e));const r=null!=(t=null!=(t=i.Closest(e,p(",",...m.Block)))?t:i.Closest(e,p(",",...m.FollowingItems)))?t:l.GetBody();var t=i.GetParents(e,!0);P(t,(e,t)=>{if(!B(i.GetText(e))||e===r)return i.Utils.HasChildNodes(e)||i.Insert(e,i.Create("br")),t();i.Remove(e,!0)})}})}if(e=i.SelectAll({tagName:A(Qe)}),O(e,e=>{var t,r,a;i.Element.Figure.Is(e)||(a=i.Element.Figure.FindClosest(e),t=i.Element.Figure.FindType(i.Utils.GetNodeName(e)),r=null!=a?a:i.Element.Figure.Create(t),a||(i.InsertAfter(e,r),i.Insert(r,e)),d.Manager.SelectParts(!1,r))||(a=d.Create(t,e),i.Insert(r,a))}),!l.IsAdjusting()){t=s.Get();if(t){var e=_.GetParentIfText(t.Start.Node),{Figure:r,FigureElement:a}=i.Element.Figure.Find(e),e=(d.UnsetAllFocused(r),!!r&&!(null==t||!t.IsRange())&&i.Element.Figure.FindClosest(e)!==r);if(r&&a&&!e){let e=null;i.Element.Table.Is(a)||t.Start.Node!==r&&t.End.Node!==r||(t.Range.SetStartToEnd(r,t.Start.Offset,t.Start.Offset),e=t.Range.Clone()),e&&s.UpdateRange(e),i.HasAttr(r,H.ATTRIBUTES.FOCUSED)||i.SetAttr(r,H.ATTRIBUTES.FOCUSED),d.ChangePositions()}}}if(!l.IsAdjusting()){e=s.Get();if(e){a=m.Focusable;P(i.SelectAll(p(",",...a)),e=>i.RemoveAttr(e,H.ATTRIBUTES.FOCUSED));const o=_.GetParentIfText(e.Start.Node);let t=null;P(A(a),e=>{e=i.Closest(o,e);(!t||e&&i.Utils.IsChildOf(e,t))&&(t=e)}),t&&i.SetAttr(t,H.ATTRIBUTES.FOCUSED)}}})},wt=(e,t)=>{const n=e,o=n.DOM,l=n.Utils.Caret;var e=t.target;if(F(e)){const i=o.Utils.GetNodeName(e);var r=o.Element.Figure.Is(e);if(o.Element.Figure.FigureTypeSetMap.media.has(i)||o.Element.Figure.FigureTypeSetMap.hr.has(i)||r){const{Figure:s,FigureType:a,FigureElement:d}=o.Element.Figure.Find(e);if(!r||s&&a&&d){const c=r?d:t.target,u=(null!=(e=t.dataTransfer)&&e.setData("text/html",o.GetOuterHTML(c)),null!=(r=t.dataTransfer)&&r.setDragImage(c,0,0),(e,t)=>{let r=null!==s&&void 0!==s?s:c.parentElement;o.Element.Figure.Is(r)||(a=o.Element.Figure.FindType(i),r=o.Element.Figure.Create(i),o.Insert(r,c),a=n.Tools.Parts.Create(a,c),o.Insert(r,a)),o.InsertAfter(e,t,r);var a=n.Utils.Range();a.SetStartToEnd(r,1,1),l.UpdateRange(a)}),g=e=>{W(e),n.Off(I.beforeinput,g);e=l.Get();if(e){var t,r=o.Element.Figure.FindClosest(_.GetParentIfText(e.Start.Node));if(r!==(null!=(r=c.parentElement)?r:c))return D(e.SameRoot)?({StartBlock:r,EndBlock:t}=n.Utils.Shared.SplitLines(e.SameRoot,e.Start.Offset),void u(r,t)):u(e.Start.Path[0],null)}};n.On(I.beforeinput,g,!0)}}}},xt=t=>{var r=t.DOM,a=t.Utils.Caret,n=t.GetLines(!1),o=a.Get();if(o){var l,i,o=o.Start.Path[0];if(n[n.length-1]===o&&B(r.GetText(o))&&(l=o,!(i=t).DOM.Element.Figure.Is(l)||!i.DOM.HasAttr(l,"type",i.DOM.Element.Table.Selector))){r.Remove(o);let e=r.Utils.GetLastChild(n[n.length-1],!0);(e=r.Utils.IsBr(e)?e.parentNode:e)&&(l=t.Utils.Range(),i=D(e)?e.length:0,l.SetStartToEnd(e,i,i),a.UpdateRange(l))}}},Pt=(e,t)=>{var r=e.DOM,a=e.Utils.Caret;B(r.GetHTML(e.GetBody()).replace(/(\\n|\\t|\s|\<br\>)/gi,""))&&(W(t),e.InitContent(),t=r.Utils.GetFirstChild(e.GetBody()))&&((r=e.Utils.Range()).SetStartToEnd(t,0,0),a.UpdateRange(r))},kt=(e,t)=>{const r=e,a=r.DOM;var e=r.Utils.Caret,n=t.key===y.Backspace||t.code===y.Backspace,o=t.key===y.Delete||t.code===y.Delete;(n||o)&&(o=a.Element.Table.GetSelectedCells(r),e.Get()||x(o)||(W(t),t=n?o[o.length-1]:o[0],O(o,e=>{var t=a.GetChildNodes(e),t=(O(t,e=>a.Remove(e,!0)),r.CreateEmptyParagraph());a.Insert(e,t),a.Element.Table.ToggleSelectCell(!1,e)}),n=r.Utils.Range(),o=a.Utils.GetFirstChild(t,!0),n.SetStartToEnd(o,0,0),e.UpdateRange(n),r.Utils.Shared.DispatchCaretChange()))},Ht=(e,t)=>{var r,a=e.DOM,n=e.Utils.Caret;t.key!==y.Enter&&t.code!==y.Enter||(r=n.Get())&&!r.IsRange()&&a.Element.Figure.Is(r.Start.Node)&&(W(t),t=r.Start.Node,((r=0===r.Start.Offset)?a.InsertBefore:a.InsertAfter)(t,t=e.CreateEmptyParagraph()),r||((r=e.Utils.Range()).SetStartToEnd(a.Utils.GetFirstChild(t),0,0),n.UpdateRange(r),e.Utils.Shared.DispatchCaretChange([t])))},Mt=(e,a)=>{const n=e,o=n.DOM,l=(e,t)=>{W(a);var r=n.Utils.Range();r.SetStartToEnd(e,t,t),n.Utils.Caret.UpdateRange(r),n.Utils.Shared.DispatchCaretChange()},i=(e,t,r)=>{var a=r?o.Utils.GetLastChild:o.Utils.GetFirstChild,t=a(t);return t&&o.Element.Figure.Is(t)?l(t,r?1:0):(t=a(t,!0))?(a=r&&D(t)?t.length:0,void l(t,a)):l(e,r?0:1)};return{UpdateRange:l,UpdateRangeWithDescendants:i,UpdateRangeWithFigure:(e,t)=>{var r;if(L(e))return(r=t?e.previousElementSibling:e.nextElementSibling)?void i(e,r,t):l(e,t?0:1)},IsLastOffset:(t,e,r)=>{if(D(t)&&(r?0:t.length)!==e)return!1;var a=o.Closest(_.GetParentIfText(t),{tagName:A(m.Block)});if(a){let e=t;for(;e;){if(e===a||e===n.GetBody())return!0;if(r?e.previousSibling:e.nextSibling)return!1;e=e.parentNode}}return!0}}},Wt=(e,t)=>{const n=e,l=n.DOM;var e=n.Utils.Caret,r=t.key===y.Tab||t.code===y.Tab,a=t.shiftKey,o=t.key===y.ArrowUp||t.code===y.ArrowUp,i=t.key===y.ArrowDown||t.code===y.ArrowDown;const s=t.key===y.ArrowLeft||t.code===y.ArrowLeft,d=t.key===y.ArrowRight||t.code===y.ArrowRight,c=t.key===y.Backspace||t.code===y.Backspace,u=t.key===y.Delete||t.code===y.Delete;var g=a&&r||s,a=!a&&r||d;if(o||i||g||a||c||u){const h=o||s||c,f=(_.CleanDirtyWithCaret(n,e.Get()),e.Get());if(f&&!f.IsRange()){const S=Mt(n,t);r=()=>n.Utils.Shared.DispatchCaretChange();return(()=>{if(!l.Element.Figure.Is(f.Start.Node))return!1;var e,{Figure:t,FigureType:r,FigureElement:a}=l.Element.Figure.Find(f.Start.Node);if(!t||!r||!a)return!1;if(c||u)n.History.Archiver.Path.Record(),n.History.Archiver.Path.Archive(),r=!!t.previousElementSibling,(e=null!=(e=t.previousElementSibling)?e:t.nextElementSibling)?l.Element.Figure.Is(e)?S.UpdateRange(e,r?1:0):S.UpdateRangeWithDescendants(e,e,r):(e=n.CreateEmptyParagraph(),l.InsertAfter(t,e),S.UpdateRange(l.Utils.GetFirstChild(e),0)),l.Remove(t,!0),n.History.Archiver.History.Record();else{if(l.Element.Table.Is(a))return!1;s&&0!==f.Start.Offset||d&&1!==f.Start.Offset?S.UpdateRange(t,s?0:1):S.UpdateRangeWithFigure(t,h)}return!0})()?r():((e,c,a)=>{const n=e,u=n.DOM,g=c.key===y.Tab||c.code===y.Tab;e=c.shiftKey;const o=c.key===y.ArrowUp||c.code===y.ArrowUp;var t=c.key===y.ArrowDown||c.code===y.ArrowDown;const h=e&&g||c.key===y.ArrowLeft||c.code===y.ArrowLeft,l=!e&&g||c.key===y.ArrowRight||c.code===y.ArrowRight;var e=c.key===y.Backspace||c.code===y.Backspace,r=c.key===y.Delete||c.code===y.Delete;if(!(o||t||h||l||!e&&!r))return!1;const i=o||h,f=Mt(n,c),s=(e,t)=>{let r=t;for(;r;){var a=r.parentNode;if(!a||a===e||a===n.GetBody())return r;r=a}return r},S=e=>{var t,r;return!(g||(t=(i?a.Start:a.End).Node,r=(i?a.Start:a.End).Offset,e=s(e,t),(e=i?e.previousSibling:e.nextSibling)?((h||l)&&!f.IsLastOffset(t,r,i)||!u.Element.Figure.Is(e)||u.Element.Table.Is(e)||f.UpdateRange(e,i?1:0),0):!h&&!l||f.IsLastOffset(t,r,i)))};var d;return u.Element.Figure.Is(a.Start.Node)?(i&&0===a.Start.Offset||!i&&1===a.Start.Offset?f.UpdateRangeWithFigure(a.Start.Node,i):(e=u.Element.Figure.Find(a.Start.Node).FigureElement,e&&(r=u.Element.Table.GetAllOwnCells(e),f.UpdateRangeWithDescendants(a.Start.Node,r[i?r.length-1:0],i))),!0):(e=(h?a.Start:a.End).Node,r=_.GetParentIfText(e),{Table:e,Row:r,Cell:d}=u.Element.Table.Find(r),!!(e&&r&&d)&&-1!==(r=u.Element.Table.GetGridWithIndex(e,d)).TargetCellRowIndex&&-1!==r.TargetCellIndex&&(o||t?e=>{var{Grid:e,TargetCellRowIndex:t,TargetCellIndex:r}=e,a=e[t][r];if(S(a))return!1;W(c);t+=o?-1:1;return t<0||t>=e.length?!!(a=u.Element.Figure.FindClosest(a))&&(f.UpdateRange(a,o?0:1),!0):!!(a=e[t][r])&&(f.UpdateRangeWithDescendants(a,a,o),!0)}:e=>{var t,{Grid:r,TargetCellRowIndex:e,TargetCellIndex:a}=e,n=r[e][a];if(S(n))return!1;var o=h?0:r.length-1,l=h?0:r[e].length-1;if(e===o&&a===l)return W(c),!!(o=u.Element.Figure.FindClosest(n))&&(f.UpdateRange(o,h?0:1),!0);if(!g)return!1;var i=h?-1:1;let s=e,d=a;for(;null!=(t=r[s])&&t[d]&&(null==(t=r[s])?void 0:t[d])===n;)0<=(d+=i)&&d<r[s].length||(s+=i,d=h?r[s].length-1:0);o=null==(l=r[s])?void 0:l[d];return o?(f.UpdateRangeWithDescendants(o,o,h),!0):!!(e=u.Element.Figure.FindClosest(n))&&(f.UpdateRange(e,h?0:1),!0)})(r))})(n,t,f)?r():((()=>{var t=l.Closest(_.GetParentIfText(f.Start.Node),{tagName:A(m.Block)});if(t){var r=(h?l.Utils.GetFirstChild:l.Utils.GetLastChild)(t,!0),a=(D(f.Start.Node)?f.Start.Node:l.GetText(f.Start.Node)).length;if(!(!r||h&&0!==f.Start.Offset||!h&&a>f.Start.Offset)&&S.IsLastOffset(f.Start.Node,f.Start.Offset,h)){r=l.Closest(t,Ze);let e;if(r){var a=h?t.previousElementSibling:t.nextElementSibling,n=h?r.previousElementSibling:r.nextElementSibling,r=h?null==(o=r.parentElement)?void 0:o.previousElementSibling:null==(o=r.parentElement)?void 0:o.nextElementSibling;if(a||n||!r)return;e=r}else{var o=h?t.previousElementSibling:t.nextElementSibling;if(!o)return;e=o}l.Element.Figure.Is(e)&&(a=h?1:0,S.UpdateRange(e,a))}}})(),void r())}}},Kt=(e,t)=>{W(t);var r,t=e.GetLines(),a=M.Utils.GetFirstChild(t[0],!0),t=M.Utils.GetLastChild(t[t.length-1],!0);a&&t&&((r=e.Utils.Range()).SetStart(a,0),r.SetEnd(t,D(t)?t.length:0),e.Utils.Caret.UpdateRange(r),e.Utils.Shared.DispatchCaretChange(),e.Focus())},_t=(e,t)=>{var r=e.DOM,a=e.Tools.Parts;if(!e.IsAdjusting()&&t.composedPath()[0]){var{Figure:t,FigureType:n,FigureElement:o}=r.Element.Figure.Find(t.composedPath()[0]);if(!t||!n||!o)return a.HideAll();"table"!==n&&((o=e.Utils.Range()).SetStartToEnd(t,0,0),e.Utils.Caret.UpdateRange(o),e.Utils.Shared.DispatchCaretChange([t])),r.SetAttr(t,H.ATTRIBUTES.FOCUSED),a.ChangePositions()}},Yt=(e,r)=>{const a=e.DOM;var n=e.Tools.Parts;if(!e.IsAdjusting()){e=e.Utils.Caret.Get();if(null!=e&&e.IsRange())return n.HideAll();const o=a.Element.Figure.Find(r.composedPath()[0])["Figure"];if(!o)return n.HideAll();e=n.Manager.SelectParts(!0,o);let t;P(e,e=>{a.Element.Figure.FindClosest(e)===o&&(t=e)}),n.HideAll(t),t&&a.IsHidden(t)&&(n.Show(t),n.ChangePositions())}},zt=(e,t,...r)=>{const a=e.DOM,n=e=>{W(e);e=b(e,"touches")?e.touches.item(0):e;e&&t(e)};P(r,e=>a.On(e,I.mousedown,n)),P(r,e=>a.On(e,I.touchstart,n))},jt=(e,t,r,a=!1)=>{const n=e.DOM,o=[];var l=e=>{W(e);e=b(e,"touches")?e.touches.item(0):e;e&&t(e)},i=e=>{W(e);e=b(e,"touches")?e.touches.item(0):e;e&&(r(e),O(o,e=>n.Off(e[0],e[1],e[2])))},a=a?window:e.GetWin();k(o,[a,I.mousemove,l],[a,I.touchmove,l],[a,I.mouseup,i],[a,I.touchend,i],[window,I.mouseup,i],[window,I.touchend,i]),P(o,e=>n.On(e[0],e[1],e[2]))},$t=16,Vt=-6,Jt=(e,t)=>t?e+"px":e,Y=(e,t,r)=>{return null!=(t=null==(e=e.DOM.GetRect(t))?void 0:e[r])?t:0},Xt=(e,t=!1)=>Jt(e-$t/2,t),qt=(e,t=!1)=>Jt(e+Vt,t),Zt=(e,t=!1)=>Jt(e+-3,t),Qt=(e,t)=>{e=e.DOM,t=e.Element.Figure.Find(t).Figure;return t?e.Select({attrs:[H.ATTRIBUTES.PARTS_MENU]},t):null},er=(e,a,...t)=>{const n=e,o=n.DOM;zt(n,e=>{var t,r;F(e.target)&&({Figure:t,FigureElement:r}=o.Element.Figure.Find(e.target),t)&&r&&(n.Dispatch("Tools:Adjust:Start",r),a(e,t,r))},...t)},tr=(e,t,r,a)=>{const n=e,o=n.DOM;n.SetAdjusting(!0),o.Hide(Qt(n,t));jt(n,e=>{n.Dispatch("Tools:Adjust:Move",t),r(e)},e=>{a(e),n.SetAdjusting(!1),n.Dispatch("Tools:Adjust:Finish",t),o.Show(Qt(n,t)),n.Tools.Parts.ChangePositions()})},rr=(e,a)=>{const n=e,o=n.DOM;e=o.SelectAll({class:o.Utils.CreateUEID("options",!1)},a);P(e,e=>{var t,r=o.GetAttr(e,H.ATTRIBUTES.TYPE);r&&((t={})[H.ATTRIBUTES.TYPE]=r,r=o.Select({attrs:t},a))&&n.Formatter.UI.SetOptionListInToolsMenuCoordinate(n,r,e)})},ar=(e,t)=>{const r=e.DOM;if(!e.IsAdjusting()){var a,n,o,l,i,s,d,e=t.target;const{Figure:c,FigureElement:u}=r.Element.Figure.Find(e);c&&u&&r.Element.Table.Is(u)&&(a=r.Element.Table.FindClosestCell(e))&&(n=(o=e=>{var t={};return t[H.ATTRIBUTES.ADJUSTABLE_LINE]=e,r.Select({attrs:t},c)})("width"),o=o("height"),e!==n)&&e!==o&&({pageX:e,pageY:t}=t,l=u.offsetLeft+a.offsetLeft,i=u.offsetTop+a.offsetTop,s=c.offsetLeft+l,d=c.offsetTop+i,e-s<=a.offsetWidth/2?r.SetStyle(n,"left",Zt(l,!0)):e-s>a.offsetWidth/2&&r.SetStyle(n,"left",Zt(l+a.offsetWidth,!0)),t-d<=a.offsetHeight/2?r.SetStyle(o,"top",Zt(i,!0)):t-d>a.offsetHeight/2&&r.SetStyle(o,"top",Zt(i+a.offsetHeight,!0)))}},nr=(e,t)=>{const g=e,h=g.DOM;let f=!1;e=t.composedPath()[0];if(F(e)){t={},t=(t[H.ATTRIBUTES.FIXED]="parts-tool",!!h.Closest(e,{attrs:t}));if(!t){t=h.Element.Table.GetSelectedCells(g);h.Element.Table.ToggleSelectMultipleCells(!1,t);const{Table:S,Row:r,Cell:m}=h.Element.Table.Find(e);if(S&&r&&m){const p=h.Element.Table.GetAllOwnRows(S),T=Z(p,r),{Grid:C,TargetCellIndex:v}=h.Element.Table.GetGridWithIndex(S,m);if(-1!==v){t=e=>{const r=h.Element.Table.FindClosestCell(e.composedPath()[0]);e=null===r||void 0===r?void 0:r.parentElement;if(!r||!e||r===m||!h.Element.Table.IsRow(e))return f?(g.Utils.Caret.CleanRanges(),h.Element.Table.ToggleSelectCell(!0,m),P(h.Element.Table.GetSelectedCells(g,S),e=>{e!==m&&h.Element.Table.ToggleSelectCell(!1,e)})):void 0;g.Utils.Caret.CleanRanges(),f=!0;e=Z(p,e);let a=-1;if(P(C,(e,t)=>{if(-1!==a)return t();a=Z(e,r)}),-1!==a){var n=Math.min(T,e),o=Math.max(T,e),l=Math.min(v,a),i=Math.max(v,a);for(let e=0,t=C.length;e<t;++e){var s=C[e],d=e>=n&&e<=o;for(let e=0,t=s.length;e<t;++e){var c=s[e],u=d&&e>=l&&e<=i;h.Element.Table.ToggleSelectCell(u,c)}}}};const a=[];e=()=>O(a,e=>h.Off(e[0],e[1],e[2]));k(a,[S,I.mousemove,t],[S,I.touchmove,t],[g.GetWin(),I.mouseup,e],[g.GetWin(),I.touchend,e],[window,I.mouseup,e],[window,I.touchend,e]),P(a,e=>h.On(e[0],e[1],e[2]))}}}}},or=e=>{M.On(window,I.resize,e.Tools.Parts.ChangePositions);{var t=e;const r=t;t=e=>()=>{(e?M.AddClass:M.RemoveClass)(r.Frame.Container,"focused")},r.On(I.focus,t(!0)),r.On(I.focusin,t(!0)),r.On(I.focusout,t(!1)),r.IsIFrame()&&M.On(r.GetWin(),I.click,e=>{e.target===r.DOM.GetRoot()&&r.GetBody().focus()}),M.On(window,I.focusout,t(!1))}{const a=t=e;if(a.Config.Mode===Ae.inline){const n="inline-trace",o=M.Utils.CreateUEID("toolbar-shuck"),l=()=>M.Select({attrs:{id:o}},a.Frame.Root),i=(e,t)=>{if(e)return M.RemoveStyles(a.Frame.Toolbar,"top","left"),M.RemoveAttr(a.Frame.Toolbar,n),M.Remove(l());l()||(M.SetAttr(a.Frame.Toolbar,n),M.SetStyles(a.Frame.Toolbar,{top:"0px",left:t.left+"px"}),e=M.Create("div",{attrs:{id:o},styles:{height:t.height+"px"}}),M.InsertAfter(a.Frame.Toolbar,e))},s=()=>M.HasAttr(a.Frame.Toolbar,n);M.On(window,I.scroll,()=>{var e=M.GetRect(a.Frame.Toolbar),t=M.GetRect(a.Frame.Root);if(e&&t)return 0<t.top?s()?i(!0,e):void 0:void(s()||i(!1,e))})}}},lr=e=>{const n=e,o=n.DOM,l=n.Utils.Caret,r=Lt(n);let i=null,s=null;const d=t=>{if(t(l.Get()),i){_.CleanDirty(n,o.GetChildNodes(i));let e=l.Get();t=o.Element.Table.GetSelectedCells(n);if(e||!x(t)){t=e?_.GetParentIfText(e.Start.Node):t[0];if(!e){t=o.Element.Figure.FindClosest(t);if(!t)return;e=l.CreateFake(t,0,t,0)}r.FinishInsertion(e,i)}}},a=t=>e=>{e&&(n.Utils.Shared.DeleteRange(e),_.CleanDirtyWithCaret(n,e),i=r.ConvertHTMLToFragment(t))},c=e=>{W(e);e=l.Get();if(e)return D(e.Start.Node)?void(i=r.GetProcessedFragment(e,!0)):(i=e.Range.Extract(),_.CleanDirtyWithCaret(n,e))},u=e=>()=>W(e),g=()=>{var e=null!=(e=null==(e=l.Get())?void 0:e.SameRoot)?e:null;let t=e?_.GetParentIfText(e):null;for(;t&&t.parentNode!==n.GetBody();)t=t.parentNode;s=o.Utils.GetNodeName(t)},h=t=>{if(t.dataTransfer)return 1===t.dataTransfer.items.length?(W(t),t.dataTransfer.items[0].getAsString(e=>d(a(e)))):void P(t.dataTransfer.items,e=>{U(e.type,"html")&&(W(t),e.getAsString(e=>d(a(e))))})};return{GetBefore:(e,t)=>{var r=t;switch(r.inputType){case je.deleteByDrag:return c(r);case je.insertFromDrop:return i?d(u(r)):h(r);case je.insertParagraph:return g();default:var a=v(r.inputType);return U(a,"delete")||U(a,"text")||!r.dataTransfer?void 0:h(r)}},Get:(e,t)=>{return a=()=>{n.Utils.Shared.DispatchCaretChange(),s=null},(t=t).inputType!==je.insertParagraph||!s||!m.List.has(s)||!(t=l.Get())||t.SameRoot.parentNode!==n.GetBody()||o.Utils.IsParagraph(t.SameRoot)?a():(r=n.CreateEmptyParagraph(),n.GetBody().replaceChild(r,t.SameRoot),(t=n.Utils.Range()).SetStartToEnd(r,0,0),l.UpdateRange(t),void a());var r,a}}},ir=e=>{t=e,c(t,I.copy,Dt),c(t,I.cut,Dt),c(t,I.paste,Ot),t=e,Bt(t),t=e,c(t,I.dragstart,wt);{var t;const a=t=e;var t=()=>a.Utils.Shared.DispatchCaretChange(),r=()=>{a.DOM.EventUtils.FindAndUnbindDetached().catch(console.error)};c(a,I.keyup,Pt),c(a,I.keypress,Pt),c(a,I.keydown,Pt),c(a,I.keydown,kt),c(a,I.keydown,Wt),Ve(a,I.keydown,y.Enter,Ht),Ve(a,I.keyup,y.Backspace,r),Ve(a,I.keyup,y.Delete,r),Ve(a,I.keyup,y.ArrowUp,t),Ve(a,I.keyup,y.ArrowDown,t),Ve(a,I.keyup,y.ArrowLeft,t),Ve(a,I.keyup,y.ArrowRight,t),Ve(a,I.keyup,y.Home,t),Ve(a,I.keyup,y.End,t),Ve(a,I.keyup,y.PageDown,t),Ve(a,I.keyup,y.PageUp,t),Ve(a,I.keyup,y.Enter,t),Ve(a,I.keydown,y.Backspace,xt),Je(a,I.keyup,y.KeyA,{bCtrl:!0},Kt)}{var r;const n=r=e;r=()=>n.Utils.Shared.DispatchCaretChange(),c(n,I.mouseup,r),c(n,I.touchend,r),c(n,I.mousedown,nr),c(n,I.touchstart,nr),c(n,I.mousemove,Yt),c(n,I.mousemove,ar),c(n,I.mouseup,_t),c(n,I.touchend,_t)}t=e,r=lr(t),c(t,I.beforeinput,r.GetBefore),c(t,I.input,r.Get),or(e)},sr=e=>{const h=e,f=h.DOM,i=e=>{var t,r=f.CreateFragment();r.append(...f.GetChildNodes(e,!1)),null!=(t=e.parentElement)&&t.replaceChild(r,e)},r=(e,t)=>{var{Tag:r,Switchable:e,AddInside:a,UnsetSwitcher:n}=e,o=p(",",...e),e=p(",",...a),a=_.GetParentIfText(t);if(!f.Closest(a,e)||f.Element.Table.FindClosestCell(a))(t=f.Closest(a,r))&&(e=null!=n?n:r,n=t,f.Utils.GetNodeName(n)!==e)&&(e=f.Create(e),f.Insert(e,...f.GetChildNodes(n,!1)),null!=(t=n.parentElement))&&t.replaceChild(e,n);else{let e=f.Closest(a,o);for(;e;)if(f.Utils.GetNodeName(e)!==r)e=f.Closest(e.parentElement,o);else{if(!f.Closest(e.parentElement,o)){i(e);break}var l=f.Closest(e.parentElement,o);i(e),e=l}}return!0},a=(e,t)=>{const{Tag:l,Styles:i}=e;if(!(i?f.ClosestByStyle(_.GetParentIfText(t),_.GetStyleSelectorMap(i)):f.Closest(_.GetParentIfText(t),l)))return!1;let r=t,a=t.parentNode;for(;a&&!et.has(f.Utils.GetNodeName(a));){const g=a;var n=(r=>{if(!i)return f.Utils.GetNodeName(r)===l;var a=N(i);for(let e=0,t=a.length;e<t;++e){var[n,o]=a[e],o="{{value}}"===o?void 0:o;if(f.HasStyle(r,n,o))return!0}return!1})(g),o=f.GetChildNodes(g);if(!(a=a.parentNode)||a===h.GetBody())break;var s=[],d=e=>{var t=f.Clone(g);return f.Insert(t,e),t};for(let e=0,t=o.length;e<t;++e){var c,u=o[e];f.HasAttr(u,"marker")||f.Element.Figure.Is(u)?k(s,u):u===r&&n?r=!i||(c=d(u),f.RemoveStyles(c,...te(i)),B(f.GetStyleText(c)))?(k(s,u),u):(k(s,c),c):(c=d(u),k(s,c),u===r&&(r=c))}a.replaceChild(s[0],g);for(let e=1,t=s.length;e<t;++e)f.InsertAfter(s[e-1],s[e])}return!0},n=(e,t)=>{var r,{StrictFormats:e,Styles:a}=e,t=(t=t,r=a,f.ClosestByStyle(_.GetParentIfText(t),_.GetStyleSelectorMap(r)));return!(!t||!e.has(f.Utils.GetNodeName(t))||(f.RemoveStyles(t,...te(a)),0))},o=(e,t)=>{switch(e.Type){case w.BLOCK:return r(e,t);case w.INLINE:return a(e,t);case w.STYLE:return n(e,t)}};return{Unwrap:(e,r)=>{if(!R(e))return o(e,r);P(e,(e,t)=>{if(o(e,r))return t()})}}},dr=e=>{const m=e,p=m.DOM,T=(e,r)=>{const a={};return N(e,(e,t)=>{a[e]=r?t.replace("{{value}}",r):t}),a},C=(e,t,r)=>{t!==p.Utils.GetNodeName(e)&&(t=p.Create(t),r&&p.SetStyles(t,r),r=D(e)||p.Utils.IsBr(e)?[e]:p.GetChildNodes(e,!1),p.CloneAndInsert(t,!0,...r),null!=(r=e.parentElement))&&r.replaceChild(t,e)},v=(r,e)=>N(e,(e,t)=>{p.HasStyle(r,e,t)||p.SetStyle(r,e,t)}),E=(e,t,r)=>{var{StrictFormats:e,Styles:a,SameStyles:n}=e,t=p.Closest(_.GetParentIfText(t),{tagName:A(e)});return!!t&&(e=T(a,r),R(n)&&p.RemoveStyles(t,...n),v(t,e),!0)};return{Wrap:(e,r,a)=>{var n=R(e)?e[0]:e;switch(n.Type){case w.BLOCK:{var o=n;var l=r;var{Tag:i,Switchable:s,AddInside:d}=o;let e=l,t=l;for(;t&&t!==m.GetBody();){var c=p.Utils.GetNodeName(t);if(!s.has(c)&&!d.has(c)||s.has(c)&&d.has(p.Utils.GetNodeName(t.parentNode)))t=(e=t).parentNode;else{if(s.has(c))return C(t,i);if(d.has(c))return C(e,i)}}return}case w.INLINE:{o=n;var t=r;l=a;var{Tag:u,Styles:o}=o,g=_.GetParentIfText(t);if(!o)return p.Closest(g,u)||tt.has(p.Utils.GetNodeName(t))?void 0:C(t,u);var h=T(o,l),f=p.Closest(g,{attrs:["style"]});if(!f)return C(t,u,h);let e=f;for(;e;){var S=p.GetChildNodes(e,!1);if(1<S.length)return C(t,u,h);if(e===t)return v(f,h);e=S[0]}return}case w.STYLE:return R(e)?P(e,(e,t)=>{e.Type===w.STYLE&&E(e,r,a)&&t()}):E(n,r,a)}}}},cr=(e,t)=>{const g=e,r=t,a={HeadingStyle:{bPreview:!0,Items:[{Format:K.Paragraph,Title:g.Lang("format.normal","Normal"),CommandName:"Normal"},{Format:K.Heading1,Title:g.Lang("format.heading1","Heading1"),CommandName:"Heading1",Keys:"Alt+Shift+1"},{Format:K.Heading2,Title:g.Lang("format.heading2","Heading2"),CommandName:"Heading2",Keys:"Alt+Shift+2"},{Format:K.Heading3,Title:g.Lang("format.heading3","Heading3"),CommandName:"Heading3",Keys:"Alt+Shift+3"},{Format:K.Heading4,Title:g.Lang("format.heading4","Heading4"),CommandName:"Heading4",Keys:"Alt+Shift+4"},{Format:K.Heading5,Title:g.Lang("format.heading5","Heading5"),CommandName:"Heading5",Keys:"Alt+Shift+5"},{Format:K.Heading6,Title:g.Lang("format.heading6","Heading6"),CommandName:"Heading6",Keys:"Alt+Shift+6"}],DisableList:o},BlockStyle:{bPreview:!1,Items:[{Format:K.Paragraph,Title:g.Lang("format.paragraph","Paragraph"),CommandName:"Paragraph"},{Format:K.Div,Title:g.Lang("format.div","Div"),CommandName:"Div"},{Format:K.Blockquote,Title:g.Lang("format.blockquote","Blockquote"),CommandName:"Blockquote"},{Format:K.Pre,Title:g.Lang("format.pre","Pre"),CommandName:"Pre"}],DisableList:o}},n=te(a),h=(e,t)=>E(e,":",t),f=(r,a)=>{for(let e=0,t=a.length;e<t;++e){var n=a[e];if(M.Closest(n,r))return!0}return!1},i=(t,r,a)=>e=>{((e,o)=>{const l=e,i=l.DOM,s=l.Formatter.Toggler,d=o["AddInside"],c=(e,t,r,a=!1)=>{if(!d.has(i.Utils.GetNodeName(r)))return s.Toggle(e,o,r);a={except:_.ExceptNodes(l,t,r,a),endNode:t};s.ToggleRecursive(e,o,r,a)},t=t=>{var e=i.Element.Table.GetSelectedCells(l);return!x(e)&&(P(e,e=>s.ToggleRecursive(t,o,e)),!0)},r=(e,t)=>{var r;return t.Start.Line===t.End.Line&&(r=_.GetParentIfText(t.Start.Node),t.Start.Node===t.End.Node||!i.Element.Table.FindClosest(r)&&!i.Closest(r,{tagName:A(d)})?s.Toggle(e,o,null!=(r=i.GetChildNodes(t.Start.Node,!1)[0])?r:t.Start.Node):(r={except:X(_.ExceptNodes(l,t.Start.Node,t.SameRoot,!0),_.ExceptNodes(l,t.End.Node,t.SameRoot)),endNode:t.End.Node},s.ToggleRecursive(e,o,t.SameRoot,r)),!0)},a=(t,r)=>{if(r.Start.Line===r.End.Line)return!1;var a=l.GetLines();c(t,r.Start.Node,a[r.Start.Line],!0);for(let e=r.Start.Line+1;e<r.End.Line;++e){var n=a[e];d.has(i.Utils.GetNodeName(n))?s.ToggleRecursive(t,o,n):s.Toggle(t,o,n)}return c(t,r.End.Node,a[r.End.Line]),!0};return{ToggleFromCaret:e=>_.SerialiseWithProcessors(l,{bWrap:e,tableProcessor:t,processors:[{processor:r},{processor:a}]})}})(g,t).ToggleFromCaret(e),a(e?r:""),g.Utils.Shared.DispatchCaretChange()};return{UINames:n,Create:e=>{const d=_.GetFormatName(e,n),c=a[d],u=T.CreateSelection(pe(d)),l=e=>M.SetText(u.Label,!e||B(e)?c.Items[0].Title:e);return l(),P(c.Items,e=>{const{Format:a,Title:t,CommandName:r,Keys:n}=e;e=i(a,t,l);const o=h(d,r);T.RegisterCommand(g,o,e),G(n)&&(g.AddShortcut(t,n),T.RegisterKeyboardEvent(g,n,()=>{var e,t,r;T.IsDisabled(u.Selection)||T.RunCommand(g,o,(e=a.Tag,t=R(t)?t:[],(r=g.Utils.Caret.Get())&&k(t,_.GetParentIfText(r.Start.Node),_.GetParentIfText(r.End.Node)),f(e,t)))}))}),T.BindOptionListEvent(g,{type:d,activable:u.Selection,clickable:u.Selection,create:()=>{{var e=u,o=d,l=c;const i=[],s=[];var t,t=((t=g.Utils.Caret.Get())&&k(s,_.GetParentIfText(t.Start.Node),_.GetParentIfText(t.End.Node)),P(l.Items,e=>{const{Format:t,Title:r,CommandName:a}=e;e=l.bPreview?M.Utils.WrapTagHTML(t.Tag,r):r;const n=f(t.Tag,s);e=T.CreateOption(e,r,n);T.BindClickEvent(e,()=>{T.DestoryOpenedOptionList(g),T.RunCommand(g,h(o,a),!n)}),k(i,e)}),T.CreateOptionList(o,i));return M.Insert(g.Frame.Root,t),T.SetOptionListCoordinate(g,o,e.Selection,t),t}}}),r.Register(r=>{var e=_.GetParentIfText(r[0]),e=T.IsNearDisableList(c.DisableList,u.Selection,e);if(!e){for(let e=0,t=c.Items.length;e<t;++e){var{Format:a,Title:n}=c.Items[e];if(f(a.Tag,r))return l(n)}l()}}),u.Selection}}};var ur={IsValid:e=>(3===e.replace("#","").length||6===e.replace("#","").length)&&/[a-f\d]{3,6}/gi.test(e)},gr={ToMap:(...e)=>({Hue:e[0],Saturation:e[1],Value:e[2]})},g=(()=>{const o=e=>{var t,r;return B(e)||!ur.IsValid(e)?null:6===(e=e.replace("#","")).length?{Red:parseInt(e.slice(0,2),16),Green:parseInt(e.slice(2,4),16),Blue:parseInt(e.slice(4,6),16),Alpha:1}:(t=e.slice(0,1),r=e.slice(1,2),e=e.slice(2,3),{Red:parseInt(t+t,16),Green:parseInt(r+r,16),Blue:parseInt(e+e,16),Alpha:1})};return{IsValid:e=>!!(l(e.Red)&&l(e.Green)&&l(e.Blue)&&l(e.Alpha))&&!(e.Red<0||255<e.Red||e.Green<0||255<e.Green||e.Blue<0||255<e.Blue||e.Alpha<0||1<e.Alpha),ToMap:(...e)=>{return{Red:e[0],Green:e[1],Blue:e[2],Alpha:null!=(e=e[3])?e:1}},ToRGB:(...e)=>`rgb(${e[0]}, ${e[1]}, ${e[2]})`,ToString:e=>`rgba(${e.Red}, ${e.Green}, ${e.Blue}, ${e.Alpha})`,ArrayToString:(...e)=>{return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${null!=(e=e[3])?e:1})`},ToHex:(e,t=!0)=>E(t?"#":"",de(e.Red.toString(16)),de(e.Green.toString(16)),de(e.Blue.toString(16))),ToHSV:e=>{var t,r,a=e.Red/255,n=e.Green/255,e=e.Blue/255,o=Math.min(a,n,e),l=Math.max(a,n,e);return o===l?gr.ToMap(0,0,100*o):(t=(l-o)/l,r=l,gr.ToMap(Math.round(60*((a===o?3:e===o?1:5)-(a===o?n-e:e===o?a-n:e-a)/(l-o))),Math.round(100*t),Math.round(100*r)))},FromHexToMap:o,FromString:e=>{r=e;var t,r=U(r,"#")?"hex":U(r,"rgb")?"rgba":null;if(!r)return[];switch(r){case"hex":var a=o(e);return a?[(t=a).Red,a.Green,a.Blue,null!=(t=a.Alpha)?t:1]:[];case"rgba":a=e.replace(/[^\d,]/gi,"").split(",");const n=[];return P(a,e=>k(n,parseInt(e))),n.length<=3&&k(n,1),n;default:return[]}}}})();const hr="colorpicker",fr=(...e)=>p("-",hr,...e),Sr=(e,t,r)=>{const a=u.Palette({Width:e,Height:t});if(a){const o=u.PaletteGuide({Palette:a.Self,bOnlyVertical:!0,Guiding:()=>r(!0,a.GetRGB(o.GetX(),o.GetY()-1))});var e=u.SketchOne({TagName:fr("hue"),Elements:[a.Self,o.Self]}),n=a.CreateGradient(0,0,0,t);return a.ColorStop(n,[[.01,g.ArrayToString(255,0,0)],[1/6,g.ArrayToString(255,255,0)],[1/3,g.ArrayToString(0,255,0)],[.5,g.ArrayToString(0,255,255)],[2/3,g.ArrayToString(0,0,255)],[5/6,g.ArrayToString(255,0,255)],[.99,g.ArrayToString(255,0,0)]]),a.FillRect(n),e.UpdateGuide=e=>o.SetGuidance(0,Math.round(t/360*g.ToHSV(e).Hue)),e}},mr=(t,r)=>{const a=[],n=[],o=(P(["R","G","B","#"],e=>{e=u.Input({Label:e});k(a,e),k(n,e.Schema)}),u.SketchOne({TagName:fr("navigation"),Elements:[...n,{TagName:"div"}]})),l={Red:a[0],Green:a[1],Blue:a[2]},i=a[3],e=o.GetChildren()[4],s=(o.UpdateRGB=r=>{g.IsValid(r)&&(N(l,(e,t)=>t.SetValue(r[e].toString())),i.SetValue(g.ToHex(r,!1)),ke(e.Self,"background-color",g.ToString(r)))},(e,t)=>{return t?e.Self.AddClass("error"):e.Self.RemoveClass("error")}),d=(o.GetRGB=e=>{const r=[];return re(l,e=>{var t;return B(e.GetValue())||(t=parseInt(e.GetValue()))<0||255<t?(s(e,!0),null):(k(r,t),void s(e,!1))}),e?r:g.ToRGB(...r)},()=>{var e=o.GetRGB(!0);e&&(e=g.ToMap(...e),t.UpdateGuide(e),r.UpdateGuide(e),o.UpdateRGB(e),s(i,!1))});var c=()=>{var e=g.FromHexToMap(i.GetValue());if(!e)return s(i,!0);t.UpdateGuide(e),r.UpdateGuide(e),o.UpdateRGB(e),s(i,!1)};return re(l,e=>{e.Self.Bind("keydown",d),e.Self.Bind("keyup",d)}),i.Self.Bind("keydown",c),i.Self.Bind("keyup",c),o},pr=(t,r,e)=>{const a=u.Palette({Width:t,Height:r});if(a){const o=u.PaletteGuide({Palette:a.Self,bOnlyVertical:!1,Guiding:()=>e(!1,a.GetRGB(o.GetX(),o.GetY()))});var n=u.SketchOne({TagName:fr("palette"),Elements:[a.Self,o.Self]});return n.GetColor=()=>g.ToMap(...a.GetRGB(o.GetX(),o.GetY())),n.ChangeColor=e=>{a.FillRect(g.ToString(e));e=a.CreateGradient(0,0,t,0),a.ColorStop(e,[[.01,g.ArrayToString(255,255,255,1)],[.99,g.ArrayToString(255,255,255,0)]]),a.FillRect(e),e=a.CreateGradient(0,0,0,r);a.ColorStop(e,[[.1,g.ArrayToString(0,0,0,0)],[.99,g.ArrayToString(0,0,0,1)]]),a.FillRect(e)},n.UpdateGuide=e=>{e=g.ToHSV(e);o.SetGuidance(Math.round(t/100*e.Saturation),Math.round(r/100*(100-e.Value)))},n}};var Tr={Create:t=>{const r=(()=>{const n=u.SketchOne({TagName:fr("form")});var e=(e,t)=>{var t=g.ToMap(...t),r=n.GetChildren()[0],a=n.GetChildren()[2];if(e)return r.ChangeColor(t),a.UpdateRGB(r.GetColor());a.UpdateRGB(t)},t=pr(230,230,e);if(t){var r,e=Sr(20,230,e);if(e)return r=mr(t,e),n.Insert(t,e,r),t.ChangeColor(g.ToMap(255,0,0)),r.UpdateRGB(g.ToMap(0,0,0)),{Form:n,Navigation:r}}})();if(r){const l=u.Modal(hr,{Title:t.Texts.Title,Icons:t.Icons,Body:r.Form,Footer:(e=t.Icons,a=t.Texts,n=()=>l.Schema.Destroy(),o=()=>{var e=r.Navigation.GetRGB(!1);e&&(t.Pick(e),l.Schema.Destroy())},u.Sketch([{TagName:"button",Attributes:{type:"button"},Elements:[E(e.Close,"<span>",a.Cancel,"</span>")],Events:[["click",n]]},{TagName:"button",Attributes:{type:"button"},Elements:[E(e.Check,"<span>",a.Apply,"</span>")],Events:[["click",o]]}]))});var e,a,n,o;xe(l.Schema.GetBody(),l.Schema.Self)}},Utils:{RGBA:g,Hex:ur,HSV:gr}};const Cr=(e,t)=>{const u=e,g=t,h={ForeColor:{Format:K.ForeColor,Title:u.Lang("format.textColor","Text color"),DefaultColor:Tr.Utils.RGBA.ToRGB(255,0,0),Icon:"ColorA",LastPicked:[]},BackColor:{Format:K.BackColor,Title:u.Lang("format.backColor","Back color"),DefaultColor:Tr.Utils.RGBA.ToRGB(255,0,0),Icon:"Fill",LastPicked:[]}},f=te(h),d=[[[255,255,255],[242,242,242],[230,230,230],[217,217,217],[204,204,204],[191,191,191],[166,166,166],[140,140,140]],[[0,0,0],[128,128,128],[115,115,115],[102,102,102],[77,77,77],[51,51,51],[38,38,38],[26,26,26]],[[255,0,0],[255,204,204],[255,153,153],[255,102,102],[255,51,51],[204,0,0],[153,0,0],[102,0,0]],[[255,153,0],[255,235,204],[255,214,153],[255,194,102],[255,173,51],[204,122,0],[153,92,0],[102,61,0]],[[255,255,0],[255,255,204],[255,255,153],[255,255,102],[255,255,51],[204,204,0],[153,153,0],[102,102,0]],[[51,204,51],[214,245,214],[173,235,173],[132,225,132],[91,215,91],[40,164,40],[30,123,30],[20,82,20]],[[0,0,255],[204,204,255],[153,153,255],[102,102,255],[51,51,255],[0,0,204],[0,0,153],[0,0,102]],[[128,0,255],[230,204,255],[206,153,255],[181,102,255],[156,51,255],[105,0,204],[79,0,153],[53,0,102]],[[191,0,255],[242,204,255],[230,153,255],[217,102,255],[204,51,255],[153,0,204],[115,0,153],[77,0,102]]],c=(n,e,t=!0)=>{const r=[];return P(e,e=>{const a=T.CreateItemGroup();M.SetAttr(a,"vertical",t?"true":"false"),P(e,e=>{var t=Tr.Utils.RGBA.ToMap(...e);const r=Tr.Utils.RGBA.ToRGB(...e);e=T.Create({tagName:Ze,title:Tr.Utils.RGBA.ToHex(t),type:"option-item"}),M.SetStyle(e,"background-color",r),T.BindClickEvent(e,()=>{T.DestoryOpenedOptionList(u),T.RunCommand(u,n,!0,r)}),t=M.Utils.CreateStyleVariable("toolbar-color-hover-border",255===t.Red&&255===t.Green&&255===t.Blue?"#F2F2F2":"#fff");M.SetStyleText(e,t),M.SetStyle(e,"background-color",r),M.Insert(a,e)}),k(r,a)}),r},S=(e,t,r)=>{var a,n,o,l=((e,t)=>{const r=t["DefaultColor"];var t=u.Lang("format.color.default","Default color"),a=M.Utils.WrapTagHTML("button",E(M.Utils.WrapTagHTML("div",""),M.Utils.WrapTagHTML("span",t))),a=T.CreateOption(a,t,!1,!1);return T.BindClickEvent(M.Select("button",a),()=>{T.DestoryOpenedOptionList(u),T.RunCommand(u,e,!1,r)}),a})(e,t),i=(a=e,t=(t=t).LastPicked,i=u.Lang("more","More"),n=T.CreateOption("",i,!1,!1),o=T.CreateItemGroup(),s=T.Create({tagName:"button"}),M.SetHTML(s,E(RichEditor.Icons.Get("Palette"),M.Utils.WrapTagHTML("span",i))),M.Insert(n,o,s),T.BindClickEvent(s,()=>{T.DestoryOpenedOptionList(u),Tr.Create({Icons:{Check:RichEditor.Icons.Get("Check"),Close:RichEditor.Icons.Get("Close")},Texts:{Title:u.Lang("colorpicker","Color Picker"),Cancel:u.Lang("cancel","Cancel"),Apply:u.Lang("apply","Apply")},Pick:e=>T.RunCommand(u,a,!0,e)})}),M.Insert(o,...c(a,[t],!1)),n),s=T.CreateOptionList(e,[l,...c(e,d),i]);return M.SetAttr(s,"palette","true"),M.Insert(u.Frame.Root,s),T.SetOptionListCoordinate(u,e,r,s),s};return{UINames:f,Create:e=>{const t=_.GetFormatName(e,f),r=h[t],a=T.Create({tagName:"div"});M.SetStyle(a,"background-color",r.DefaultColor);n=r.Format,o=a;var n,o,e=(e,t)=>{rt(u,n).ToggleFromCaret(e,e?t:void 0),M.SetStyle(o,"background-color",t),M.Dispatch(o,"Color:Change")};T.RegisterCommand(u,t,e),M.On(a,"Color:Change",()=>{5<=r.LastPicked.length&&J(r.LastPicked);var e=Tr.Utils.RGBA.FromString(M.GetStyle(a,"background-color"));k(r.LastPicked,e)});const l=T.CreateIconWrap(r.Title);var i,s,d,c,e=T.Create({tagName:"button",title:r.Title,type:"color-icon"});M.SetHTML(e,RichEditor.Icons.Get(r.Icon)),T.BindClickEvent(e,()=>T.RunCommand(u,t,!0,M.GetStyle(a,"background-color"))),i=t,s=r,d=l,c=s.Title,c=T.CreateHelper(c),T.BindOptionListEvent(u,{type:i,activable:d,clickable:c,create:()=>S(i,s,d)});return M.Insert(e,a),M.Insert(l,e,c),g.Register(e=>T.IsNearDisableList(r.Format.DisableList,l,_.GetParentIfText(e[0]))),l}}},vr=(e,t)=>{const g=e,r=t,d=/[\d]+(px|pt)/gi,i={FontSize:{Format:K.FontSize,Title:g.Lang("format.fontSize","Font size"),bPreview:!1,DefaultOptions:["9pt","10pt","12pt","18pt","24pt","48pt"],ConfigName:"FontSizeOptions",Options:{}},FontFamily:{Format:K.FontFamily,Title:g.Lang("format.fontFamily","Font family"),bPreview:!0,DefaultOptions:{Arial:"arial, sans-serif","Arial Black":"arial black, sans-serif","Courier New":"courier new, monospace",Georgia:"georgia, serif",Helvetica:"helvetica, sans-serif","Lucida Console":"lucida console",Monaco:"monaco","Noto Sans":"noto sans, sans-serif","Times New Soman":"times new roman, serif",Verdana:"verdana, sans-serif"},ConfigName:"FontFamilyOptions",Options:{}}},s=te(i),c=e=>e.split(",")[0].replace(/["`';]/gi,""),u=(e,r,t)=>{e=e.Styles;if(e){var a=_.GetStyleSelectorMap(e);const l=te(e)[0],i=U(t,d),s=i?U(t,"pt")?_.ConvertPointsToPixel(parseFloat(t)):t:c(t);var n=(e,t=!1)=>{return!!e&&(e=c(M.GetStyle(e,l,t)),t=U(e,"pt")?_.ConvertPointsToPixel(parseFloat(e)):parseFloat(e),v(e)===v(s)||!!i&&t===s)};for(let e=0,t=r.length;e<t;++e){var o=r[e];if(n(M.ClosestByStyle(_.GetParentIfText(o),a)))return!0;if(o===g.GetBody())return n(g.GetBody(),!0)}}return!1},h=(r,a,n,o)=>e=>{var t=rt(g,r);e&&T.UnwrapSameInlineFormats(g,r),t.ToggleFromCaret(e,n),o(e?a:"")},f=(r,e,a)=>{var n=N(e);for(let e=0,t=n.length;e<t;++e){var[o,l]=n[e];if(u(r,a,l))return o}return""};return{UINames:s,Create:e=>{const a=_.GetFormatName(e,s),n=i[a],o=T.CreateSelection(n.Title);e=_.GetFormatConfig(g,n.DefaultOptions,n.ConfigName),e=R(e)?_.LabelConfigArray(e):e,n.Options=e,e=f(n.Format,n.Options,[g.GetBody()]);const t="FontFamily"===a?g.Lang("format.font.default","Default Font"):e,l=e=>M.SetText(o.Label,!e||B(e)?t:e);return T.BindOptionListEvent(g,{type:a,activable:o.Selection,clickable:o.Selection,create:()=>{var e=((o,e,l,i)=>{const{Format:s,bPreview:d,Options:t}=e,c=[],u=s.Styles?te(s.Styles)[0]:"";return N(t,(e,t)=>{var r=d?M.Utils.WrapTagHTML("span",e):e;const a=e===l;r=T.CreateOption(r,e,a);const n=h(s,e,t,i);T.RegisterCommand(g,o,n),T.BindClickEvent(r,()=>{T.DestoryOpenedOptionList(g),n(!a)}),d&&s.Styles&&M.SetStyle(M.Select("span",r),u,t),k(c,r)}),c})(a,n,M.GetText(o.Label),l),t=o,r=a;return e=T.CreateOptionList(r,e),M.Insert(g.Frame.Root,e),T.SetOptionListCoordinate(g,r,t.Selection,e),e}}),l(),r.Register(e=>{l(f(n.Format,n.Options,e));e=_.GetParentIfText(e[0]);T.IsNearDisableList(n.Format.DisableList,o.Selection,e)}),o.Selection}}},Er=(e,t)=>{const i=e,l=i.DOM,s=t,r=Cr(i,t),a=vr(i,t),n={Bold:{Format:K.Bold,Title:i.Lang("format.bold","Bold"),CommandName:"Bold",Icon:"Bold",Keys:"Ctrl+B"},Italic:{Format:K.Italic,Title:i.Lang("format.italic","Italic"),CommandName:"Italic",Icon:"Italic",Keys:"Ctrl+I"},Strikethrough:{Format:K.Strikethrough,Title:i.Lang("format.strikethrough","Strikethrough"),CommandName:"Strikethrough",Icon:"Strikethrough"},Subscript:{Format:K.Subscript,Title:i.Lang("format.subscript","Subscript"),CommandName:"Subscript",Icon:"Subscript"},Superscript:{Format:K.Superscript,Title:i.Lang("format.superscript","Superscript"),CommandName:"Superscript",Icon:"Superscript"},Underline:{Format:K.Underline,Title:i.Lang("format.underline","Underline"),CommandName:"Underline",Icon:"Underline",Keys:"Ctrl+U"},Code:{Format:K.Code,Title:i.Lang("format.code","Code"),CommandName:"Code",Icon:"Code"}},o=te(n),d=(e,r)=>{var{Tag:e,Styles:a}=e,n=a?_.GetStyleSelectorMap(a):e;for(let e=0,t=r.length;e<t;++e){var o=r[e];if(a){if(l.ClosestByStyle(o,n))return!0}else if(G(n)&&l.Closest(o,n))return!0}return!1},c=(r,a)=>e=>{T.ToggleActivateClass(a,e);var t=rt(i,r);e&&T.UnwrapSameInlineFormats(i,r),t.ToggleFromCaret(e)},u=e=>{const{Format:n,Title:t,CommandName:r,Icon:a,Keys:o}=e,l=T.CreateIconButton(t,a);e=c(n,l),T.RegisterCommand(i,r,e),e=()=>{T.IsDisabled(l)||T.RunCommand(i,r,!T.HasActiveClass(l))};T.BindClickEvent(l,e),G(o)&&(i.AddShortcut(t,o),T.RegisterKeyboardEvent(i,o,e));return s.Register(r=>{var e=(r=>{if(!R(n))return T.IsNearDisableList(n.DisableList,l,r);let a=!1;return P(n,(e,t)=>{(a=T.IsNearDisableList(e.DisableList,l,r))&&t()}),a})(_.GetParentIfText(r[0]));if(!e){if(!R(n))return T.ToggleActivateClass(l,d(n,r));for(let e=0,t=n.length;e<t;++e){var a=n[e];if(d(a,r))return T.ToggleActivateClass(l,!0)}T.ToggleActivateClass(l,!1)}}),l};return{UINames:X(o,r.UINames,a.UINames),Create:e=>{return _.HasFormatName(e,r.UINames)?r.Create(e):_.HasFormatName(e,a.UINames)?a.Create(e):(e=_.GetFormatName(e,o),e=n[e],u(e))}}},Ir=(e,s)=>{const d=e,c=d.DOM,l=d.Formatter.Toggler,u=d.Utils.Caret,i=(e,t,r,a,n=!1)=>{n={except:_.ExceptNodes(d,t,r,n),endNode:t,value:a};l.ToggleRecursive(e,s,r,n)},r=(t,r)=>{var e=c.Element.Table.GetSelectedCells(d);return!x(e)&&(P(e,e=>l.ToggleRecursive(t,s,e,{value:r})),!0)},a=(e,t,r)=>{return t.Start.Line===t.End.Line&&(t.Start.Node===t.End.Node?l.Toggle(e,s,t.Start.Node,r):(r={except:X(_.ExceptNodes(d,t.Start.Node,t.SameRoot,!0),_.ExceptNodes(d,t.End.Node,t.SameRoot)),endNode:t.End.Node,value:r},l.ToggleRecursive(e,s,t.SameRoot,r)),!0)},n=(t,r,a)=>{if(r.Start.Line===r.End.Line)return!1;var n=d.GetLines();i(t,r.Start.Node,n[r.Start.Line],a,!0);for(let e=r.Start.Line+1;e<r.End.Line;++e){var o=n[e];l.ToggleRecursive(t,s,o,{value:a})}return i(t,r.End.Node,n[r.End.Line],a),!0};return{ToggleFromCaret:(e,t)=>_.SerialiseWithProcessors(d,{bWrap:e,value:t,tableProcessor:r,processors:[{processor:a},{processor:n}],after:()=>d.Tools.Parts.ChangePositions()}),CalculateFromCaret:(e,t)=>{var r=(R(s)?s[0]:s)["Styles"],r=te(r)[0],t=t?-1*parseFloat(e):parseFloat(e),e=u.Get();if(e){var a=e,n=r,o=t,l=d.GetLines(),i=e=>{var t;e&&(t=c.GetStyle(e,n,!0),((t=parseFloat(t)+o)<=0?c.RemoveStyle:c.SetStyle)(e,n,_.GetPixelString(t)))},e=c.Element.Table.GetSelectedCells(d);if(x(e))for(let e=a.Start.Line;e<=a.End.Line;++e)i(l[e]);else e=c.Element.Figure.Find(e[0]).Figure,i(e)}}}},yr=(e,t)=>{const h=e,f=t,o=/[\d]+(px|pt|rem|em)/gi,l={Alignment:{Items:[{Format:K.Justify,Title:h.Lang("format.alignJustify","Justify"),CommandName:"Justify",Icon:"AlignJustify",bDetector:!0},{Format:K.AlignLeft,Title:h.Lang("format.alignLeft","Align left"),CommandName:"AlignLeft",Icon:"AlignLeft",bDetector:!0},{Format:K.AlignCenter,Title:h.Lang("format.alignCenter","Align center"),CommandName:"AlignCenter",Icon:"AlignCenter",bDetector:!0},{Format:K.AlignRight,Title:h.Lang("format.alignRight","Align right"),CommandName:"AlignRight",Icon:"AlignRight",bDetector:!0}]},Indentation:{ConfigName:"IndentationSize",DefaultValue:_.GetPixcelFromRoot(),bCalculate:!0,Items:[{Format:K.Outdent,Title:h.Lang("format.Outdent","Outdent"),CommandName:"Outdent",Icon:"Outdent",bDetector:!0,bSubtract:!0,Keys:"Shift+Tab"},{Format:K.Indent,Title:h.Lang("format.Indent","Indent"),CommandName:"Indent",Icon:"Indent",bDetector:!1,Keys:"Tab"}]}},i=te(l),s=(n,o,l)=>{const i=(e,t)=>{var{StrictFormats:e,Styles:r}=e,t=M.ClosestByStyle(t,_.GetStyleSelectorMap(r));return!!t&&e.has(M.Utils.GetNodeName(t))};return e=>{var r=_.GetParentIfText(e[0]);if(!R(n))return T.IsNearDisableList(n.DisableList,o,r)||!l?void 0:T.ToggleActivateClass(o,i(n,r));for(let e=0,t=n.length;e<t;++e){var a=n[e];if(T.IsNearDisableList(a.DisableList,o,r)||!l)return;a=i(a,r);if(a)return T.ToggleActivateClass(o,a)}T.ToggleActivateClass(o,!1)}},d=(e,a,n)=>{const{StrictFormats:o,Styles:t}=e,l=te(t)[0];return t=>{var t=_.GetParentIfText(t[0]),r=T.IsNearDisableList(e.DisableList,a,t);if(!r&&n){let e=t;for(;e&&e.parentNode!==h.GetBody();)e=e.parentNode;e&&o.has(M.Utils.GetNodeName(e))&&(r=M.GetStyle(e,l),T.ToggleDisable(a,B(r)||0===parseFloat(r)))}}},S=(r,e,t)=>{const{DefaultValue:a,bCalculate:n}=e,{Format:o,bSubtract:l}=t;return e=>{n||T.ToggleActivateClass(r,e);var t=Ir(h,o);if(!n)return t.ToggleFromCaret(e,a),h.Utils.Shared.DispatchCaretChange();t.CalculateFromCaret(null!==a&&void 0!==a?a:_.GetPixcelFromRoot(),l),h.Utils.Shared.DispatchCaretChange()}};return{UINames:i,Create:e=>{var t,r,e=_.GetFormatName(e,i),a=l[e],n=(a.ConfigName&&a.DefaultValue&&(n=_.GetFormatConfig(h,a.DefaultValue,a.ConfigName),a.DefaultValue=(t=a.DefaultValue,n=n,(n=G(n)?n:t).match(o)?U(n,"px")?n:(r=parseFloat(n),n=U(n,"pt")?_.ConvertPointsToPixel:_.MultiplyPixelSize,_.GetPixelString(n(r))):t)),((c,e)=>{var t=c["Items"];const u=T.CreateIconGroup(),g=e?d:s;return P(t,e=>{const{Title:t,CommandName:r,Icon:a,bDetector:n,bSubtract:o,Keys:l}=e,i=T.CreateIconButton(t,a);var s=S(i,c,e);T.RegisterCommand(h,r,s);const d=()=>T.RunCommand(h,r,!T.HasActiveClass(i));o&&T.ToggleDisable(i,!0),G(l)&&(h.AddShortcut(t,l),T.RegisterKeyboardEvent(h,l,e=>{T.IsDisabled(i)||M.Element.Figure.FindClosest(e.target)||d()})),T.BindClickEvent(i,d),M.Insert(u,i),f.Register(g(e.Format,i,n))}),u})(a,"Indentation"===e));return n}}},Rr=e=>{const r=e;var e=(e=>{const n=e,g=n.DOM,o=dr(n),l=sr(n),h=(e,t,r,a)=>{(e?o.Wrap:l.Unwrap)(t,r,a)},f=e=>{return!!g.Utils.IsBr(e)&&(g.Remove(e),!0)},S=(r,a,e,n={})=>{var o,{except:t,endNode:l,value:i,bInline:s}=n,d=g.GetChildNodes(e,s),c=d.length;for(let e=0;e<c;++e){var u=d[e];if(!C(null!=t?t:[],u)){let e=u.nextSibling,t=null!=(o=null==l?void 0:l.nextSibling)?o:null;if(e&&g.HasAttr(e,"marker")&&(e=e.nextSibling),t&&g.HasAttr(t,"marker")&&(t=t.nextSibling),D(u)||1===d.length&&g.Utils.IsBr(u))if(h(r,a,u,i),l&&u===l)return f(e)?void 0:f(t);if(g.Utils.IsBr(u)&&!s?1!==c&&g.Remove(u):S(r,a,u,n),l&&(!s&&g.Utils.IsChildOf(l,u)||s&&u===l))return f(e)?void 0:f(t)}}};return{Toggle:(e,t,r,a)=>_.RunFormatting(n,()=>h(e,t,r,a)),ToggleRecursive:(e,t,r,a={})=>_.RunFormatting(n,()=>S(e,t,r,a))}})(r),t=(e=>{const a=[];e.On("Caret:Change",t=>{const r=[];P(a,e=>k(r,e(t))),Promise.all(r)});return{Register:r=>{k(a,t=>new Promise(e=>e(r(t))))}}})(r);const a=((e,t)=>{const r=cr(e,t),a=Er(e,t),n=yr(e,t),o=X(r.UINames,a.UINames,n.UINames),l=e=>_.HasFormatName(e,o);return{IsAvailable:l,Register:e=>{if(!l(e))return null;switch(!0){case _.HasFormatName(e,r.UINames):return r.Create(e);case _.HasFormatName(e,a.UINames):return a.Create(e);case _.HasFormatName(e,n.UINames):return n.Create(e);default:return null}}}})(r,t);return{Formats:{AllBlockFormats:tt,AllDisableList:o,BlockFormatTags:m,ListItemSelector:Ze,ListSet:Xe,ListSelector:qe},UI:T,Utils:_,Toggler:e,Detector:t,Registry:a,Register:e=>{var t=a.Register(e);t&&r.Toolbar.Add(e,t)}}},Gr=M.Utils.CreateUEID("navigation",!1),Ar=M.Utils.CreateUEID("counter",!1),Nr=M.Utils.CreateUEID("counter-word",!1),br=M.Utils.CreateUEID("counter-total",!1),Ur=e=>{const s=e,r=e=>M.Create("div",{attrs:{id:e},class:e});var e=(e,t)=>{return M.Create("div",{class:M.Utils.CreateUEID("counter-wrap",!1),children:[M.Create("div",{attrs:{title:e},class:M.Utils.CreateUEID("label",!1),html:E(e,":")}),r(t)]})},t=M.Utils.CreateUEID("footer",!1),t=r(t);const a=r(Gr);var n=r(Ar),o=e(s.Lang("counter.words","Words"),Nr),e=e(s.Lang("counter.total","Total"),br);M.Insert(n,o,e),M.Insert(t,a,n),M.InsertAfter(s.Frame.Container,t);const l=M.Select({attrs:{id:Nr}},o),i=M.Select({attrs:{id:br}},e);let d;const c=()=>{d=d||new RegExp(`</?(${p("|",...tt)}).*?>`,"g");var e=M.Clone(s.GetBody(),!0),e=(O(s.Tools.Parts.Manager.SelectParts(!0,e),e=>M.Remove(e)),M.GetHTML(e).replace(d," ").replace(/<\/?.*?>/g,"").replace(/\s{2,}/g," ").trim()),t=e.length,e=(null!=(e=null==(e=e.replace(/\n/g," ").match(/\s/g))?void 0:e.length)?e:0)+(0!==t?1:0);M.SetText(l,Te(e)),M.SetText(i,Te(t))},u=()=>M.RemoveChildren(a,!0),g=e=>{u(),P(e,i=>{if(!D(i)&&!M.Utils.IsBr(i)){let e=M.Utils.GetNodeName(i);M.Element.Figure.Is(i)&&(t=M.Element.Figure.SelectFigureElement(i))&&(e=E(e,"<",M.Utils.GetNodeName(t),">"));var t=M.Create("button",{attrs:{title:e}});M.SetText(t,e),M.On(t,I.click,e=>{W(e);{var l=i;const a=s.Utils.Range(),n=e=>{e(),s.Utils.Shared.DispatchCaretChange(),s.Focus()};var t,r,e=()=>n(()=>s.Utils.Caret.UpdateRange(a));const o=e=>{var t=M.Element.Table.GetSelectedCells(s),r=!x(t);switch(s.Utils.Caret.CleanRanges(),e){case"table":return M.Element.Table.ToggleSelectMultipleCells(!0,M.Element.Table.GetAllOwnCells(l));case"row":var a=M.Element.Table.FindClosest(l);if(!a)return;if(!r)return M.Element.Table.ToggleSelectMultipleCells(!0,M.Element.Table.GetAllOwnCells(null!=l?l:a));const n=[],o=(P(t,e=>{e=M.Element.Table.FindClosestRow(e);e&&!C(n,e)&&k(n,e)}),[]);return P(n,e=>k(o,...M.Element.Table.GetAllOwnCells(e))),M.Element.Table.ToggleSelectMultipleCells(!0,o);case"cell":return r?void 0:M.Element.Table.ToggleSelectCell(!0,l)}};M.Element.Table.Is(l)?n(()=>o("table")):M.Element.Table.IsRow(l)?n(()=>o("row")):M.Element.Table.IsCell(l)?n(()=>o("cell")):(M.Element.Figure.Is(l)?a.SetStartToEnd(l,1,1):(t=M.Utils.GetFirstChild(l,!0),r=M.Utils.GetLastChild(l,!0),t&&r?(a.SetStart(t,0),a.SetEnd(r,D(r)?r.length:0)):a.SelectContents(l)),e())}}),M.Insert(a,t)}})};return s.On(I.keydown,c),s.On(I.keyup,c),s.On(I.keypress,c),s.On("Caret:Change",()=>{var e=s.Utils.Caret.Get(),t=M.Element.Table.GetSelectedCells(s);if(c(),e||!x(t))return e?void g((e.IsBackward()?e.Start:e.End).Path):g(M.GetParents(t[0]))}),{UpdateCounter:c,CleanNavigation:u}},Fr=e=>{const a=e,r={},n=e=>$(r[v(e)]);return{Has:n,Add:(e,t)=>{n(e)||(r[v(e)]=t)},Get:e=>{var t=r[v(e)];if($(t))return t;a.Notify(dt.WARNING,`Plugin '${e}' hasn't loaded yet.`)},AttachPlugin:()=>new Promise((e,t)=>{const r=[];P(a.Config.Plugins,e=>{if(!RichEditor.Loaders.Plugin.Has(e))return a.Notify(dt.WARNING,`Plugin '${e}' hasn't loaded yet.`);k(r,RichEditor.Loaders.Plugin.Attach(a,e))}),Promise.all(r).catch(e=>t(e)).finally(e)})}},Lr=560,Dr=315,Or=(e,r,n)=>{const o=e,l=e=>o.IsIFrame()?"left"===e?o.Frame.Wrapper.offsetLeft:o.Frame.Wrapper.offsetTop:0,i=M.Create("div",{class:M.Utils.CreateUEID("parts-size-navigation",!1)});e=e=>{var t,e="width"===e;return M.Utils.IsImage(r)?e?r.naturalWidth:r.naturalHeight:M.Utils.IsVideo(r)?e?r.videoWidth:r.videoHeight:(t=e?Lr:Dr,e=e?H.ATTRIBUTES.ORIGINAL_WIDTH:H.ATTRIBUTES.ORIGINAL_HEIGHT,0===(e=parseFloat(null!=(e=M.GetAttr(r,e))?e:"0"))?t:e)};const s=e("width"),d=e("height");M.Insert(M.Doc.body,i);return{Update:(e,t)=>{let r=e+l("left")-o.GetWin().scrollX+20,a=t+l("top")-o.GetWin().scrollY+20;r+i.offsetWidth>=o.GetWin().innerWidth&&(r-=i.offsetWidth+20),a+i.offsetHeight>=o.GetWin().innerHeight&&(a-=i.offsetHeight+20),M.SetStyles(i,{left:r+"px",top:a+"px"}),M.SetHTML(i,`R. ${Q(n.offsetWidth/s)+" : "+Q(n.offsetHeight/d)}<br>W. ${n.offsetWidth}px<br> H. ${n.offsetHeight}px`)},Destory:()=>M.Remove(i)}},Br=(e,t,r)=>parseFloat(e.DOM.GetStyle(t,"margin-"+r,!0)),wr=(e,t,r)=>("left"===r?t.Figure.offsetLeft:t.Figure.offsetTop)-Br(e,t.Figure,r),xr=(e,t,r)=>Br(e,t.Media,r),Pr=(e,t,r)=>{var e=e.DOM,a=e.Clone(t),t=(e.SetStyles(a,{position:"relative",width:t.offsetWidth+"px",height:t.offsetHeight+"px"}),e.Create("div",{attrs:[H.ATTRIBUTES.FAKE]}));return e.SetStyles(t,{width:r.offsetWidth+"px",height:r.offsetHeight+"px"}),e.Insert(a,t),{Figure:a,Media:t}},kr=(e,t)=>{var r,e=e.DOM,a={};return a[H.ATTRIBUTES.ORIGINAL_WIDTH]=null!=(r=e.GetAttr(t,H.ATTRIBUTES.ORIGINAL_WIDTH))?r:"0",a[H.ATTRIBUTES.ORIGINAL_HEIGHT]=null!=(r=e.GetAttr(t,H.ATTRIBUTES.ORIGINAL_HEIGHT))?r:"0",e.Create("div",{attrs:a,styles:{backgroundColor:"rgba(0, 0, 0, 0.7)",width:e.GetStyle(t,"width"),height:e.GetStyle(t,"height")}})},Hr=(e,t,r,a)=>{var n=e.DOM;n.HasStyle(r,"float")&&n.SetAttr(r,"dump-float",n.GetStyle(r,"float")),n.HasStyle(r,"margin-left")&&n.SetAttr(r,"dump-margin-left",n.GetStyle(r,"margin-left")),n.HasStyle(r,"margin-right")&&n.SetAttr(r,"dump-margin-right",n.GetStyle(r,"margin-right")),n.SetStyles(r,{position:"absolute",left:wr(e,t,"left")+"px",top:wr(e,t,"top")+"px",width:t.Figure.offsetWidth+"px",height:t.Figure.offsetHeight+"px"}),n.SetStyles(a,{position:"absolute",left:xr(e,t,"left")+"px",top:xr(e,t,"top")+"px"})},Mr=(e,t,r)=>{e=e.DOM,e.RemoveStyles(r,"position","left","top"),e.RemoveStyles(t,"position","left","top","width","height"),r=e.GetAttr(t,"dump-float"),r&&(e.SetStyle(t,"float",r),e.RemoveAttr(t,"dump-float")),r=e.GetAttr(t,"dump-margin-left"),r&&(e.SetStyle(t,"margin-left",r),e.RemoveAttr(t,"dump-margin-left")),r=e.GetAttr(t,"dump-margin-right");r&&(e.SetStyle(t,"margin-right",r),e.RemoveAttr(t,"dump-margin-right"))};const Wr=(e,t,r)=>parseFloat(e.DOM.GetStyle(t,"margin-"+r,!0)),Kr=(e,t,r)=>("left"===r?t.Figure.offsetLeft:t.Figure.offsetTop)-Wr(e,t.Figure,r),_r=(e,t,r)=>Wr(e,t.Table,r),Yr=(e,t)=>{var r=e.DOM,a=e.Utils.Caret.Get();let n=a?Object.assign({},a):null;return e.Utils.Caret.CleanRanges(),n=n||r.Element.Table.GetSelectedCells(e,t)},zr=(e,t,r)=>{var a=e.DOM,n=e.Utils.Caret,o=a.Element.Table.GetSelectedCells(e,t);if(a.Element.Table.ToggleSelectMultipleCells(!1,o),!r){o=a.SelectAll(a.Element.Table.CellSelector,t)[0];if(!o)return;t=a.Utils.GetFirstChild(o,!0);if(!t)return;const l=e.Utils.Range();return l.SetStartToEnd(t,0,0),n.UpdateRange(l)}if(R(r))a.Element.Table.ToggleSelectMultipleCells(!0,r),n.CleanRanges(),r=void 0;else{const l=e.Utils.Range();l.SetStart(r.Start.Node,a.Utils.IsBr(r.Start.Node)?0:r.Start.Offset),l.SetEnd(r.End.Node,a.Utils.IsBr(r.End.Node)?0:r.End.Offset),n.UpdateRange(l)}},jr=(e,t,r)=>{var e=e.DOM,a=e.Clone(t),t=(e.SetStyles(a,{position:"relative",width:t.offsetWidth+"px",height:t.offsetHeight+"px"}),e.Clone(r,!0));return e.SetStyles(t,{width:r.offsetWidth+"px",height:r.offsetHeight+"px"}),e.Insert(a,t),{Figure:a,Table:t}},$r=(e,t,r,a)=>{var n=e.DOM;n.HasStyle(r,"float")&&n.SetAttr(r,"dump-float",n.GetStyle(r,"float")),n.HasStyle(r,"margin-left")&&n.SetAttr(r,"dump-margin-left",n.GetStyle(r,"margin-left")),n.HasStyle(r,"margin-right")&&n.SetAttr(r,"dump-margin-right",n.GetStyle(r,"margin-right")),n.SetStyles(r,{position:"absolute",left:Kr(e,t,"left")+"px",top:Kr(e,t,"top")+"px",width:t.Figure.offsetWidth+"px",height:t.Figure.offsetHeight+"px"}),n.SetStyles(a,{position:"absolute",left:_r(e,t,"left")+"px",top:_r(e,t,"top")+"px",width:t.Table.offsetWidth+"px",height:t.Table.offsetHeight+"px"}),n.SetAttr(a,H.ATTRIBUTES.ADJUSTING)},Vr=(e,t,r)=>{e=e.DOM,e.RemoveStyles(r,"position","left","top","width","height"),e.RemoveStyles(t,"position","left","top","width","height"),e.RemoveAttr(r,H.ATTRIBUTES.ADJUSTING),r=e.GetAttr(t,"dump-float"),r&&(e.SetStyle(t,"float",r),e.RemoveAttr(t,"dump-float")),r=e.GetAttr(t,"dump-margin-left"),r&&(e.SetStyle(t,"margin-left",r),e.RemoveAttr(t,"dump-margin-left")),r=e.GetAttr(t,"dump-margin-right");r&&(e.SetStyle(t,"margin-right",r),e.RemoveAttr(t,"dump-margin-right"))},Jr=(e,t)=>P(e,e=>P(e,e=>t(e)));var Xr={Media:{name:"media",partAttachers:[(e,a)=>{const R=e,G=R.DOM;var e=G.Create("div",{attrs:[H.ATTRIBUTES.ADJUSTABLE_LINE_GROUP]}),t=e=>{var t="left"===e||"right"===e,r={};return r[H.ATTRIBUTES.ADJUSTABLE_LINE]=e,G.Create("div",{attrs:r,styles:{width:`${t?3:a.offsetWidth}px`,height:`${t?a.offsetHeight:3}px`,left:a.offsetLeft+("right"!==e?0:a.offsetWidth)-1.5+"px",top:a.offsetTop+("bottom"!==e?0:a.offsetHeight)-1.5+"px"}})};const A=t("left"),N=t("top"),b=t("right"),r=t("bottom"),n=(e,t,r)=>G.SetStyles(t,{width:`${"left"===r||"right"===r?3:e.offsetWidth}px`,height:`${"left"===r||"right"===r?e.offsetHeight:3}px`,left:e.offsetLeft+("right"!==r?0:e.offsetWidth)-1.5+"px",top:e.offsetTop+("bottom"!==r?0:e.offsetHeight)-1.5+"px"}),U=e=>{n(e,A,"left"),n(e,N,"top"),n(e,b,"right"),n(e,r,"bottom")};t=[A,N,b,r];return er(R,(e,t,r)=>{var a=e.target;let o=e.pageX,l=e.pageY;const n=G.Utils.IsIFrame(r),i=n?kr(R,r):r,s=(n&&(G.InsertAfter(r,i),G.Hide(r)),a===A||a===b),d=a===A||a===N,c=s?"width":"height",u=s?"left":"top";e=e=>s?e.offsetLeft:e.offsetTop;const g=e=>s?e.offsetWidth:e.offsetHeight;var a=g(i),h=e(i);R.SaveScrollPosition();const f=Or(R,r,i),S=(f.Update(o,l),Pr(R,t,i));G.InsertBefore(t,S.Figure),Hr(R,S,t,i);var m=B(G.GetStyle(i,"width"))?i.offsetWidth:parseFloat(G.GetStyle(i,"width")),p=B(G.GetStyle(i,"height"))?i.offsetHeight:parseFloat(G.GetStyle(i,"height"));G.SetStyles(i,{width:"0px",height:"0px"});const T=g(i),C=e(i)+(d?Math.max(T-a,a-T):0),v=(G.SetStyles(i,{width:m+"px",height:p+"px"}),R.ScrollSavedPosition(),G.Select({attrs:[H.ATTRIBUTES.ADJUSTABLE_EDGE_GROUP]},t)),E=(G.Hide(v),()=>{var e={};e[c]=T+"px",e[u]=C+"px",G.SetStyles(i,e),U(i)});e=d?0:T-a,m=C-h+e;const I=(s?o:l)+m;let y=!0;tr(R,r,e=>{var t=e.pageX,e=e.pageY,r=(f.Update(t,e),s?o:l),a=s?t:e;const n=d?r-a:a-r;if(0!=n)return o=t,l=e,r=d?I-a:a-I,t=()=>{var e={},t=g(i)+n;e[c]=t+"px",d&&(e[u]=C+T-t+"px"),G.SetStyles(i,e),U(i)},y?n<0&&r<=0?(y=!1,E()):void t():(n<0||r<=0?E:(y=!0,t))()},()=>{G.Remove(S.Figure),Mr(R,t,i),n&&(G.Show(r),G.SetStyles(r,{width:G.GetStyle(i,"width"),height:G.GetStyle(i,"height")}),G.Remove(i)),G.Show(v),f.Destory()})},...t),G.Insert(e,...t),e},(e,n)=>{const A=e,N=A.DOM;var e=N.Create("div",{attrs:[H.ATTRIBUTES.ADJUSTABLE_EDGE_GROUP]}),t=(e,t,r)=>{var a={};return a[H.ATTRIBUTES.ADJUSTABLE_EDGE]=e,a[H.ATTRIBUTES.HORIZONTAL]=t?"left":"right",a[H.ATTRIBUTES.VERTICAL]=r?"top":"bottom",N.Create("div",{attrs:a,styles:{left:qt(n.offsetLeft+(t?0:n.offsetWidth),!0),top:qt(n.offsetTop+(r?0:n.offsetHeight),!0)}})};const b=t("west",!0,!0),U=t("east",!1,!0),F=t("east",!0,!1),r=t("west",!1,!1),a=(e,t,r,a)=>N.SetStyles(t,{left:qt(e.offsetLeft+(r?0:e.offsetWidth),!0),top:qt(e.offsetTop+(a?0:e.offsetHeight),!0)}),L=e=>{a(e,b,!0,!0),a(e,U,!1,!0),a(e,F,!0,!1),a(e,r,!1,!1)};t=[b,U,F,r];return er(A,(e,t,r)=>{var a=e.target;let i=e.pageX,s=e.pageY;const n=N.Utils.IsIFrame(r),d=n?kr(A,r):r,c=(n&&(N.InsertAfter(r,d),N.Hide(r)),a===b||a===F),u=a===b||a===U;var a=d.offsetWidth,o=d.offsetHeight,l=d.offsetLeft,g=d.offsetTop;A.SaveScrollPosition();const h=Or(A,r,d),f=(h.Update(e.pageX,e.pageY),Pr(A,t,d));N.InsertBefore(t,f.Figure),Hr(A,f,t,d);var e=N.GetStyle(d,"width"),S=N.GetStyle(d,"height");N.SetStyles(d,{width:"0px",height:"0px"});const m=d.offsetWidth,p=d.offsetHeight,T=d.offsetLeft+(c?Math.max(m-a,a-m):0),C=d.offsetTop+(u?Math.max(p-o,o-p):0);var v=B(e)?N.RemoveStyle:N.SetStyle,E=B(S)?N.RemoveStyle:N.SetStyle;v(d,"width",e),E(d,"height",S),L(d),A.ScrollSavedPosition();const I=N.Select({attrs:[H.ATTRIBUTES.ADJUSTABLE_LINE_GROUP]},t);N.Hide(I);v=(c?T-l:l-T)+(c?0:m-a);const y=i+v;e=(u?C-g:g-C)+(u?0:p-o);const R=s+e,G=(e,t)=>{var r=e?c:u,a=e?i:s,a=r?a-t:t-a;if(0!=a){e?i=t:s=t;var n=e?d.offsetWidth:d.offsetHeight,o=e?m:p,l=e?y:R;if(o<n+a&&0<(r?l-t:t-l))return a;N.SetStyle(d,e?"width":"height",`${e?m:p}px`),(e&&c||!e&&u)&&N.SetStyle(d,e?"left":"top",`${e?T:C}px`)}return!1};tr(A,r,e=>{var t=e.pageX,r=e.pageY,t=G(!0,t),r=G(!1,r);if(h.Update(e.pageX,e.pageY),!j(t)||t||!j(r)||r){const n={};e=(e,t,r)=>{var a="width"===e,t=(a?d.offsetWidth:d.offsetHeight)+t;n[e]=t+"px",r&&(e=(a?T:C)+(a?m:p),n[a?"left":"top"]=e-t+"px")};j(t)||e("width",t,c),j(r)||e("height",r,u),N.SetStyles(d,n),L(d)}},()=>{N.Remove(f.Figure),Mr(A,t,d),n&&(N.Show(r),N.SetStyles(r,{width:N.GetStyle(d,"width"),height:N.GetStyle(d,"height")}),N.Remove(d)),N.Show(I),h.Destory()})},...t),N.Insert(e,...t),e}]},Table:{name:"table",partAttachers:[(e,t)=>{const d=e,c=d.DOM,u=d.Utils.Caret,a=c.Create("div",{attrs:[H.ATTRIBUTES.MOVABLE,{draggable:"true",title:d.Lang("plugins.parts.menu.table.move","Move a table")}],styles:{left:Xt(t.offsetLeft+t.offsetWidth/2,!0)},html:RichEditor.Icons.Get("Move")});return c.On(a,I.mouseup,e=>{var t;e.target&&({Figure:e,FigureElement:t}=c.Element.Figure.Find(e.target),e)&&t&&(t=c.Element.Table.GetAllOwnCells(t),c.Element.Table.ToggleSelectMultipleCells(!0,t),c.SetAttr(e,H.ATTRIBUTES.FOCUSED),d.Utils.Shared.DispatchCaretChange())}),c.On(a,I.dragstart,e=>{var r;const{Figure:n,FigureElement:o}=c.Element.Figure.Find(a);if(n&&o){d.Dispatch("Tools:Move:Start",o),null!=(r=e.dataTransfer)&&r.setData("text/html",c.GetOuterHTML(o)),null!=(r=e.dataTransfer)&&r.setDragImage(o,0,0);let t=Yr(d,o);const l=e=>{zr(d,o,t),t=void 0,d.Dispatch(E("Tools:Move:",e?"Cancel":"Finish"),o)},i=c.Element.Table.GetAllOwnCells(o),s=(c.Element.Table.ToggleSelectMultipleCells(!0,i),c.SetAttr(n,H.ATTRIBUTES.FOCUSED),e=>{if(W(e),d.Off(I.beforeinput,s),e.target===d.GetBody())return l(!0);c.Element.Table.ToggleSelectMultipleCells(!1,i);var t,r,a,e=u.Get();return!e||(r=c.Element.Table.FindClosest(_.GetParentIfText(e.Start.Node)))===o?l(!0):(t=(a=e.SameRoot===e.Start.Path[0])&&B(c.GetText(e.SameRoot)),r||a&&!t||!D(e.SameRoot)||B(e.SameRoot.textContent)||!e.SameRoot.parentNode?(c.InsertAfter(e.Start.Path[0],n),l(!1)):a&&t?(d.GetBody().replaceChild(n,e.SameRoot),l(!1)):({StartBlock:r,EndBlock:a}=d.Utils.Shared.SplitLines(e.SameRoot,e.Start.Offset),c.InsertAfter(r,a,n),void l(!1)))});d.On(I.beforeinput,s,!0)}}),a},(e,n)=>{const N=e,b=N.DOM;var e=b.Create("div",{attrs:[H.ATTRIBUTES.ADJUSTABLE_EDGE_GROUP]}),t=(e,t,r)=>{var a={};return a[H.ATTRIBUTES.ADJUSTABLE_EDGE]=e,a[H.ATTRIBUTES.HORIZONTAL]=t?"left":"right",a[H.ATTRIBUTES.VERTICAL]=r?"top":"bottom",b.Create("div",{attrs:a,styles:{left:qt(n.offsetLeft+(t?0:n.offsetWidth),!0),top:qt(n.offsetTop+(r?0:n.offsetHeight),!0)}})};const U=t("west",!0,!0),F=t("east",!1,!0),L=t("east",!0,!1),r=t("west",!1,!1),a=(e,t,r,a)=>b.SetStyles(t,{left:qt(e.offsetLeft+(r?0:e.offsetWidth),!0),top:qt(e.offsetTop+(a?0:e.offsetHeight),!0)}),D=e=>{a(e,U,!0,!0),a(e,F,!1,!0),a(e,L,!0,!1),a(e,r,!1,!1)};t=[U,F,L,r];return er(N,(e,r,i)=>{var t=e.target;let s=e.pageX,d=e.pageY,a=Yr(N,i);const c=t===U||t===L,u=t===U||t===F,n=i.offsetWidth,o=i.offsetHeight;e=i.offsetLeft,t=i.offsetTop;N.SaveScrollPosition();const l=b.Element.Table.GetGridWithIndex(i)["Grid"],g=jr(N,r,i),h=(b.InsertBefore(r,g.Figure),$r(N,g,r,i),[]);Jr(l,e=>k(h,[e,{width:ee(Y(N,e,"width"),n)+"%",height:ee(Y(N,e,"height"),o)+"%"}]));var f=b.GetStyle(i,"width"),S=b.GetStyle(i,"height");b.SetStyles(i,{width:"0px",height:"0px"}),Jr(l,e=>b.RemoveStyles(e,"width","height"));const m=i.offsetWidth,p=i.offsetHeight,T=i.offsetLeft+(c?Math.max(m-n,n-m):0),C=i.offsetTop+(u?Math.max(p-o,o-p):0);var v=B(f)?b.RemoveStyle:b.SetStyle,E=B(S)?b.RemoveStyle:b.SetStyle;v(i,"width",f),E(i,"height",S),O(h,([e,t])=>b.SetStyles(e,t)),D(i),N.ScrollSavedPosition();const I=b.Select({attrs:[H.ATTRIBUTES.ADJUSTABLE_LINE_GROUP]},r),y=(b.Hide(I),b.Select({attrs:[H.ATTRIBUTES.MOVABLE]},r));b.Hide(y);v=(c?T-e:e-T)+(c?0:m-n);const R=s+v;f=(u?C-t:t-C)+(u?0:p-o);const G=d+f,A=(e,t)=>{var r=e?c:u,a=e?s:d,a=r?a-t:t-a;if(0!=a){e?s=t:d=t;var n=e?i.offsetWidth:i.offsetHeight,o=e?m:p,l=e?R:G;if(o<n+a&&0<(r?l-t:t-l))return a;b.SetStyle(i,e?"width":"height",`${e?m:p}px`),(e&&c||!e&&u)&&b.SetStyle(i,e?"left":"top",`${e?T:C}px`)}return!1};tr(N,i,e=>{var t=e.pageX,e=e.pageY,t=A(!0,t),e=A(!1,e);if(!j(t)||t||!j(e)||e){const n={};var r=(e,t,r)=>{var a="width"===e,t=(a?i.offsetWidth:i.offsetHeight)+t;n[e]=t+"px",r&&(e=(a?T:C)+(a?m:p),n[a?"left":"top"]=e-t+"px")};j(t)||r("width",t,c),j(e)||r("height",e,u),b.SetStyles(i,n),D(i)}},()=>{b.Remove(g.Figure);const t=[];Jr(l,e=>k(t,[e,{width:Y(N,e,"width")+"px",height:Y(N,e,"height")+"px"}])),O(t,([e,t])=>b.SetStyles(e,t)),Vr(N,r,i),b.Show(I),b.Show(y),zr(N,i,a),a=void 0})},...t),b.Insert(e,...t),e},(e,s)=>{const B=e,w=B.DOM;var e=w.Create("div",{attrs:[H.ATTRIBUTES.ADJUSTABLE_LINE_GROUP]}),t=e=>{var t={};return t[H.ATTRIBUTES.ADJUSTABLE_LINE]=e,w.Create("div",{attrs:t,styles:{width:`${"width"===e?5:Y(B,s,"width")}px`,height:`${"width"===e?Y(B,s,"height"):5}px`}})};const d=t("width"),c=t("height");return er(B,(e,t,S)=>{let r=Yr(B,s);w.SetStyles(d,{width:"6px",height:Y(B,s,"height")+"px"}),w.SetStyles(c,{width:Y(B,s,"width")+"px",height:"6px"});const m=e.target===d,p=m?d:c;let T=m?e.pageX:e.pageY;w.SetAttr(p,H.ATTRIBUTES.ADJUSTING);e=w.Element.Table.GetGridWithIndex(S).Grid;const a=jr(B,t,S),C=(w.InsertBefore(t,a.Figure),$r(B,a,t,S),w.RemoveStyles(S,"width","height"),m?"width":"height"),v=m?"left":"top",E=e=>m?e.offsetLeft:e.offsetTop,n=t=>{var r,e=S.offsetWidth,a=S.offsetHeight;if(w.SetStyles(S,{width:"0px",height:"0px"}),!m){let e=t.nextElementSibling;for(;e;)w.SetAttr(e,"dump-height",w.GetStyle(e,"height")),w.RemoveStyle(e,"height"),e=e.nextElementSibling}var n=w.GetStyle(t,C),o=(w.SetStyle(t,C,"0px"),Y(B,t,C));if(w.SetStyle(t,C,n),!m){let e=t.nextElementSibling;for(;e;)w.SetStyle(e,"height",null!=(r=w.GetAttr(e,"dump-height"))?r:""),w.RemoveAttr(e,"dump-height"),e=e.nextElementSibling}return w.SetStyles(S,{width:e+"px",height:a+"px"}),o},I=[],y=[];let R=-1,o=-1,G=-1,l=-1;Jr(e,e=>{var t=E(S)+E(e),r=E(p),a=r-4.5,r=r+4.5;if(w.SetStyle(e,C,Y(B,e,C)+"px"),a<=t&&t<=r)return k(y,e),-1!==G?void 0:(G=n(e),void(l=Y(B,e,C)-G));t+=Y(B,e,C);t<a||r<t||(k(I,e),-1===R&&(R=n(e),o=Y(B,e,C)-R))});const i=()=>{w.Remove(a.Figure),w.RemoveAttr(p,H.ATTRIBUTES.ADJUSTING),Vr(B,t,S),zr(B,S,r),r=void 0},A=!x(y),N=!x(I);if(!A&&!N)return i();let b=-1,U=-1,F=-1,L=-1,D=-1;A&&!N&&(b=E(S)+l-3,L=Y(B,S,C)-l,D=E(S)+l),!A&&N&&(b=E(S)+Y(B,S,C)-o-3,L=Y(B,S,C)-o,D=E(S)),A&&N&&(b=E(S)+E(I[0])+R-3,U=E(S)+E(y[0])+Y(B,y[0],C)-G-3);const O=e=>{var t={};t[C]=L+"px",t[v]=D+"px",w.SetStyles(S,t),P(e,e=>w.SetStyle(e,C,Y(B,e,C)+"px"))};tr(B,S,e=>{var e=m?e.pageX:e.pageY,t=e-T;if(0!=t){var r=E(p)+t,r=(w.SetStyle(p,v,r+"px"),E(p)),a=r+3,n=parseFloat(w.GetStyle(S,v));if(T=e,A&&N){var e=t,o=r,l=n;const c=o+3;var i=Math.floor(Y(B,I[0],C)),s=Math.floor(Y(B,y[0],C)),i=i<=R,s=s<=G,d=i?1:-1,e=e*d;if(!i||!s)if((i||s)&&e<0&&-1===F)F=i?b:U;else{if(-1!==F){s=(F-o)*d;if(e<0||0<s)return;F=-1}const u=[],g=[];P(I,e=>{var t=parseFloat(w.GetStyle(e,C)),r=t+l+E(e),r=c-r;k(u,[e,t+r+"px"])}),P(y,e=>{var t=parseFloat(w.GetStyle(e,C)),r=l+E(e)-c;k(g,[e,t+r+"px"])}),P(u,([e,t])=>w.SetStyle(e,C,t)),P(g,([e,t])=>w.SetStyle(e,C,t))}}else{i=A?y:I,o=Math.floor(Y(B,i[0],C)),d=parseFloat(w.GetStyle(S,C)),e=A?G:R,s=A?1:-1,t=t*s;if((o<=e||!A&&d<=L)&&0<t&&-1===F)return F=b,O(i);if(-1!==F){Y(B,S,C)===L&&E(S)===D||O(i);e=(F-r)*s;if(0<t||e<0)return;F=-1}const h=(n+(A?0:d)-a)*s,f=[];P(i,e=>k(f,[e,Y(B,e,C)])),P(f,([e,t])=>w.SetStyle(e,C,t+h+"px"));r={};r[C]=d+h+"px",A&&(r[v]=n-h+"px"),w.SetStyles(S,r)}}},()=>i())},d,c),w.Insert(e,d,c),e}]}};const qr=e=>{const n=e,o=n.DOM,l=(e=>{const n=e,i=n.DOM,o={},l=[],s=e=>!!o[e];return{IsAttached:s,Attach:e=>{var{name:e,partAttachers:t,partPositionListeners:r}=e;o[e]||(o[e]=[]),k(o[e],...R(t)?t:[t]),r&&k(l,...R(r)?r:[r])},Detach:e=>{const{name:t,partAttachers:r,partPositionListeners:a}=e;s(t)&&(e=R(r)?[...r]:[r],O(e,e=>f(o[t],e))),a&&(e=R(a)?[...a]:[a],O(e,e=>f(l,e)))},Create:(e,t)=>{var r={},r=(r[H.ATTRIBUTES.TYPE]=e+"-tool",r[H.ATTRIBUTES.FIXED]="parts-tool",i.Create("div",{attrs:r}));const a=[];return o[e]&&P(o[e],e=>k(a,e(n,t))),i.Insert(r,...a),r},SelectParts:(e,t)=>{var r,a={},a=(a[H.ATTRIBUTES.FIXED]="parts-tool",{attrs:a});if(!e&&t){var n=i.SelectAll(a,t),o=i.Element.Figure.Is(t)?t:null!=(r=i.Element.Figure.FindClosest(t))?r:i.Select(i.Element.Figure.Selector,t);if(!o)return null;for(let e=0,t=n.length;e<t;++e){var l=n[e];if(i.Element.Figure.FindClosest(l)===o&&i.Utils.IsChildOf(l,o))return l}}return(e?i.SelectAll:i.Select)(a,t)},IsParts:e=>!!F(e)&&i.HasAttr(e,H.ATTRIBUTES.FIXED,"parts-tool"),ChangePositions:()=>P(l,e=>e(n))}})(n);l.Attach(Xr.Media),l.Attach(Xr.Table),o.On(n.GetWin(),RichEditor.NativeEventMap.scroll,()=>P(o.SelectAll({attrs:[H.ATTRIBUTES.PARTS_MENU]}),e=>{var t,{Figure:r,FigureElement:a}=o.Element.Figure.Find(e);r&&a&&(t=n.GetWin().innerHeight+n.GetWin().scrollY,r=r.offsetTop+r.offsetHeight+e.offsetHeight<=t?a.offsetTop+a.offsetHeight+6+"px":a.offsetTop-e.offsetHeight-6+"px",o.SetStyle(e,"top",r),rr(n,e))}));const i=(e=!1,t)=>{var e=e?o.SelectAll:o.Select,r=[H.ATTRIBUTES.FOCUSED];return G(t)&&k(r,{type:t}),e({tagName:o.Element.Figure.Selector,attrs:r})},t=e=>{if(e)return o.Show(e);var t=i();t&&o.Show(null!=e?e:l.SelectParts(!1,t))},r=r=>{var e=l.SelectParts(!0);const a=i();P(e,e=>{var t;t=e,!!a&&o.Utils.IsChildOf(t,a)&&o.Element.Figure.FindClosest(t)===a||!!r&&o.Utils.IsChildOf(t,r)&&o.Element.Figure.FindClosest(t)===a||o.Hide(e)})};return{Manager:l,Create:(e,t)=>l.Create(e,t),RemoveAll:()=>{var e=l.SelectParts(!0);P(e,e=>o.Remove(e,!0))},SelectFocused:i,Show:t,HideAll:r,UnsetAllFocused:t=>{var e=i(!0);P(e,e=>{t&&e===t||o.RemoveAttr(e,H.ATTRIBUTES.FOCUSED)}),r(t)},ChangePositions:()=>{t();{var e=n;const s=e,d=s.DOM;e=s.Tools.Parts.Manager.SelectParts(!0),P(e,e=>{if(!d.IsHidden(e)){const{Figure:l,FigureType:n,FigureElement:i}=d.Element.Figure.Find(e);l&&n&&i&&(P(d.SelectAll({attrs:[H.ATTRIBUTES.MOVABLE]},e),e=>d.SetStyle(e,"left",Xt(i.offsetLeft+i.offsetWidth/2,!0))),P(d.SelectAll({attrs:[H.ATTRIBUTES.ADJUSTABLE_LINE]},e),e=>{var t={},r=d.GetAttr(e,H.ATTRIBUTES.ADJUSTABLE_LINE);switch(n){case"table":var a="width"===r;t.width=`${a?5:i.offsetWidth}px`,t.height=`${a?i.offsetHeight:5}px`,t.left=`${a?0:i.offsetLeft}px`,t.top=`${a?i.offsetTop:0}px`;break;case"media":a="left"===r||"right"===r;t.width=`${a?3:i.offsetWidth}px`,t.height=`${a?i.offsetHeight:3}px`,t.left=i.offsetLeft+("right"!==r?0:i.offsetWidth)-1.5+"px",t.top=i.offsetTop+("bottom"!==r?0:i.offsetHeight)-1.5+"px"}d.SetStyles(e,t)}),P(d.SelectAll({attrs:[H.ATTRIBUTES.ADJUSTABLE_EDGE]},e),e=>{var t=d.HasAttr(e,H.ATTRIBUTES.HORIZONTAL,"left"),r=d.HasAttr(e,H.ATTRIBUTES.VERTICAL,"top");d.SetStyles(e,{left:qt(i.offsetLeft+(t?0:i.offsetWidth),!0),top:qt(i.offsetTop+(r?0:i.offsetHeight),!0)})}),P(d.SelectAll({attrs:[H.ATTRIBUTES.PARTS_MENU]},e),e=>{if(!d.HasAttr(l,H.ATTRIBUTES.FOCUSED))return d.Hide(e);d.Show(e);var t={},r=l.offsetLeft+l.offsetWidth,a=i.offsetLeft+i.offsetWidth,n=(i.offsetWidth-e.offsetWidth)/2,a=a-e.offsetWidth-n,o=a+e.offsetWidth,r=d.HasAttr(l,H.ATTRIBUTES.AS_TEXT)&&r>d.Doc.body.offsetWidth,o=(a<0&&!r?t.left="0px":o>d.Doc.body.offsetWidth||r?t.left=a+n+"px":t.left=a+"px",s.GetWin().innerHeight+s.GetWin().scrollY),r=l.offsetTop+l.offsetHeight+e.offsetHeight;t.top=r<=o?i.offsetTop+i.offsetHeight+6+"px":i.offsetTop-e.offsetHeight-6+"px",d.SetStyles(e,t),rr(s,e)}))}})}l.ChangePositions()}}},Zr=e=>{const c=e,n=c.Frame.Resizer,u=e=>{var t,r,a;c.Config.Mode!==Ae.inline&&n&&({width:e,height:t}=e,r=(e,t)=>{var r;(l(t)||G(t))&&(t=l(t)?E(t,"px"):t,r="width"===e?c.Frame.Root:c.Frame.Container,M.SetStyle(r,e,t))},(a=e=>c.Config.Resizable===e||"all"===c.Config.Resizable)("horizontal")&&r("width",e),a("vertical"))&&r("height",t)};return n&&zt(c,e=>{c.Dispatch("Editor:Resize:Start");let l=e.pageX,i=e.pageY;const s=l-c.Frame.Root.offsetWidth+20,d=i-c.Frame.Container.offsetHeight+20;jt(c,e=>{c.Dispatch("Editor:Resize:Move");var t=e.pageX,e=e.pageY,r=t-l,a=e-i,n={},o=t<=s,r=(n.width=o?20:c.Frame.Root.offsetWidth+r,l=o?s:t,e<=d);n.height=r?20:c.Frame.Container.offsetHeight+a,i=r?d:e,u(n)},()=>c.Dispatch("Editor:Resize:Finish"),!0)},n),{Resize:u}},Qr=e=>{const o=e,r=o.Frame,l=o.Config,a=Ft(l.Skin),i=()=>{e=r.Container;var e=M.Utils.IsIFrame(e)?(o.SetWin(e.contentWindow),o.DOM=M.New({document:e.contentDocument,bEditor:!0,bSelfBody:!0}),a.IFrame(e)):(e=a.Div(e),o.DOM=M.New({bEditor:!0,bSelfBody:!1,body:e}),M.Insert(r.Container,e),e);if(!e)throw new Error("Error occurred during setup Editor body");M.Select({id:a.DefaultCSSId},M.Doc.head)||M.Insert(M.Doc.head,a.DefaultCss),M.Select({id:a.SkinCSSId},M.Doc.head)||M.Insert(M.Doc.head,a.SkinCSSLink);let t;M.Utils.IsTextArea(l.Selector)?(t=l.Selector.value,B(t)&&(t=l.Selector.innerHTML.replace(/&lt;/gi,"<").replace(/&gt;/gi,">")),l.Selector.value=""):(t=M.GetHTML(l.Selector),M.SetHTML(l.Selector,"")),o.SetBody(e),o.SetContent(t)};return new Promise((e,t)=>{i(),o.On(I.click,()=>{o.IsFocused()||o.Focus()}),o.Tools={Parts:qr(o),Resizer:Zr(o)},o.Plugin=Fr(o),l.ShowFooter&&(o.Footer=Ur(o)),ir(o),o.Formatter=Rr(o),null!=(a=o.Footer)&&a.UpdateCounter(),o.CleanDirty(),o.Focus();var r,a=M.Utils.GetLastChild(o.GetBody(),!0),n=(a&&(r=o.Utils.Range(),n=D(a)?a.length:0,r.SetStartToEnd(a,n,n),o.Utils.Caret.UpdateRange(r)),Ct(o,null!=(a=o.Utils.Caret.Get())?a:[]));n&&o.History.Record({data:Tt(o),redo:n}),RichEditor.Loaders.Plugin.LoadParallel(l.Plugins).then(o.Plugin.AttachPlugin).then(o.Utils.Event.Resolve).then(()=>e(o.Toolbar.LoadAll())).catch(e=>t(e))})};const ea=n=>{const o=[],l=e=>C(o,e),i=a=>new Promise((e,t)=>{if(l(a))return e();const r=M.Create("script",{attrs:{src:H.JoinURL(v(n),a)}});r.onload=()=>{l(a)||k(o,a),e(M.Remove(r))},r.onerror=()=>t(n+`: ${a} is failed to load scripts.`),M.Insert(M.Doc.head,r)});return{Has:l,Load:i,LoadParallel:a=>new Promise((e,t)=>{const r=[];P(a,e=>k(r,i(e))),Promise.all(r).catch(t).finally(e)})}};r=(()=>{const n={};return Object.assign(Object.assign({},ea("Plugin")),{Add:(e,t)=>{$(n[e])||(n[e]=t)},Attach:(r,a)=>new Promise(t=>{try{t(n[a](r))}catch(e){console.error(e),t(r.Notify(dt.ERROR,`Plugin: ${a} runs inappropriately.`))}})})})(),t=(()=>{const r={},t=e=>!!r[e];return{Has:t,Get:e=>t(e)?r[e]:e,Register:(e,t)=>{if(!G(e))return N(e,(e,t)=>{r[e]=t});B(e)||!G(t)||B(t)||(r[e]=t)}}})();return{Loaders:{Icon:ea("Icon"),Language:ea("Language"),Plugin:r},Icons:t,Options:H,NativeEventMap:I,KeyCode:y,ILC:d,Utils:i,PreventEvent:W,Init:e=>{G(e.iconPack)||(e.iconPack="default");const a=(e=>{const r=["selector","mode","width","height","plugins","toolbar","toolbarGroup","toolbarStyle","skin","showFooter","resizable"];if(!e.selector||!L(e.selector))throw new Error("Configuration: selector must be an provided.");var t=e.selector,a=(M.Hide(t),v(null!=(a=e.mode)?a:Ae.classic));if(!G(a)||!Ae[a])throw new Error(`Configuration: ${a} mode doesn't exist.`);var a=Ae[a],n=null!=(n=e.width)?n:"100%",o=a===Ae.classic?"400px":"auto",l=null!=(l=e.height)?l:o,o=null!=(o=e.plugins)?o:[];if(!R(o))throw new Error("Configuration: Plugins must be an array.");let i=e.toolbar,s;if(i){if(!R(i))throw new Error("Configuration: Toolbar must be an array.");if((s=null!=(u=e.toolbarGroup)?u:{})&&!z(s))throw new Error("Configuration: Toolbar Group must be an object.")}else i=["styles","history","selectAll","basic","script","font","color","alignment","indentation","hr","info"],s={styles:["heading_style","block_style"],history:["undo","redo"],font:["fontSize","fontFamily"],basic:["bold","italic","underline","strikethrough","code"],color:["foreColor","backColor"],script:["subscript","superscript"]};let d=se(G(e.toolbarStyle)?e.toolbarStyle:st.SCROLL);st[d]||(d=st.SCROLL);const c={};N(e,(e,t)=>{C(r,e)||(c[ce(me(e))]=t)});var u=e.skin,u=u&&G(u)&&!B(u)?u:"simple",g=e.showFooter,g=!j(g)||g,e=e.resizable;let h="vertical";a!==Ae.inline&&(j(e)&&!e&&(h=!1),G(e))&&C(["horizontal","vertical","all"],e)&&(h=e);e=Object.assign({Selector:t,Mode:a,Width:n,Height:l,Plugins:o,Toolbar:i,ToolbarGroup:s,ToolbarStyle:d,Skin:u,ShowFooter:g,Resizable:h},c);return Object.freeze(e),e})(e);return new Promise(e=>{(()=>{const r=a.IconPack;return new Promise((e,t)=>{RichEditor.Loaders.Icon.Load(r).catch(()=>t(`Icon.${r}: failed to load the icon pack`)).then(()=>{if(!G(a.Language))return e();e(RichEditor.Loaders.Language.Load(a.Language))}).catch(()=>t(`Language.${a.Language}: failed to load the language pack`))})})().then(()=>{const t=new Ut(a);Qr(t).then(()=>{t.ToggleLoading(ct.HIDE),e(t)}).catch(e=>t.Notify(dt.ERROR,e,!0))}).catch(console.error)})}}}();